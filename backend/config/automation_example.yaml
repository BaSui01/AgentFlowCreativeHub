# Agent 自动化控制配置示例

# ========================================
# 示例 1: 全自动内容创作工作流
# ========================================
workflow_full_auto:
  name: "全自动内容创作"
  description: "从调研到发布的完全自动化流程"
  version: "1.0"
  
  # 自动化配置
  automation_config:
    mode: "full_auto"           # 全自动模式
    max_rounds: 5               # 最多 5 轮迭代
    stop_conditions:
      - type: "goal_achieved"   # 目标达成时停止
      - type: "max_rounds"      # 达到最大轮次时停止
    
    # Agent 切换策略
    agent_switching:
      mode: "dynamic"           # 动态切换
      rules:
        - condition: "quality_score < 80"
          next_agent: "rewriter"
          priority: 1
        - condition: "confidence < 0.7"
          next_agent: "researcher"
          priority: 2
    
    # 默认重试配置
    default_retry:
      max_retries: 3
      backoff: "exponential"    # 指数退避
      delay: 5                  # 初始延迟 5 秒
  
  steps:
    # 步骤 1: 调研
    - id: "research"
      name: "内容调研"
      type: "agent"
      agent_type: "researcher"
      auto_execute: true        # 自动执行
      approval_required: false  # 无需审批
      input:
        query: "{{user_input.topic}}"
        depth: "comprehensive"
      output: "research_result"
    
    # 步骤 2: 生成大纲
    - id: "outline"
      name: "生成大纲"
      type: "agent"
      agent_type: "planner"
      auto_execute: true
      approval_required: false
      depends_on: ["research"]
      input:
        context: "{{research_result}}"
        topic: "{{user_input.topic}}"
      output: "outline"
      # 质量检查
      quality_check:
        enabled: true
        min_score: 80
        retry_on_fail: true
        rewrite_agent: "planner"  # 质量不达标时重新生成
    
    # 步骤 3: 撰写内容
    - id: "writing"
      name: "撰写初稿"
      type: "agent"
      agent_type: "writer"
      auto_execute: true
      approval_required: false
      depends_on: ["outline"]
      input:
        outline: "{{outline}}"
        style: "professional"
        word_count: "{{user_input.word_count}}"
      output: "draft"
      retry:
        max_retries: 2
        backoff: "exponential"
        delay: 10
    
    # 步骤 4: 内容审校
    - id: "review"
      name: "内容审校"
      type: "agent"
      agent_type: "reviewer"
      auto_execute: true
      approval_required: false
      depends_on: ["writing"]
      input:
        content: "{{draft}}"
        check_grammar: true
        check_facts: true
      output: "reviewed_content"
      quality_check:
        enabled: true
        min_score: 85
        retry_on_fail: true
        rewrite_agent: "rewriter"
    
    # 步骤 5: 格式化（无需审批，自动执行）
    - id: "format"
      name: "格式化输出"
      type: "agent"
      agent_type: "formatter"
      auto_execute: true
      approval_required: false
      depends_on: ["review"]
      input:
        content: "{{reviewed_content}}"
        format: "markdown"
      output: "final_output"

# ========================================
# 示例 2: 半自动内容创作（关键节点需要审批）
# ========================================
workflow_semi_auto:
  name: "半自动内容创作"
  description: "自动执行大部分步骤，关键节点需要人工审批"
  version: "1.0"
  
  automation_config:
    mode: "semi_auto"           # 半自动模式
    max_rounds: 3
    
  steps:
    - id: "research"
      name: "内容调研"
      type: "agent"
      agent_type: "researcher"
      auto_execute: true
      approval_required: false
      input:
        query: "{{user_input.topic}}"
      output: "research_result"
    
    - id: "outline"
      name: "生成大纲"
      type: "agent"
      agent_type: "planner"
      auto_execute: true
      approval_required: true   # 大纲需要审批
      depends_on: ["research"]
      input:
        context: "{{research_result}}"
      output: "outline"
      approval_config:
        type: "conditional"     # 条件审批
        auto_approve_if:
          expression: "quality_score >= 90"  # 质量分数 >= 90 自动批准
        timeout_seconds: 3600   # 1 小时超时
        notify_channels:
          - "webhook"
          - "email"
    
    - id: "writing"
      name: "撰写初稿"
      type: "agent"
      agent_type: "writer"
      auto_execute: true
      approval_required: false
      depends_on: ["outline"]
      input:
        outline: "{{outline}}"
      output: "draft"
    
    - id: "review"
      name: "内容审校"
      type: "agent"
      agent_type: "reviewer"
      auto_execute: true
      approval_required: false
      depends_on: ["writing"]
      input:
        content: "{{draft}}"
      output: "reviewed_content"
    
    - id: "final_approval"
      name: "最终审批"
      type: "approval"          # 纯审批节点
      approval_required: true
      depends_on: ["review"]
      approval_config:
        type: "required"        # 强制人工审批
        timeout_seconds: 7200   # 2 小时超时
        notify_channels:
          - "webhook"
          - "email"
          - "websocket"

# ========================================
# 示例 3: 多语言翻译（并行 + 质量控制）
# ========================================
workflow_multilang:
  name: "多语言内容生产"
  description: "同时翻译多种语言，质量不达标自动重试"
  version: "1.0"
  
  automation_config:
    mode: "full_auto"
    agent_switching:
      mode: "dynamic"
      rules:
        - condition: "quality_score < 85"
          next_agent: "translator"  # 重新翻译
          priority: 1
  
  steps:
    - id: "source_content"
      name: "源内容准备"
      type: "agent"
      agent_type: "writer"
      auto_execute: true
      approval_required: false
      input:
        topic: "{{user_input.topic}}"
      output: "source_content"
    
    # 并行翻译
    - id: "translate_en"
      name: "翻译英文"
      type: "agent"
      agent_type: "translator"
      auto_execute: true
      approval_required: false
      parallel: true            # 并行执行
      depends_on: ["source_content"]
      input:
        content: "{{source_content}}"
        target_lang: "en"
      output: "content_en"
      quality_check:
        enabled: true
        min_score: 85
        retry_on_fail: true
        rewrite_agent: "translator"
    
    - id: "translate_ja"
      name: "翻译日文"
      type: "agent"
      agent_type: "translator"
      auto_execute: true
      approval_required: false
      parallel: true
      depends_on: ["source_content"]
      input:
        content: "{{source_content}}"
        target_lang: "ja"
      output: "content_ja"
      quality_check:
        enabled: true
        min_score: 85
        retry_on_fail: true
        rewrite_agent: "translator"
    
    - id: "translate_ko"
      name: "翻译韩文"
      type: "agent"
      agent_type: "translator"
      auto_execute: true
      approval_required: false
      parallel: true
      depends_on: ["source_content"]
      input:
        content: "{{source_content}}"
        target_lang: "ko"
      output: "content_ko"
      quality_check:
        enabled: true
        min_score: 85
        retry_on_fail: true
        rewrite_agent: "translator"

# ========================================
# 示例 4: 自动对话模式（多轮迭代）
# ========================================
workflow_auto_conversation:
  name: "自动对话创作"
  description: "Agent 自动多轮对话直到达成目标"
  version: "1.0"
  
  automation_config:
    mode: "full_auto"
    max_rounds: 10            # 最多 10 轮对话
    stop_conditions:
      - type: "goal_achieved"
      - type: "max_rounds"
      - type: "error_threshold"
        threshold: 0.3        # 错误率 > 30% 时停止
    
    agent_switching:
      mode: "dynamic"
      rules:
        - condition: "quality_score < 70"
          next_agent: "planner"
          priority: 1
        - condition: "quality_score >= 70 AND quality_score < 85"
          next_agent: "rewriter"
          priority: 2
        - condition: "quality_score >= 85"
          next_agent: "reviewer"
          priority: 3
  
  steps:
    - id: "conversation_round"
      name: "对话轮次"
      type: "agent"
      agent_type: "writer"      # 初始 Agent
      auto_execute: true
      approval_required: false
      input:
        context: "{{previous_output}}"
        goal: "{{user_input.goal}}"
      output: "current_output"
      quality_check:
        enabled: true
        min_score: 85
        retry_on_fail: false    # 不重试，而是切换 Agent
