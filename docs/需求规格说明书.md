# AgentFlowCreativeHub éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç¼–å†™æ—¥æœŸ**: 2025-11-17  
**é¡¹ç›®çŠ¶æ€**: å¼€å‘ä¸­ï¼ˆSprint 7ï¼‰  
**å®Œæˆåº¦**: çº¦ 70%

---

## æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£æ˜¯ **AgentFlowCreativeHub** é¡¹ç›®çš„å®Œæ•´éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ï¼Œæ¶µç›–ï¼š
- é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡
- ç³»ç»Ÿæ•´ä½“æ¶æ„
- æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡
- æ•°æ®æ¨¡å‹ä¸ API æ¥å£
- **RAG çŸ¥è¯†åº“ç³»ç»Ÿå®Œæ•´è®¾è®¡** â­
- éåŠŸèƒ½æ€§éœ€æ±‚
- éƒ¨ç½²ä¸è¿ç»´
- æµ‹è¯•ç­–ç•¥
- é¡¹ç›®é‡Œç¨‹ç¢‘

é€‚åˆå¯¹è±¡ï¼šå¼€å‘å›¢é˜Ÿã€äº§å“ç»ç†ã€æ¶æ„å¸ˆã€æµ‹è¯•å·¥ç¨‹å¸ˆ

---

## ç›®å½•

<!-- TOC -->
- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
  - [1.1 é¡¹ç›®èƒŒæ™¯](#11-é¡¹ç›®èƒŒæ™¯)
  - [1.2 é¡¹ç›®ç›®æ ‡](#12-é¡¹ç›®ç›®æ ‡)
  - [1.3 é¡¹ç›®èŒƒå›´](#13-é¡¹ç›®èŒƒå›´)
  - [1.4 æœ¯è¯­å®šä¹‰](#14-æœ¯è¯­å®šä¹‰)
- [2. æ•´ä½“æ¶æ„](#2-æ•´ä½“æ¶æ„)
  - [2.1 ç³»ç»Ÿæ¶æ„å›¾](#21-ç³»ç»Ÿæ¶æ„å›¾)
  - [2.2 æŠ€æœ¯æ ˆ](#22-æŠ€æœ¯æ ˆ)
  - [2.3 æ¨¡å—åˆ’åˆ†](#23-æ¨¡å—åˆ’åˆ†)
  - [2.4 éƒ¨ç½²æ¶æ„](#24-éƒ¨ç½²æ¶æ„)
- [3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#3-æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
  - [3.1 å¤š Agent åä½œç³»ç»Ÿ](#31-å¤š-agent-åä½œç³»ç»Ÿ)
  - [3.2 AI æ¨¡å‹ç®¡ç†](#32-ai-æ¨¡å‹ç®¡ç†)
  - [3.3 RAG çŸ¥è¯†åº“ç³»ç»Ÿ](#33-rag-çŸ¥è¯†åº“ç³»ç»Ÿ) â­
  - [3.4 Prompt æ¨¡æ¿ç®¡ç†](#34-prompt-æ¨¡æ¿ç®¡ç†)
  - [3.5 å·¥ä½œæµç¼–æ’](#35-å·¥ä½œæµç¼–æ’)
  - [3.6 è®¤è¯æˆæƒç³»ç»Ÿ](#36-è®¤è¯æˆæƒç³»ç»Ÿ)
  - [3.7 å®¡è®¡æ—¥å¿—ç³»ç»Ÿ](#37-å®¡è®¡æ—¥å¿—ç³»ç»Ÿ)
- [4. æ•°æ®æ¨¡å‹](#4-æ•°æ®æ¨¡å‹)
- [5. API è®¾è®¡](#5-api-è®¾è®¡)
- [6. RAG çŸ¥è¯†åº“è¯¦ç»†è®¾è®¡](#6-rag-çŸ¥è¯†åº“è¯¦ç»†è®¾è®¡) â­
- [7. éåŠŸèƒ½æ€§éœ€æ±‚](#7-éåŠŸèƒ½æ€§éœ€æ±‚)
- [8. éƒ¨ç½²ä¸è¿ç»´](#8-éƒ¨ç½²ä¸è¿ç»´)
- [9. æµ‹è¯•ç­–ç•¥](#9-æµ‹è¯•ç­–ç•¥)
- [10. é‡Œç¨‹ç¢‘ä¸è·¯çº¿å›¾](#10-é‡Œç¨‹ç¢‘ä¸è·¯çº¿å›¾)
- [11. é™„å½•](#11-é™„å½•)
<!-- /TOC -->

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

åœ¨ AI æŠ€æœ¯å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œä¼ä¸šå’Œå›¢é˜Ÿé¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š
- **å†…å®¹ç”Ÿäº§æ•ˆç‡ä½ä¸‹**ï¼šä¾èµ–äººå·¥åˆ›ä½œï¼Œæµç¨‹ç¹çï¼Œå‘¨æœŸé•¿
- **è´¨é‡éš¾ä»¥ä¿è¯**ï¼šç¼ºä¹æ ‡å‡†åŒ–æµç¨‹ï¼Œå†…å®¹è´¨é‡å‚å·®ä¸é½
- **çŸ¥è¯†åˆ†æ•£**ï¼šä¼ä¸šçŸ¥è¯†åº“æœªæ•´åˆï¼Œéš¾ä»¥å¤ç”¨
- **å¤šæ¨¡å‹é€‰æ‹©å›°éš¾**ï¼šä¸åŒ AI æä¾›å•†ç‰¹ç‚¹ä¸åŒï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†

**AgentFlowCreativeHub** æ—¨åœ¨æ„å»ºä¸€ä¸ª**ä¼ä¸šçº§å¤š Agent åä½œåˆ›ä½œå¹³å°**ï¼Œé€šè¿‡ï¼š
- ğŸ¤– **å¤š Agent åˆ†å·¥åä½œ** - ä¸“ä¸šåŒ– Agent å¤„ç†ä¸åŒä»»åŠ¡
- ğŸ“š **RAG çŸ¥è¯†å¢å¼º** - åŸºäºä¼ä¸šçŸ¥è¯†åº“çš„æ™ºèƒ½åˆ›ä½œ
- ğŸ”„ **å·¥ä½œæµç¼–æ’** - è‡ªåŠ¨åŒ–å†…å®¹ç”Ÿäº§æµç¨‹
- ğŸ” **ä¼ä¸šçº§å®‰å…¨** - å¤šç§Ÿæˆ·éš”ç¦» + RBAC æƒé™æ§åˆ¶

è§£å†³ä¼ä¸šå†…å®¹ç”Ÿäº§çš„æ•ˆç‡ã€è´¨é‡å’Œæ ‡å‡†åŒ–é—®é¢˜ã€‚

### 1.2 é¡¹ç›®ç›®æ ‡

#### çŸ­æœŸç›®æ ‡ï¼ˆ3-6 ä¸ªæœˆï¼‰
- âœ… æ„å»ºå®Œæ•´çš„ AI æ¨¡å‹ç®¡ç†ç³»ç»Ÿï¼ˆæ”¯æŒ 8+ æä¾›å•†ï¼‰
- âœ… å®ç° RAG çŸ¥è¯†åº“åŠŸèƒ½ï¼ˆpgvector + è¯­ä¹‰æ£€ç´¢ï¼‰
- âœ… å®Œæˆè®¤è¯æˆæƒä¸å®¡è®¡ç³»ç»Ÿ
- â³ å®ç° Agent å·¥ä½œæµç¼–æ’
- â³ æä¾› Web æ§åˆ¶å°

#### ä¸­æœŸç›®æ ‡ï¼ˆ6-12 ä¸ªæœˆï¼‰
- æ”¯æŒå·¥å…·è°ƒç”¨ï¼ˆFunction Callingï¼‰
- å®ç°ä¼ä¸šçº§ç›‘æ§ä¸å‘Šè­¦
- æ”¯æŒå¤šè¯­è¨€ç¿»è¯‘ Agent
- æ„å»º Agent å¸‚åœºï¼ˆç¤¾åŒºå…±äº«ï¼‰

#### é•¿æœŸç›®æ ‡ï¼ˆ12+ ä¸ªæœˆï¼‰
- æ”¯æŒå¤šæ¨¡æ€å†…å®¹åˆ›ä½œï¼ˆå›¾åƒã€è§†é¢‘ï¼‰
- AI è‡ªåŠ¨ä¼˜åŒ– Prompt
- æ„å»º Agent è‡ªå­¦ä¹ èƒ½åŠ›
- æˆä¸ºä¼ä¸š AI å†…å®¹å¹³å°æ ‡å‡†

### 1.3 é¡¹ç›®èŒƒå›´

#### æ ¸å¿ƒèŒƒå›´ï¼ˆâœ… åŒ…å«ï¼‰
1. **å¤š Agent ç³»ç»Ÿ**
   - Writerã€Reviewerã€Formatterã€Planner Agent
   - Agent æ³¨å†Œä¸ç®¡ç†
   - Agent æ‰§è¡Œå¼•æ“

2. **AI æ¨¡å‹ç®¡ç†**
   - å¤šæä¾›å•†æ¥å…¥ï¼ˆOpenAIã€Azureã€Googleã€AWSã€Anthropicã€DeepSeekã€Qwenã€Ollamaï¼‰
   - æ¨¡å‹é…ç½®ä¸è·¯ç”±
   - æ¨¡å‹å‘ç°ä¸åˆ‡æ¢

3. **RAG çŸ¥è¯†åº“** â­
   - çŸ¥è¯†åº“ CRUD
   - æ–‡æ¡£ä¸Šä¼ ä¸å¤„ç†
   - è¯­ä¹‰æ£€ç´¢
   - Agent RAG é›†æˆ

4. **å·¥ä½œæµç¼–æ’**
   - YAML/JSON å·¥ä½œæµå®šä¹‰
   - ä»»åŠ¡è°ƒåº¦ä¸çŠ¶æ€ç®¡ç†
   - Agent ä¸²è¡Œ/å¹¶è¡Œæ‰§è¡Œ

5. **è®¤è¯æˆæƒ**
   - JWT + Session
   - OAuth2 é›†æˆ
   - å¤šç§Ÿæˆ·éš”ç¦»
   - RBAC æƒé™æ§åˆ¶

6. **å®¡è®¡æ—¥å¿—**
   - 40+ å®¡è®¡äº‹ä»¶ç±»å‹
   - æ—¥å¿—æŸ¥è¯¢ä¸è¿‡æ»¤
   - å®¡è®¡æŠ¥å‘Šç”Ÿæˆ

#### è¾¹ç•ŒèŒƒå›´ï¼ˆâŒ ä¸åŒ…å«ï¼‰
- å‰ç«¯ä½ä»£ç æ‹–æ‹½ç¼–è¾‘å™¨ï¼ˆä½¿ç”¨ YAML/JSON é…ç½®ï¼‰
- AI æ¨¡å‹è®­ç»ƒï¼ˆä»…è°ƒç”¨ç°æœ‰æ¨¡å‹ï¼‰
- è§†é¢‘/å›¾åƒç”Ÿæˆï¼ˆä¸“æ³¨æ–‡æœ¬å†…å®¹ï¼‰
- å®æ—¶åä½œç¼–è¾‘ï¼ˆéæ ¸å¿ƒåŠŸèƒ½ï¼‰

### 1.4 æœ¯è¯­å®šä¹‰

| æœ¯è¯­ | å®šä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| **Agent** | ä¸“ä¸šåŒ–çš„ AI æ‰§è¡Œå•å…ƒï¼Œè´Ÿè´£ç‰¹å®šä»»åŠ¡ | Writer Agentã€Reviewer Agent |
| **RAG** | Retrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆ | ä»çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯å¢å¼º AI å›ç­” |
| **Workflow** | å·¥ä½œæµï¼Œç”±å¤šä¸ª Agent ä»»åŠ¡ç»„æˆçš„æ‰§è¡Œåºåˆ— | Writer â†’ Reviewer â†’ Formatter |
| **Prompt Template** | Prompt æ¨¡æ¿ï¼Œå¯å‚æ•°åŒ–å¤ç”¨çš„æç¤ºè¯ | "è¯·æ’°å†™å…³äº {{topic}} çš„æ–‡ç« " |
| **Knowledge Base** | çŸ¥è¯†åº“ï¼Œå­˜å‚¨ä¼ä¸šæ–‡æ¡£å’ŒçŸ¥è¯† | æŠ€æœ¯æ–‡æ¡£åº“ã€äº§å“æ‰‹å†Œåº“ |
| **Embedding** | å‘é‡åµŒå…¥ï¼Œå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤º | OpenAI text-embedding-3-small |
| **pgvector** | PostgreSQL å‘é‡æ‰©å±•ï¼Œæ”¯æŒå‘é‡å­˜å‚¨å’Œæ£€ç´¢ | å­˜å‚¨ 1536 ç»´å‘é‡ |
| **Tenant** | ç§Ÿæˆ·ï¼Œå¤šç§Ÿæˆ·ç³»ç»Ÿä¸­çš„ç‹¬ç«‹å®¢æˆ· | ä¼ä¸š Aã€ä¼ä¸š B |
| **RBAC** | Role-Based Access Controlï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ | Adminã€Editorã€Viewer |

---

## 2. æ•´ä½“æ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚ï¼ˆWeb Consoleï¼‰                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Agent ç®¡ç†  â”‚  â”‚ å·¥ä½œæµç¼–æ’  â”‚  â”‚ çŸ¥è¯†åº“ç®¡ç†  â”‚  â”‚ ç›‘æ§çœ‹æ¿    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTPS / WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³å±‚ï¼ˆGin Frameworkï¼‰                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è®¤è¯æˆæƒ â”‚ é™æµ â”‚ å®¡è®¡æ—¥å¿— â”‚ å¤šç§Ÿæˆ·è·¯ç”± â”‚ è¯·æ±‚éªŒè¯           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ Internal API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä¸šåŠ¡æœåŠ¡å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Agent æœåŠ¡  â”‚  â”‚ å·¥ä½œæµæœåŠ¡  â”‚  â”‚ RAG æœåŠ¡   â”‚  â”‚ æ¨¡å‹æœåŠ¡    â”‚ â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚ â”‚
â”‚  â”‚ â€¢ Agent    â”‚  â”‚ â€¢ Workflow â”‚  â”‚ â€¢ Document â”‚  â”‚ â€¢ Model    â”‚ â”‚
â”‚  â”‚   Registry â”‚  â”‚   Engine   â”‚  â”‚   Parser   â”‚  â”‚   Adapter  â”‚ â”‚
â”‚  â”‚ â€¢ Agent    â”‚  â”‚ â€¢ Task     â”‚  â”‚ â€¢ Chunker  â”‚  â”‚ â€¢ Multi-   â”‚ â”‚
â”‚  â”‚   Executor â”‚  â”‚   Schedule â”‚  â”‚ â€¢ Vector   â”‚  â”‚   Provider â”‚ â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚   Search   â”‚  â”‚            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ è®¤è¯æœåŠ¡    â”‚  â”‚ å®¡è®¡æœåŠ¡    â”‚  â”‚ æ¨¡æ¿æœåŠ¡    â”‚                 â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚                 â”‚
â”‚  â”‚ â€¢ JWT      â”‚  â”‚ â€¢ Event    â”‚  â”‚ â€¢ Template â”‚                 â”‚
â”‚  â”‚ â€¢ OAuth2   â”‚  â”‚   Logger   â”‚  â”‚   CRUD     â”‚                 â”‚
â”‚  â”‚ â€¢ Session  â”‚  â”‚ â€¢ Query    â”‚  â”‚ â€¢ Version  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ Database / Cache / MQ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®å­˜å‚¨å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ PostgreSQL   â”‚  â”‚ Redis        â”‚  â”‚ RabbitMQ     â”‚           â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚ â€¢ ä¸šåŠ¡æ•°æ®   â”‚  â”‚ â€¢ ç¼“å­˜       â”‚  â”‚ â€¢ ä»»åŠ¡é˜Ÿåˆ—   â”‚           â”‚
â”‚  â”‚ â€¢ pgvector   â”‚  â”‚ â€¢ Session    â”‚  â”‚ â€¢ å·¥ä½œæµè°ƒåº¦ â”‚           â”‚
â”‚  â”‚   å‘é‡å­˜å‚¨   â”‚  â”‚ â€¢ åˆ†å¸ƒå¼é”   â”‚  â”‚              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡å±‚ï¼ˆAI Providersï¼‰                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ OpenAI  â”‚ â”‚ Azure   â”‚ â”‚ Google  â”‚ â”‚ AWS     â”‚ â”‚Anthropicâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚DeepSeek â”‚ â”‚ Qwen    â”‚ â”‚ Ollama  â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆ

#### åç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Go** | 1.21+ | åç«¯ä¸»è¯­è¨€ |
| **Gin** | 1.9+ | Web æ¡†æ¶ |
| **GORM** | 1.25+ | ORM æ¡†æ¶ |
| **PostgreSQL** | 14+ | ä¸»æ•°æ®åº“ |
| **pgvector** | 0.5+ | å‘é‡å­˜å‚¨æ‰©å±• |
| **Redis** | 7.0+ | ç¼“å­˜å’Œ Session |
| **RabbitMQ** | 3.12+ | æ¶ˆæ¯é˜Ÿåˆ— |
| **JWT** | - | è®¤è¯ä»¤ç‰Œ |
| **bcrypt** | - | å¯†ç åŠ å¯† |

#### å‰ç«¯æŠ€æœ¯æ ˆï¼ˆè®¡åˆ’ï¼‰
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 18+ | UI æ¡†æ¶ |
| **TypeScript** | 5+ | ç±»å‹å®‰å…¨ |
| **Ant Design** | 5+ | UI ç»„ä»¶åº“ |
| **React Flow** | 11+ | å·¥ä½œæµå¯è§†åŒ– |
| **Monaco Editor** | - | ä»£ç ç¼–è¾‘å™¨ |

#### AI æä¾›å•† SDK
- **OpenAI SDK** - GPT-4ã€GPT-3.5-turbo
- **Azure OpenAI SDK** - Azure éƒ¨ç½²çš„ OpenAI æ¨¡å‹
- **Google Gemini SDK** - Gemini Pro
- **AWS Bedrock SDK** - Claude on AWS
- **Anthropic SDK** - Claude 3 ç³»åˆ—
- **DeepSeek SDK** - DeepSeek-V2
- **Qwen SDK** - é€šä¹‰åƒé—®
- **Ollama API** - æœ¬åœ°éƒ¨ç½²æ¨¡å‹

### 2.3 æ¨¡å—åˆ’åˆ†

#### æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | èŒè´£ | ä¸»è¦ç»„ä»¶ |
|------|------|----------|
| **Agent Runtime** | Agent æ‰§è¡Œå¼•æ“ | Registryã€WriterAgentã€ReviewerAgentã€FormatterAgentã€RAGHelper |
| **AI Model** | AI æ¨¡å‹æŠ½è±¡å±‚ | ClientFactoryã€ModelAdapterã€FormatConverterã€ModelDiscovery |
| **RAG System** | çŸ¥è¯†åº“ç®¡ç† | RAGServiceã€DocumentParserã€Chunkerã€VectorSearch |
| **Workflow** | å·¥ä½œæµç¼–æ’ | Engineã€TaskSchedulerã€StateManager |
| **Auth** | è®¤è¯æˆæƒ | JWTServiceã€SessionManagerã€OAuth2Handler |
| **Audit** | å®¡è®¡æ—¥å¿— | AuditServiceã€EventLoggerã€QueryService |
| **Template** | æ¨¡æ¿ç®¡ç† | TemplateServiceã€VariableInjectorã€VersionManager |

### 2.4 éƒ¨ç½²æ¶æ„

#### å¼€å‘ç¯å¢ƒ
```
å•æœºéƒ¨ç½²ï¼ˆDocker Composeï¼‰
â”œâ”€â”€ Backend (Go)          :8080
â”œâ”€â”€ PostgreSQL            :5432
â”œâ”€â”€ Redis                 :6379
â”œâ”€â”€ RabbitMQ             :5672
â””â”€â”€ Frontend (React)      :3000
```

#### ç”Ÿäº§ç¯å¢ƒï¼ˆKubernetesï¼‰
```
Kubernetes Cluster
â”œâ”€â”€ Backend Pods (3 replicas)
â”œâ”€â”€ PostgreSQL (StatefulSet)
â”œâ”€â”€ Redis (StatefulSet)
â”œâ”€â”€ RabbitMQ (StatefulSet)
â”œâ”€â”€ Nginx Ingress
â””â”€â”€ Frontend (Static CDN)
```

---

## 3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 3.1 å¤š Agent åä½œç³»ç»Ÿ

#### 3.1.1 Agent ç±»å‹å®šä¹‰

å¹³å°æ”¯æŒ **8 ç§ä¸“ä¸šåŒ– Agent**ï¼š

| Agent ç±»å‹ | èŒè´£ | å…¸å‹åœºæ™¯ | ä½¿ç”¨æ¨¡å‹å»ºè®® | RAG æ”¯æŒ |
|-----------|------|---------|-------------|---------|
| **ğŸ“ Writer** | å†…å®¹åˆ›ä½œ | æ–‡ç« å†™ä½œã€è¥é”€æ–‡æ¡ˆã€äº§å“æè¿° | GPT-4 / Claude 3.5 Sonnet | âœ… å·²æ”¯æŒ |
| **âœï¸ Reviewer** | å†…å®¹å®¡æ ¡ | è¯­æ³•æ£€æŸ¥ã€äº‹å®æ ¸æŸ¥ã€é£æ ¼ç»Ÿä¸€ | GPT-4 / Claude 3 Opus | âœ… å·²æ”¯æŒ |
| **ğŸ¨ Formatter** | æ ¼å¼åŒ– | Markdown è½¬æ¢ã€æ’ç‰ˆä¼˜åŒ– | GPT-3.5 / Claude 3 Haiku | âœ… å·²æ”¯æŒ |
| **ğŸ¯ Planner** | ä»»åŠ¡è§„åˆ’ | æ‹†è§£å¤æ‚ä»»åŠ¡ã€ç”Ÿæˆå¤§çº² | GPT-4 / Claude 3.5 Sonnet | â³ è§„åˆ’ä¸­ |
| **ğŸŒ Translator** | å¤šè¯­è¨€ç¿»è¯‘ | æ–‡æ¡£ç¿»è¯‘ã€æœ¬åœ°åŒ– | GPT-4 / Claude 3.5 Sonnet | â³ è§„åˆ’ä¸­ |
| **ğŸ“Š Analyzer** | æ•°æ®åˆ†æ | å†…å®¹è´¨é‡è¯„ä¼°ã€SEO åˆ†æ | GPT-4 / Claude 3 Opus | â³ è§„åˆ’ä¸­ |
| **ğŸ” Researcher** | ä¿¡æ¯æ£€ç´¢ | RAG çŸ¥è¯†åº“æŸ¥è¯¢ã€ç½‘ç»œæœç´¢ | GPT-3.5 + RAG | â³ è§„åˆ’ä¸­ |
| **ğŸ”„ Rewriter** | å†…å®¹é‡å†™ | é£æ ¼è½¬æ¢ã€é•¿åº¦è°ƒæ•´ã€ç»“æ„ä¼˜åŒ– | GPT-3.5 / Claude 3 Haiku | â³ è§„åˆ’ä¸­ |

#### 3.1.2 Agent èƒ½åŠ›çŸ©é˜µ

| èƒ½åŠ› | Writer | Reviewer | Formatter | Planner | Translator | Analyzer | Researcher |
|------|--------|----------|-----------|---------|------------|----------|------------|
| **æ–‡æœ¬ç”Ÿæˆ** | â­â­â­â­â­ | â­â­ | â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­ | â­â­â­ |
| **æ–‡æœ¬åˆ†æ** | â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **ç»“æ„åŒ–å¤„ç†** | â­â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­ | â­â­ |
| **çŸ¥è¯†æ£€ç´¢** | â­â­ | â­â­â­ | â­ | â­â­ | â­â­ | â­â­â­ | â­â­â­â­â­ |
| **RAG å¢å¼º** | âœ… | âœ… | âœ… | â³ | â³ | â³ | âœ… |

#### 3.1.3 Agent ç¼–æ’æ¨¡å¼

**1. çº¿æ€§æµç¨‹ï¼ˆSequentialï¼‰**
```
Writer â†’ Reviewer â†’ Formatter â†’ Output
```
- é€‚ç”¨åœºæ™¯ï¼šæ ‡å‡†å†…å®¹ç”Ÿäº§æµç¨‹
- æ‰§è¡Œæ–¹å¼ï¼šä¸²è¡Œæ‰§è¡Œï¼Œä¸Šä¸€æ­¥å®Œæˆåæ‰æ‰§è¡Œä¸‹ä¸€æ­¥
- å¤±è´¥å¤„ç†ï¼šä»»ä¸€æ­¥å¤±è´¥åˆ™æ•´ä¸ªæµç¨‹å¤±è´¥

**2. å¹¶è¡Œæ‰§è¡Œï¼ˆParallelï¼‰**
```
         â”Œâ”€ Writer 1 (Chapter 1) â”€â”
Input â”€â†’ â”œâ”€ Writer 2 (Chapter 2) â”€â”¤ â†’ Merge â†’ Output
         â””â”€ Writer 3 (Chapter 3) â”€â”˜
```
- é€‚ç”¨åœºæ™¯ï¼šå¤šç« èŠ‚å¹¶è¡Œåˆ›ä½œ
- æ‰§è¡Œæ–¹å¼ï¼šåŒæ—¶æ‰§è¡Œå¤šä¸ª Agent
- å¤±è´¥å¤„ç†ï¼šéƒ¨åˆ†å¤±è´¥ä¸å½±å“å…¶ä»–åˆ†æ”¯

**3. æ¡ä»¶åˆ†æ”¯ï¼ˆConditionalï¼‰**
```
Writer â†’ Reviewer â†’ [Score >= 80?] â”€Yesâ†’ Formatter â†’ Output
                           â”‚
                           â””â”€Noâ†’ Rewriter â†’ Reviewer
```
- é€‚ç”¨åœºæ™¯ï¼šè´¨é‡æ§åˆ¶æµç¨‹
- æ‰§è¡Œæ–¹å¼ï¼šæ ¹æ®æ¡ä»¶é€‰æ‹©æ‰§è¡Œè·¯å¾„
- å¤±è´¥å¤„ç†ï¼šæ”¯æŒé‡è¯•å’Œå›æ»š

**4. äººå·¥å®¡æ ¸ï¼ˆHuman-in-the-Loopï¼‰**
```
Writer â†’ [Human Review] â†’ Formatter â†’ Output
```
- é€‚ç”¨åœºæ™¯ï¼šæ•æ„Ÿå†…å®¹æˆ–å…³é”®å†³ç­–
- æ‰§è¡Œæ–¹å¼ï¼šç­‰å¾…äººå·¥ç¡®è®¤åç»§ç»­
- å¤±è´¥å¤„ç†ï¼šäººå·¥æ‹’ç»åˆ™ç»ˆæ­¢æµç¨‹

### 3.2 AI æ¨¡å‹ç®¡ç†

#### 3.2.1 å¤šæä¾›å•†æ”¯æŒ

å¹³å°æ”¯æŒ **8 ä¸ª AI æä¾›å•†**ï¼š

| æä¾›å•† | æ”¯æŒæ¨¡å‹ | API ç±»å‹ | çŠ¶æ€ |
|--------|---------|---------|------|
| **OpenAI** | GPT-4ã€GPT-3.5-turboã€text-embedding-3-small | REST API | âœ… å®Œæˆ |
| **Azure OpenAI** | GPT-4ã€GPT-3.5-turboï¼ˆAzure éƒ¨ç½²ï¼‰ | REST API | âœ… å®Œæˆ |
| **Google** | Gemini Proã€Gemini Pro Vision | REST API | âœ… å®Œæˆ |
| **AWS Bedrock** | Claude on AWSã€Titan | SDK | âœ… å®Œæˆ |
| **Anthropic** | Claude 3 Opus/Sonnet/Haiku | REST API | âœ… å®Œæˆ |
| **DeepSeek** | DeepSeek-V2ã€DeepSeek-Coder | REST API | âœ… å®Œæˆ |
| **Qwen** | Qwen-Maxã€Qwen-Plusã€Qwen-Turbo | REST API | âœ… å®Œæˆ |
| **Ollama** | Llama 3ã€Mistralã€æœ¬åœ°éƒ¨ç½²æ¨¡å‹ | Local API | âœ… å®Œæˆ |

#### 3.2.2 æ¨¡å‹é…ç½®ç®¡ç†

**æ¨¡å‹é…ç½®æ•°æ®æ¨¡å‹**:
```go
type ModelConfig struct {
    ID             string    // æ¨¡å‹é…ç½® ID
    TenantID       string    // ç§Ÿæˆ· ID
    Provider       string    // æä¾›å•†ï¼ˆopenai/azure/googleç­‰ï¼‰
    Name           string    // æ¨¡å‹åç§°
    ModelID        string    // æä¾›å•†æ¨¡å‹ ID
    APIKey         string    // API å¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
    APIEndpoint    string    // API ç«¯ç‚¹
    DeploymentName string    // éƒ¨ç½²åç§°ï¼ˆAzureï¼‰
    MaxTokens      int       // æœ€å¤§ Token æ•°
    Temperature    float64   // æ¸©åº¦å‚æ•°
    Status         string    // çŠ¶æ€ï¼ˆactive/disabledï¼‰
    ExtraConfig    map[string]any // æ‰©å±•é…ç½®
}
```

**åŠŸèƒ½**:
- âœ… æ¨¡å‹ CRUD æ“ä½œ
- âœ… æ¨¡å‹å‘ç°ï¼ˆè‡ªåŠ¨æ¢æµ‹å¯ç”¨æ¨¡å‹ï¼‰
- âœ… æ¨¡å‹è·¯ç”±ï¼ˆæ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©æœ€ä½³æ¨¡å‹ï¼‰
- âœ… æ ¼å¼è½¬æ¢ï¼ˆç»Ÿä¸€ä¸åŒæä¾›å•†çš„è¯·æ±‚/å“åº”æ ¼å¼ï¼‰
- â³ æ¨¡å‹æ€§èƒ½ç›‘æ§
- â³ æ¨¡å‹æˆæœ¬åˆ†æ

#### 3.2.3 æ¨¡å‹é€‚é…å™¨æ¶æ„

```go
// ç»Ÿä¸€æ¨¡å‹å®¢æˆ·ç«¯æ¥å£
type ModelClient interface {
    ChatCompletion(ctx context.Context, req *ChatCompletionRequest) (*ChatCompletionResponse, error)
    ChatCompletionStream(ctx context.Context, req *ChatCompletionRequest) (<-chan StreamChunk, <-chan error)
    GetModelInfo(ctx context.Context) (*ModelInfo, error)
}

// æä¾›å•†é€‚é…å™¨
- OpenAIAdapter
- AzureOpenAIAdapter
- GoogleAdapter
- AWSBedrockAdapter
- AnthropicAdapter
- DeepSeekAdapter
- QwenAdapter
- OllamaAdapter
```

**ä¼˜åŠ¿**:
- ä¸Šå±‚ä¸šåŠ¡ä»£ç ä¸å…·ä½“æä¾›å•†è§£è€¦
- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢æ¨¡å‹
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- æ”¯æŒå¤šæä¾›å•†å¹¶å‘è°ƒç”¨ï¼ˆå†—ä½™å¤‡ä»½ï¼‰

### 3.3 RAG çŸ¥è¯†åº“ç³»ç»Ÿ

> â­ **æ ¸å¿ƒåŠŸèƒ½æ¨¡å—** - è¯¦ç»†è®¾è®¡è§ [ç¬¬ 6 ç« ](#6-rag-çŸ¥è¯†åº“è¯¦ç»†è®¾è®¡)

#### 3.3.1 åŠŸèƒ½æ¦‚è¿°

RAGï¼ˆRetrieval-Augmented Generationï¼‰çŸ¥è¯†åº“ç³»ç»Ÿæ˜¯å¹³å°çš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€ï¼Œæ”¯æŒï¼š

- **çŸ¥è¯†åº“ç®¡ç†** - åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤çŸ¥è¯†åº“
- **æ–‡æ¡£å¤„ç†** - ä¸Šä¼ ã€è§£æã€åˆ†å—ã€å‘é‡åŒ–
- **è¯­ä¹‰æ£€ç´¢** - åŸºäº pgvector çš„ä½™å¼¦ç›¸ä¼¼åº¦æ£€ç´¢
- **Agent é›†æˆ** - Writerã€Reviewerã€Formatter è‡ªåŠ¨ä½¿ç”¨çŸ¥è¯†åº“å¢å¼º

#### 3.3.2 æ ¸å¿ƒæµç¨‹

```
æ–‡æ¡£ä¸Šä¼  â†’ è§£æ â†’ åˆ†å— â†’ å‘é‡åŒ– â†’ å­˜å‚¨ï¼ˆpgvectorï¼‰
                                           â†“
                                        å‘é‡ç´¢å¼•ï¼ˆHNSWï¼‰
                                           â†“
æŸ¥è¯¢é—®é¢˜ â†’ å‘é‡åŒ– â†’ æ£€ç´¢ TopK â†’ é‡æ’åº â†’ è¿”å›ç›¸å…³ç‰‡æ®µ
                                           â†“
                                     æ³¨å…¥åˆ° Agent Prompt
```

#### 3.3.3 æŠ€æœ¯äº®ç‚¹

- **pgvector å‘é‡å­˜å‚¨** - æ”¯æŒ 1536 ç»´å‘é‡ï¼ŒHNSW ç´¢å¼•
- **å¤šæ ¼å¼æ”¯æŒ** - TXTã€Markdownã€HTMLï¼ˆå¯æ‰©å±• PDFã€DOCXï¼‰
- **æ™ºèƒ½åˆ†å—** - é€’å½’å­—ç¬¦åˆ†å—ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´æ€§
- **Agent é€æ˜é›†æˆ** - è‡ªåŠ¨æ£€ç´¢å’Œæ³¨å…¥ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 

### 3.4 Prompt æ¨¡æ¿ç®¡ç†

#### 3.4.1 åŠŸèƒ½æ¦‚è¿°

Prompt æ¨¡æ¿ç³»ç»Ÿæ”¯æŒå°†æˆåŠŸçš„ Prompt æ²‰æ·€ä¸ºå¯å¤ç”¨çš„æ¨¡æ¿ï¼š

- **æ¨¡æ¿ CRUD** - åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤æ¨¡æ¿
- **å˜é‡æ³¨å…¥** - æ”¯æŒ `{{variable}}` å ä½ç¬¦
- **ç‰ˆæœ¬ç®¡ç†** - æ”¯æŒæ¨¡æ¿ç‰ˆæœ¬è¿­ä»£
- **å¯è§æ€§æ§åˆ¶** - ä¸ªäºº/ç§Ÿæˆ·/å¹³å°çº§

#### 3.4.2 æ¨¡æ¿æ•°æ®æ¨¡å‹

```go
type PromptTemplate struct {
    ID          string         // æ¨¡æ¿ ID
    TenantID    string         // ç§Ÿæˆ· ID
    Name        string         // æ¨¡æ¿åç§°
    Category    string         // ç±»åˆ«ï¼ˆwriting/review/formatç­‰ï¼‰
    Template    string         // æ¨¡æ¿å†…å®¹
    Variables   []string       // å˜é‡åˆ—è¡¨
    Description string         // æè¿°
    Version     int            // ç‰ˆæœ¬å·
    Visibility  string         // å¯è§æ€§ï¼ˆprivate/tenant/publicï¼‰
    UsageCount  int            // ä½¿ç”¨æ¬¡æ•°
    Tags        []string       // æ ‡ç­¾
    CreatedBy   string         // åˆ›å»ºè€…
}
```

#### 3.4.3 ä½¿ç”¨ç¤ºä¾‹

**æ¨¡æ¿å®šä¹‰**:
```
è¯·æ’°å†™ä¸€ç¯‡å…³äº {{topic}} çš„æ–‡ç« ï¼Œ
å­—æ•°è¦æ±‚ï¼š{{word_count}} å­—
é£æ ¼ï¼š{{style}}
ç›®æ ‡è¯»è€…ï¼š{{audience}}
```

**å˜é‡æ³¨å…¥**:
```go
variables := map[string]any{
    "topic": "äººå·¥æ™ºèƒ½",
    "word_count": 1000,
    "style": "ä¸“ä¸š",
    "audience": "æŠ€æœ¯äººå‘˜",
}
```

**æ¸²æŸ“ç»“æœ**:
```
è¯·æ’°å†™ä¸€ç¯‡å…³äºäººå·¥æ™ºèƒ½çš„æ–‡ç« ï¼Œ
å­—æ•°è¦æ±‚ï¼š1000 å­—
é£æ ¼ï¼šä¸“ä¸š
ç›®æ ‡è¯»è€…ï¼šæŠ€æœ¯äººå‘˜
```

### 3.5 å·¥ä½œæµç¼–æ’

#### 3.5.1 å·¥ä½œæµå®šä¹‰

å·¥ä½œæµä½¿ç”¨ **YAML** å®šä¹‰ï¼š

```yaml
name: "æ–‡ç« åˆ›ä½œå®¡æ ¡æµç¨‹"
description: "å®Œæ•´çš„æ–‡ç« ç”Ÿäº§æµç¨‹"
version: "1.0"

steps:
  - id: "write"
    type: "agent"
    agent_type: "writer"
    input:
      content: "{{topic}}"
      template_id: "{{writing_template}}"
    output_key: "draft"

  - id: "review"
    type: "agent"
    agent_type: "reviewer"
    depends_on: ["write"]
    input:
      content: "{{steps.write.output}}"
    output_key: "review_result"

  - id: "format"
    type: "agent"
    agent_type: "formatter"
    depends_on: ["review"]
    input:
      content: "{{steps.review.output}}"
      format: "markdown"
    output_key: "final_output"
```

#### 3.5.2 å·¥ä½œæµå¼•æ“

**æ ¸å¿ƒç»„ä»¶**:
- **Parser** - è§£æ YAML/JSON å·¥ä½œæµå®šä¹‰
- **Scheduler** - ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆæ”¯æŒä¸²è¡Œ/å¹¶è¡Œï¼‰
- **StateManager** - çŠ¶æ€ç®¡ç†ï¼ˆè®°å½•æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡ŒçŠ¶æ€ï¼‰
- **ErrorHandler** - é”™è¯¯å¤„ç†å’Œé‡è¯•

**æ‰§è¡Œæµç¨‹**:
```
1. è§£æå·¥ä½œæµå®šä¹‰
2. æ„å»º DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰
3. æ‹“æ‰‘æ’åºç¡®å®šæ‰§è¡Œé¡ºåº
4. è°ƒåº¦æ‰§è¡Œæ¯ä¸ªæ­¥éª¤
5. è®°å½•æ‰§è¡ŒçŠ¶æ€å’Œç»“æœ
6. å¤„ç†å¤±è´¥å’Œé‡è¯•
```

### 3.6 è®¤è¯æˆæƒç³»ç»Ÿ

#### 3.6.1 è®¤è¯æ–¹å¼

å¹³å°æ”¯æŒ **3 ç§è®¤è¯æ–¹å¼**ï¼š

| è®¤è¯æ–¹å¼ | ä½¿ç”¨åœºæ™¯ | Token æœ‰æ•ˆæœŸ | çŠ¶æ€ |
|---------|---------|------------|------|
| **JWT** | API è°ƒç”¨ | 2 å°æ—¶ | âœ… å®Œæˆ |
| **Session** | Web æ§åˆ¶å° | 7 å¤© | âœ… å®Œæˆ |
| **OAuth2** | ç¬¬ä¸‰æ–¹é›†æˆ | åŠ¨æ€ | âœ… å®Œæˆ |

#### 3.6.2 å¤šç§Ÿæˆ·éš”ç¦»

**ç§Ÿæˆ·æ•°æ®æ¨¡å‹**:
```go
type Tenant struct {
    ID       string    // ç§Ÿæˆ· ID
    Name     string    // ç§Ÿæˆ·åç§°
    Domain   string    // åŸŸå
    Plan     string    // å¥—é¤ï¼ˆfree/pro/enterpriseï¼‰
    Status   string    // çŠ¶æ€ï¼ˆactive/suspendedï¼‰
    Settings map[string]any // è®¾ç½®
}
```

**éš”ç¦»ç­–ç•¥**:
- æ‰€æœ‰æ•°æ®è¡¨åŒ…å« `tenant_id` å­—æ®µ
- API è¯·æ±‚è‡ªåŠ¨æ³¨å…¥ç§Ÿæˆ·ä¸Šä¸‹æ–‡
- æ•°æ®åº“æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·
- è·¨ç§Ÿæˆ·è®¿é—®ä¸¥æ ¼ç¦æ­¢

#### 3.6.3 RBAC æƒé™æ§åˆ¶

**è§’è‰²å®šä¹‰**:
| è§’è‰² | æƒé™ | é€‚ç”¨äººå‘˜ |
|------|------|---------|
| **Admin** | å…¨éƒ¨æƒé™ | ç³»ç»Ÿç®¡ç†å‘˜ |
| **Editor** | åˆ›å»º/ç¼–è¾‘å†…å®¹ | å†…å®¹ç¼–è¾‘ |
| **Viewer** | åªè¯»æƒé™ | æŸ¥çœ‹è€… |
| **Guest** | æœ‰é™è®¿é—® | ä¸´æ—¶è®¿å®¢ |

**æƒé™çŸ©é˜µ**:
```
Resource: Agent
- Create:  Admin, Editor
- Read:    Admin, Editor, Viewer
- Update:  Admin, Editor
- Delete:  Admin

Resource: Knowledge Base
- Create:  Admin, Editor
- Read:    Admin, Editor, Viewer
- Update:  Admin, Editor
- Delete:  Admin
```

### 3.7 å®¡è®¡æ—¥å¿—ç³»ç»Ÿ

#### 3.7.1 å®¡è®¡äº‹ä»¶ç±»å‹

å¹³å°è®°å½• **40+ å®¡è®¡äº‹ä»¶ç±»å‹**ï¼Œåˆ†ä¸º 7 å¤§ç±»ï¼š

| ç±»åˆ« | äº‹ä»¶æ•°é‡ | å…¸å‹äº‹ä»¶ |
|------|---------|---------|
| **è®¤è¯** | 8 | ç™»å½•ã€ç™»å‡ºã€æ³¨å†Œã€å¯†ç ä¿®æ”¹ |
| **Agent** | 8 | Agent åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€æ‰§è¡Œ |
| **å·¥ä½œæµ** | 6 | å·¥ä½œæµåˆ›å»ºã€å¯åŠ¨ã€æš‚åœã€å®Œæˆ |
| **æ¨¡å‹** | 6 | æ¨¡å‹æ·»åŠ ã€æ›´æ–°ã€åˆ é™¤ã€è°ƒç”¨ |
| **çŸ¥è¯†åº“** | 8 | çŸ¥è¯†åº“åˆ›å»ºã€æ–‡æ¡£ä¸Šä¼ ã€æ£€ç´¢ |
| **æ¨¡æ¿** | 4 | æ¨¡æ¿åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€ä½¿ç”¨ |
| **ç³»ç»Ÿ** | 6 | é…ç½®ä¿®æ”¹ã€æƒé™å˜æ›´ã€æ•°æ®å¯¼å‡º |

#### 3.7.2 å®¡è®¡æ—¥å¿—æ•°æ®æ¨¡å‹

```go
type AuditLog struct {
    ID         string         // æ—¥å¿— ID
    TenantID   string         // ç§Ÿæˆ· ID
    UserID     string         // ç”¨æˆ· ID
    EventType  string         // äº‹ä»¶ç±»å‹
    ResourceType string       // èµ„æºç±»å‹
    ResourceID string         // èµ„æº ID
    Action     string         // æ“ä½œï¼ˆcreate/read/update/deleteï¼‰
    IPAddress  string         // IP åœ°å€
    UserAgent  string         // User Agent
    Metadata   map[string]any // å…ƒæ•°æ®
    Timestamp  time.Time      // æ—¶é—´æˆ³
}
```

#### 3.7.3 æŸ¥è¯¢ä¸è¿‡æ»¤

**æ”¯æŒçš„è¿‡æ»¤æ¡ä»¶**:
- æ—¶é—´èŒƒå›´
- ç”¨æˆ· ID
- äº‹ä»¶ç±»å‹
- èµ„æºç±»å‹
- æ“ä½œç±»å‹
- IP åœ°å€

**æŸ¥è¯¢ç¤ºä¾‹**:
```
GET /api/audit-logs?
    start_time=2025-11-01T00:00:00Z&
    end_time=2025-11-17T23:59:59Z&
    user_id=user-123&
    event_type=agent_execute&
    page=1&
    per_page=20
```

---

## 4. æ•°æ®æ¨¡å‹

### 4.1 æ ¸å¿ƒå®ä½“å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tenant   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    User    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    Role    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚                       â”‚
      â”‚                      â”‚                       â”‚
      â–¼                      â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚AgentConfig â”‚         â”‚  Workflow  â”‚         â”‚ Permission â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚
      â”‚                      â”‚
      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ModelConfig â”‚         â”‚  Session   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚
      â”‚                      â”‚
      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚KnowledgeBaseâ—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Document  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚
      â”‚                      â”‚
      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PromptTemplate        â”‚DocumentChunk
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ + vector   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ•°æ®åº“è¡¨è®¾è®¡

#### æ ¸å¿ƒè¡¨åˆ—è¡¨ï¼ˆå…± 13 å¼ è¡¨ï¼‰

| è¡¨å | è¡Œæ•°ï¼ˆä¼°è®¡ï¼‰ | ä¸»è¦å­—æ®µ | ç´¢å¼• |
|------|-------------|---------|------|
| `tenants` | 1,000 | id, name, domain, plan | id(PK), domain(UK) |
| `users` | 10,000 | id, tenant_id, email, password_hash | id(PK), email(UK), tenant_id(IDX) |
| `sessions` | 50,000 | id, user_id, token, expires_at | id(PK), token(UK), user_id(IDX) |
| `agent_configs` | 5,000 | id, tenant_id, agent_type, model_id, **knowledge_base_id**, **rag_enabled** | id(PK), tenant_id(IDX), agent_type(IDX) |
| `model_configs` | 1,000 | id, tenant_id, provider, model_id, api_key | id(PK), tenant_id(IDX), provider(IDX) |
| `prompt_templates` | 10,000 | id, tenant_id, name, template, variables | id(PK), tenant_id(IDX), category(IDX) |
| `workflows` | 5,000 | id, tenant_id, name, definition, status | id(PK), tenant_id(IDX), status(IDX) |
| `workflow_executions` | 100,000 | id, workflow_id, status, result | id(PK), workflow_id(IDX), status(IDX) |
| `knowledge_bases` | 1,000 | id, tenant_id, name, type, document_count | id(PK), tenant_id(IDX), type(IDX) |
| `documents` | 100,000 | id, kb_id, filename, status, chunk_count | id(PK), kb_id(IDX), status(IDX) |
| `document_chunks` | 1,000,000 | id, document_id, content, **vector(1536)**, score | id(PK), document_id(IDX), **vector(HNSW)** |
| `audit_logs` | 10,000,000 | id, tenant_id, user_id, event_type, timestamp | id(PK), tenant_id(IDX), event_type(IDX), timestamp(IDX) |
| `roles_permissions` | 100 | role_id, permission_id | (role_id, permission_id)(PK) |

### 4.3 pgvector å‘é‡å­˜å‚¨è®¾è®¡

#### å‘é‡å­—æ®µé…ç½®

```sql
CREATE TABLE document_chunks (
    id UUID PRIMARY KEY,
    document_id UUID NOT NULL,
    content TEXT NOT NULL,
    vector vector(1536),  -- OpenAI text-embedding-3-small
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

-- åˆ›å»º HNSW ç´¢å¼•ï¼ˆä½™å¼¦è·ç¦»ï¼‰
CREATE INDEX idx_chunks_vector ON document_chunks 
USING hnsw (vector vector_cosine_ops);
```

#### å‘é‡æ£€ç´¢æŸ¥è¯¢

```sql
-- è¯­ä¹‰æ£€ç´¢ TopK
SELECT 
    id,
    content,
    1 - (vector <=> $1::vector) AS score
FROM document_chunks
WHERE kb_id = $2
ORDER BY vector <=> $1::vector
LIMIT $3;
```

**å‚æ•°è¯´æ˜**:
- `$1`: æŸ¥è¯¢å‘é‡ï¼ˆ1536 ç»´ï¼‰
- `$2`: çŸ¥è¯†åº“ ID
- `$3`: TopK æ•°é‡

---

## 5. API è®¾è®¡

### 5.1 API ç«¯ç‚¹åˆ—è¡¨ï¼ˆ63+ ç«¯ç‚¹ï¼‰

#### 5.1.1 è®¤è¯æˆæƒï¼ˆ9 ä¸ªç«¯ç‚¹ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| POST | `/api/auth/register` | ç”¨æˆ·æ³¨å†Œ | âœ… |
| POST | `/api/auth/login` | ç”¨æˆ·ç™»å½• | âœ… |
| POST | `/api/auth/logout` | ç”¨æˆ·ç™»å‡º | âœ… |
| POST | `/api/auth/refresh` | åˆ·æ–° Token | âœ… |
| POST | `/api/auth/oauth2/google` | Google OAuth2 | âœ… |
| POST | `/api/auth/oauth2/github` | GitHub OAuth2 | âœ… |
| GET | `/api/auth/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | âœ… |
| PUT | `/api/auth/password` | ä¿®æ”¹å¯†ç  | âœ… |
| DELETE | `/api/auth/sessions/:id` | åˆ é™¤ä¼šè¯ | âœ… |

#### 5.1.2 Agent ç®¡ç†ï¼ˆ8 ä¸ªç«¯ç‚¹ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| POST | `/api/agents` | åˆ›å»º Agent é…ç½® | âœ… |
| GET | `/api/agents` | è·å– Agent åˆ—è¡¨ | âœ… |
| GET | `/api/agents/:id` | è·å– Agent è¯¦æƒ… | âœ… |
| PUT | `/api/agents/:id` | æ›´æ–° Agent é…ç½® | âœ… |
| DELETE | `/api/agents/:id` | åˆ é™¤ Agent é…ç½® | âœ… |
| POST | `/api/agents/:id/execute` | æ‰§è¡Œ Agentï¼ˆéæµå¼ï¼‰ | âœ… |
| POST | `/api/agents/:id/execute/stream` | æ‰§è¡Œ Agentï¼ˆæµå¼ï¼‰ | âœ… |
| GET | `/api/agents/types` | è·å–æ”¯æŒçš„ Agent ç±»å‹ | âœ… |

#### 5.1.3 AI æ¨¡å‹ï¼ˆ7 ä¸ªç«¯ç‚¹ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| POST | `/api/models` | æ·»åŠ æ¨¡å‹é…ç½® | âœ… |
| GET | `/api/models` | è·å–æ¨¡å‹åˆ—è¡¨ | âœ… |
| GET | `/api/models/:id` | è·å–æ¨¡å‹è¯¦æƒ… | âœ… |
| PUT | `/api/models/:id` | æ›´æ–°æ¨¡å‹é…ç½® | âœ… |
| DELETE | `/api/models/:id` | åˆ é™¤æ¨¡å‹é…ç½® | âœ… |
| POST | `/api/models/:id/test` | æµ‹è¯•æ¨¡å‹è¿æ¥ | âœ… |
| POST | `/api/models/discover` | æ¨¡å‹å‘ç° | âœ… |

#### 5.1.4 RAG çŸ¥è¯†åº“ï¼ˆ13 ä¸ªç«¯ç‚¹ï¼‰â­

| æ–¹æ³• | è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| POST | `/api/knowledge-bases` | åˆ›å»ºçŸ¥è¯†åº“ | âœ… |
| GET | `/api/knowledge-bases` | è·å–çŸ¥è¯†åº“åˆ—è¡¨ | âœ… |
| GET | `/api/knowledge-bases/:id` | è·å–çŸ¥è¯†åº“è¯¦æƒ… | âœ… |
| PUT | `/api/knowledge-bases/:id` | æ›´æ–°çŸ¥è¯†åº“ | âœ… |
| DELETE | `/api/knowledge-bases/:id` | åˆ é™¤çŸ¥è¯†åº“ | âœ… |
| POST | `/api/knowledge-bases/:id/documents` | ä¸Šä¼ æ–‡æ¡£ | âœ… |
| GET | `/api/knowledge-bases/:id/documents` | è·å–æ–‡æ¡£åˆ—è¡¨ | âœ… |
| GET | `/api/documents/:id` | è·å–æ–‡æ¡£è¯¦æƒ… | âœ… |
| DELETE | `/api/documents/:id` | åˆ é™¤æ–‡æ¡£ | âœ… |
| POST | `/api/documents/:id/reprocess` | é‡æ–°å¤„ç†æ–‡æ¡£ | âœ… |
| POST | `/api/documents/:id/chunks` | è·å–æ–‡æ¡£åˆ†å— | âœ… |
| POST | `/api/knowledge-bases/:id/search` | è¯­ä¹‰æ£€ç´¢ | âœ… |
| POST | `/api/knowledge-bases/:id/context` | è·å–ä¸Šä¸‹æ–‡ï¼ˆä¾› Agent ä½¿ç”¨ï¼‰ | âœ… |

#### 5.1.5 Prompt æ¨¡æ¿ï¼ˆ6 ä¸ªç«¯ç‚¹ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| POST | `/api/templates` | åˆ›å»ºæ¨¡æ¿ | âœ… |
| GET | `/api/templates` | è·å–æ¨¡æ¿åˆ—è¡¨ | âœ… |
| GET | `/api/templates/:id` | è·å–æ¨¡æ¿è¯¦æƒ… | âœ… |
| PUT | `/api/templates/:id` | æ›´æ–°æ¨¡æ¿ | âœ… |
| DELETE | `/api/templates/:id` | åˆ é™¤æ¨¡æ¿ | âœ… |
| POST | `/api/templates/:id/render` | æ¸²æŸ“æ¨¡æ¿ | âœ… |

#### 5.1.6 å·¥ä½œæµï¼ˆ8 ä¸ªç«¯ç‚¹ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| POST | `/api/workflows` | åˆ›å»ºå·¥ä½œæµ | âœ… |
| GET | `/api/workflows` | è·å–å·¥ä½œæµåˆ—è¡¨ | âœ… |
| GET | `/api/workflows/:id` | è·å–å·¥ä½œæµè¯¦æƒ… | âœ… |
| PUT | `/api/workflows/:id` | æ›´æ–°å·¥ä½œæµ | âœ… |
| DELETE | `/api/workflows/:id` | åˆ é™¤å·¥ä½œæµ | âœ… |
| POST | `/api/workflows/:id/execute` | æ‰§è¡Œå·¥ä½œæµ | âœ… |
| GET | `/api/workflows/:id/executions` | è·å–æ‰§è¡Œè®°å½• | âœ… |
| GET | `/api/executions/:id` | è·å–æ‰§è¡Œè¯¦æƒ… | âœ… |

#### 5.1.7 å®¡è®¡æ—¥å¿—ï¼ˆ4 ä¸ªç«¯ç‚¹ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| GET | `/api/audit-logs` | è·å–å®¡è®¡æ—¥å¿—åˆ—è¡¨ | âœ… |
| GET | `/api/audit-logs/:id` | è·å–æ—¥å¿—è¯¦æƒ… | âœ… |
| GET | `/api/audit-logs/stats` | è·å–ç»Ÿè®¡ä¿¡æ¯ | âœ… |
| POST | `/api/audit-logs/export` | å¯¼å‡ºæ—¥å¿— | âœ… |

#### 5.1.8 ç§Ÿæˆ·ç®¡ç†ï¼ˆ4 ä¸ªç«¯ç‚¹ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| POST | `/api/tenants` | åˆ›å»ºç§Ÿæˆ· | âœ… |
| GET | `/api/tenants/:id` | è·å–ç§Ÿæˆ·ä¿¡æ¯ | âœ… |
| PUT | `/api/tenants/:id` | æ›´æ–°ç§Ÿæˆ·é…ç½® | âœ… |
| GET | `/api/tenants/:id/stats` | è·å–ç§Ÿæˆ·ç»Ÿè®¡ | âœ… |

### 5.2 è®¤è¯æ–¹å¼

#### JWT Token è®¤è¯
```
Authorization: Bearer <JWT_TOKEN>
```

#### Session è®¤è¯
```
Cookie: session_id=<SESSION_ID>
```

### 5.3 è¯·æ±‚/å“åº”æ ¼å¼

#### ç»Ÿä¸€å“åº”æ ¼å¼

```json
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ",
  "code": 200
}
```

#### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "success": false,
  "error": "é”™è¯¯è¯¦æƒ…",
  "message": "æ“ä½œå¤±è´¥",
  "code": 400
}
```

### 5.4 é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ | HTTP çŠ¶æ€ç  |
|--------|------|------------|
| 200 | æˆåŠŸ | 200 |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | 400 |
| 401 | æœªè®¤è¯ | 401 |
| 403 | æƒé™ä¸è¶³ | 403 |
| 404 | èµ„æºä¸å­˜åœ¨ | 404 |
| 409 | èµ„æºå†²çª | 409 |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ | 429 |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | 500 |
| 503 | æœåŠ¡ä¸å¯ç”¨ | 503 |

---

## 6. RAG çŸ¥è¯†åº“è¯¦ç»†è®¾è®¡

> â­ **æœ¬ç« èŠ‚è¯¦ç»†ä»‹ç» RAG çŸ¥è¯†åº“ç³»ç»Ÿçš„å®Œæ•´è®¾è®¡**

### 6.1 åŠŸèƒ½æ¦‚è¿°

RAGï¼ˆRetrieval-Augmented Generationï¼‰çŸ¥è¯†åº“ç³»ç»Ÿæ˜¯å¹³å°çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå®ç°ï¼š

1. **çŸ¥è¯†åº“ç®¡ç†** - æ”¯æŒå¤šä¸ªç‹¬ç«‹çŸ¥è¯†åº“ï¼Œç§Ÿæˆ·çº§éš”ç¦»
2. **æ–‡æ¡£å¤„ç†** - è‡ªåŠ¨è§£æã€åˆ†å—ã€å‘é‡åŒ–æµç¨‹
3. **è¯­ä¹‰æ£€ç´¢** - åŸºäº pgvector çš„é«˜æ€§èƒ½å‘é‡æ£€ç´¢
4. **Agent é›†æˆ** - Writerã€Reviewerã€Formatter è‡ªåŠ¨ä½¿ç”¨çŸ¥è¯†åº“

### 6.2 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RAG ç³»ç»Ÿæ¶æ„                          â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   æ–‡æ¡£ä¸Šä¼   â”‚â”€â”€â”€â–ºâ”‚  æ–‡æ¡£è§£æ   â”‚â”€â”€â”€â–ºâ”‚   åˆ†å—å™¨    â”‚    â”‚
â”‚  â”‚            â”‚    â”‚            â”‚    â”‚            â”‚    â”‚
â”‚  â”‚ â€¢ TXT      â”‚    â”‚ â€¢ TXT      â”‚    â”‚ â€¢ é€’å½’åˆ†å—  â”‚    â”‚
â”‚  â”‚ â€¢ MD       â”‚    â”‚ â€¢ Markdown â”‚    â”‚ â€¢ è¯­ä¹‰ä¿æŒ  â”‚    â”‚
â”‚  â”‚ â€¢ HTML     â”‚    â”‚ â€¢ HTML     â”‚    â”‚ â€¢ é‡å æ§åˆ¶  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚           â”‚
â”‚                                              â–¼           â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                       â”‚  å‘é‡åŒ–     â”‚    â”‚
â”‚                                       â”‚            â”‚    â”‚
â”‚                                       â”‚ â€¢ OpenAI   â”‚    â”‚
â”‚                                       â”‚   Embeddingâ”‚    â”‚
â”‚                                       â”‚ â€¢ 1536ç»´   â”‚    â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚           â”‚
â”‚                                              â–¼           â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                       â”‚ pgvector   â”‚    â”‚
â”‚                                       â”‚ å‘é‡å­˜å‚¨    â”‚    â”‚
â”‚                                       â”‚            â”‚    â”‚
â”‚                                       â”‚ â€¢ HNSWç´¢å¼• â”‚    â”‚
â”‚                                       â”‚ â€¢ ä½™å¼¦è·ç¦» â”‚    â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚           â”‚
â”‚  â”‚  ç”¨æˆ·æŸ¥è¯¢   â”‚                             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                             â”‚           â”‚
â”‚         â”‚                                    â”‚           â”‚
â”‚         â–¼                                    â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æŸ¥è¯¢å‘é‡åŒ– â”‚â”€â”€â”€â–ºâ”‚  å‘é‡æ£€ç´¢   â”‚â”€â”€â”€â–ºâ”‚   é‡æ’åº    â”‚    â”‚
â”‚  â”‚            â”‚    â”‚            â”‚    â”‚            â”‚    â”‚
â”‚  â”‚ â€¢ OpenAI   â”‚    â”‚ â€¢ TopK     â”‚    â”‚ â€¢ ç›¸ä¼¼åº¦   â”‚    â”‚
â”‚  â”‚   Embeddingâ”‚    â”‚ â€¢ ä½™å¼¦ç›¸ä¼¼åº¦â”‚    â”‚   è¿‡æ»¤     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚           â”‚
â”‚                                              â–¼           â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                       â”‚ Agenté›†æˆ  â”‚    â”‚
â”‚                                       â”‚            â”‚    â”‚
â”‚                                       â”‚ â€¢ Writer   â”‚    â”‚
â”‚                                       â”‚ â€¢ Reviewer â”‚    â”‚
â”‚                                       â”‚ â€¢ Formatterâ”‚    â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 æ ¸å¿ƒç»„ä»¶

#### 6.3.1 æ–‡æ¡£è§£æå™¨ï¼ˆDocumentParserï¼‰

**æ”¯æŒæ ¼å¼**:
- **TXT** - çº¯æ–‡æœ¬æ–‡ä»¶
- **Markdown** - Markdown æ ¼å¼æ–‡æ¡£
- **HTML** - HTML ç½‘é¡µï¼ˆæå–ä¸»ä½“å†…å®¹ï¼‰

**è§£ææµç¨‹**:
```go
type DocumentParser interface {
    Parse(ctx context.Context, filename string, content []byte) (*ParsedDocument, error)
    SupportsFormat(filename string) bool
}

// å®ç°
- TXTParser
- MarkdownParser
- HTMLParser
```

**HTML è§£æç‰¹æ€§**:
- è‡ªåŠ¨å»é™¤ scriptã€style æ ‡ç­¾
- æå–ä¸»ä½“æ–‡æœ¬å†…å®¹
- ä¿ç•™æ®µè½ç»“æ„

#### 6.3.2 åˆ†å—å™¨ï¼ˆChunkerï¼‰

**é€’å½’å­—ç¬¦åˆ†å—ç®—æ³•**:

```go
type RecursiveCharacterChunker struct {
    ChunkSize    int     // åˆ†å—å¤§å°ï¼ˆé»˜è®¤ 500ï¼‰
    ChunkOverlap int     // é‡å å¤§å°ï¼ˆé»˜è®¤ 50ï¼‰
    Separators   []string // åˆ†éš”ç¬¦ä¼˜å…ˆçº§
}

// åˆ†éš”ç¬¦ä¼˜å…ˆçº§
Separators: []string{
    "\n\n",    // æ®µè½
    "\n",      // è¡Œ
    " ",       // ç©ºæ ¼
    "",        // å­—ç¬¦
}
```

**åˆ†å—ç­–ç•¥**:
1. ä¼˜å…ˆæŒ‰æ®µè½åˆ†å‰²
2. æ®µè½è¿‡é•¿æ—¶æŒ‰å¥å­åˆ†å‰²
3. å¥å­è¿‡é•¿æ—¶æŒ‰ç©ºæ ¼åˆ†å‰²
4. ä¿æŒæœ€å°è¯­ä¹‰å•å…ƒå®Œæ•´æ€§
5. è®¾ç½®é‡å åŒºåŸŸé¿å…è¯­ä¹‰æ–­è£‚

**ç¤ºä¾‹**:
```
åŸæ–‡ï¼ˆ1000 å­—ç¬¦ï¼‰ï¼š
"äººå·¥æ™ºèƒ½æ˜¯... AIæŠ€æœ¯..."

åˆ†å—ç»“æœï¼š
Chunk 1 (500 å­—ç¬¦): "äººå·¥æ™ºèƒ½æ˜¯..."
Chunk 2 (500 å­—ç¬¦): "...ï¼ˆoverlap 50ï¼‰AIæŠ€æœ¯..."
```

#### 6.3.3 å‘é‡åŒ–ï¼ˆEmbeddingï¼‰

**Embedding æ¨¡å‹**:
- **OpenAI text-embedding-3-small**
  - ç»´åº¦: 1536
  - ä»·æ ¼: $0.02 / 1M tokens
  - æ€§èƒ½: ä¼˜ç§€

**å‘é‡åŒ–æµç¨‹**:
```go
func Vectorize(ctx context.Context, text string) ([]float32, error) {
    // è°ƒç”¨ OpenAI Embedding API
    resp, err := client.CreateEmbeddings(ctx, openai.EmbeddingRequest{
        Input: []string{text},
        Model: openai.AdaEmbeddingV2,
    })
    return resp.Data[0].Embedding, nil
}
```

#### 6.3.4 å‘é‡å­˜å‚¨ï¼ˆpgvectorï¼‰

**è¡¨ç»“æ„**:
```sql
CREATE TABLE document_chunks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    document_id UUID NOT NULL REFERENCES documents(id) ON DELETE CASCADE,
    kb_id UUID NOT NULL REFERENCES knowledge_bases(id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    vector vector(1536),
    chunk_index INT NOT NULL,
    token_count INT,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- HNSW ç´¢å¼•ï¼ˆé«˜æ€§èƒ½å‘é‡æ£€ç´¢ï¼‰
CREATE INDEX idx_chunks_vector ON document_chunks 
USING hnsw (vector vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_chunks_kb_doc ON document_chunks(kb_id, document_id);
```

**HNSW å‚æ•°è¯´æ˜**:
- `m = 16`: æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§è¿æ¥æ•°
- `ef_construction = 64`: æ„å»ºç´¢å¼•æ—¶çš„æœç´¢å®½åº¦

#### 6.3.5 è¯­ä¹‰æ£€ç´¢

**æ£€ç´¢ SQL**:
```sql
SELECT 
    id,
    document_id,
    content,
    chunk_index,
    1 - (vector <=> $1::vector) AS score
FROM document_chunks
WHERE kb_id = $2
ORDER BY vector <=> $1::vector
LIMIT $3;
```

**å‚æ•°**:
- `$1`: æŸ¥è¯¢å‘é‡ï¼ˆ1536 ç»´ï¼‰
- `$2`: çŸ¥è¯†åº“ ID
- `$3`: TopKï¼ˆé»˜è®¤ 3ï¼‰

**è¿‡æ»¤æ¡ä»¶**:
```go
// æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆé»˜è®¤ 0.7ï¼‰
if score >= config.RAGMinScore {
    results = append(results, result)
}
```

### 6.4 API ç«¯ç‚¹ï¼ˆ13 ä¸ªï¼‰

#### 6.4.1 çŸ¥è¯†åº“ç®¡ç†ï¼ˆ5 ä¸ªï¼‰

**åˆ›å»ºçŸ¥è¯†åº“**
```
POST /api/knowledge-bases
{
  "name": "æŠ€æœ¯æ–‡æ¡£åº“",
  "type": "document",
  "description": "å­˜å‚¨æŠ€æœ¯æ–‡æ¡£å’ŒAPIæ–‡æ¡£"
}
```

**è·å–çŸ¥è¯†åº“åˆ—è¡¨**
```
GET /api/knowledge-bases?type=document&page=1&per_page=20
```

**è·å–çŸ¥è¯†åº“è¯¦æƒ…**
```
GET /api/knowledge-bases/:id
```

**æ›´æ–°çŸ¥è¯†åº“**
```
PUT /api/knowledge-bases/:id
{
  "name": "æ›´æ–°çš„åç§°",
  "description": "æ›´æ–°çš„æè¿°"
}
```

**åˆ é™¤çŸ¥è¯†åº“**
```
DELETE /api/knowledge-bases/:id
```

#### 6.4.2 æ–‡æ¡£ç®¡ç†ï¼ˆ6 ä¸ªï¼‰

**ä¸Šä¼ æ–‡æ¡£**
```
POST /api/knowledge-bases/:id/documents
Content-Type: multipart/form-data

file: api-docs.md
metadata: {"author": "å¼ ä¸‰", "version": "1.0"}
```

**è·å–æ–‡æ¡£åˆ—è¡¨**
```
GET /api/knowledge-bases/:id/documents?status=completed&page=1
```

**è·å–æ–‡æ¡£è¯¦æƒ…**
```
GET /api/documents/:id
```

**åˆ é™¤æ–‡æ¡£**
```
DELETE /api/documents/:id
```

**é‡æ–°å¤„ç†æ–‡æ¡£**
```
POST /api/documents/:id/reprocess
```

**è·å–æ–‡æ¡£åˆ†å—**
```
GET /api/documents/:id/chunks?page=1&per_page=10
```

#### 6.4.3 è¯­ä¹‰æ£€ç´¢ï¼ˆ2 ä¸ªï¼‰

**è¯­ä¹‰æ£€ç´¢**
```
POST /api/knowledge-bases/:id/search
{
  "query": "å¦‚ä½•ä½¿ç”¨ API è¿›è¡Œèº«ä»½è®¤è¯ï¼Ÿ",
  "top_k": 5,
  "min_score": 0.75
}

Response:
{
  "results": [
    {
      "chunk_id": "uuid",
      "document_id": "uuid",
      "content": "API èº«ä»½è®¤è¯ä½¿ç”¨ JWT Token...",
      "score": 0.92,
      "metadata": {...}
    }
  ]
}
```

**è·å–ä¸Šä¸‹æ–‡ï¼ˆä¾› Agent ä½¿ç”¨ï¼‰**
```
POST /api/knowledge-bases/:id/context
{
  "query": "å¦‚ä½•ä½¿ç”¨ API è¿›è¡Œèº«ä»½è®¤è¯ï¼Ÿ",
  "max_chunks": 3
}

Response:
{
  "context": "ä»¥ä¸‹æ˜¯ä»çŸ¥è¯†åº“æ£€ç´¢åˆ°çš„ç›¸å…³ä¿¡æ¯ï¼š\n\n[å‚è€ƒèµ„æ–™ 1] (ç›¸ä¼¼åº¦: 0.92)\nAPI èº«ä»½è®¤è¯ä½¿ç”¨ JWT Token...\n\n[å‚è€ƒèµ„æ–™ 2] (ç›¸ä¼¼åº¦: 0.85)\n...",
  "source_count": 2
}
```

### 6.5 Agent RAG é›†æˆ

#### 6.5.1 é›†æˆæ¶æ„

```
Agent æ‰§è¡Œæµç¨‹ï¼š

1. æ¥æ”¶ç”¨æˆ·è¾“å…¥
   â†“
2. æ£€æŸ¥æ˜¯å¦å¯ç”¨ RAG (rag_enabled = true)
   â†“
3. ä»çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯ (EnrichWithKnowledge)
   â†“
4. æ„å»ºçŸ¥è¯†åº“ä¸Šä¸‹æ–‡ (buildContextText)
   â†“
5. æ³¨å…¥åˆ°ç³»ç»Ÿ Prompt (InjectKnowledgeIntoPrompt)
   â†“
6. è°ƒç”¨ AI æ¨¡å‹
   â†“
7. è¿”å›å¢å¼ºçš„ç»“æœ
```

#### 6.5.2 RAG Helper

**æ ¸å¿ƒæ–¹æ³•**:
```go
type RAGHelper struct {
    ragService *rag.RAGService
}

// ä»çŸ¥è¯†åº“æ£€ç´¢å¹¶ä¸°å¯Œè¾“å…¥
func (h *RAGHelper) EnrichWithKnowledge(
    ctx context.Context, 
    config *agent.AgentConfig, 
    input *AgentInput,
) (*AgentInput, error)

// æ„å»ºçŸ¥è¯†åº“ä¸Šä¸‹æ–‡æ–‡æœ¬
func (h *RAGHelper) buildContextText(
    results []*rag.SearchResult,
) string

// æ³¨å…¥çŸ¥è¯†åº“ä¸Šä¸‹æ–‡åˆ° Prompt
func InjectKnowledgeIntoPrompt(
    input *AgentInput, 
    systemPrompt string,
) string
```

#### 6.5.3 æ”¯æŒçš„ Agent ç±»å‹

| Agent | RAG æ”¯æŒ | çŸ¥è¯†åº“ç±»å‹ | ä½¿ç”¨åœºæ™¯ |
|-------|---------|-----------|---------|
| **Writer** | âœ… å®Œæˆ | æŠ€æœ¯æ–‡æ¡£ã€äº§å“æ‰‹å†Œã€å†™ä½œæŒ‡å— | åŸºäºä¼ä¸šçŸ¥è¯†åˆ›ä½œå†…å®¹ |
| **Reviewer** | âœ… å®Œæˆ | å®¡æ ¡è§„èŒƒã€é£æ ¼æŒ‡å—ã€æœ¯è¯­è¯å…¸ | åŸºäºä¼ä¸šæ ‡å‡†å®¡æ ¡å†…å®¹ |
| **Formatter** | âœ… å®Œæˆ | æ ¼å¼è§„èŒƒã€æ–‡æ¡£æ¨¡æ¿ | åŸºäºä¼ä¸šæ¨¡æ¿æ ¼å¼åŒ–å†…å®¹ |
| **Planner** | â³ è§„åˆ’ä¸­ | é¡¹ç›®æ¡ˆä¾‹ã€ä»»åŠ¡æ¨¡æ¿ | åŸºäºå†å²æ¡ˆä¾‹è§„åˆ’ä»»åŠ¡ |
| **Translator** | â³ è§„åˆ’ä¸­ | æœ¯è¯­åº“ã€ç¿»è¯‘è®°å¿† | åŸºäºæœ¯è¯­åº“ç¿»è¯‘å†…å®¹ |
| **Analyzer** | â³ è§„åˆ’ä¸­ | è¯„ä¼°æ ‡å‡†ã€è¡Œä¸šæŠ¥å‘Š | åŸºäºæ ‡å‡†åˆ†æå†…å®¹ |
| **Researcher** | âœ… åŸç”Ÿ | æ‰€æœ‰ç±»å‹ | æ£€ç´¢çŸ¥è¯†åº“å†…å®¹ |

#### 6.5.4 é…ç½®å‚æ•°

**Agent RAG é…ç½®**:
```go
type AgentConfig struct {
    // ...
    KnowledgeBaseID string  // å…³è”çš„çŸ¥è¯†åº“ ID
    RAGEnabled      bool    // æ˜¯å¦å¯ç”¨ RAG
    RAGTopK         int     // RAG æ£€ç´¢æ•°é‡ï¼ˆé»˜è®¤ 3ï¼‰
    RAGMinScore     float64 // RAG æœ€å°ç›¸ä¼¼åº¦ï¼ˆé»˜è®¤ 0.7ï¼‰
}
```

**é…ç½®ç¤ºä¾‹**:
```json
{
  "name": "æŠ€æœ¯æ–‡æ¡£åŠ©æ‰‹",
  "agentType": "writer",
  "modelId": "model-uuid",
  "knowledgeBaseId": "kb-uuid",
  "ragEnabled": true,
  "ragTopK": 5,
  "ragMinScore": 0.75
}
```

### 6.6 ä½¿ç”¨åœºæ™¯

#### åœºæ™¯ 1: æŠ€æœ¯æ–‡æ¡£é—®ç­”

**çŸ¥è¯†åº“å†…å®¹**: API æ–‡æ¡£ã€æŠ€æœ¯æŒ‡å—ã€FAQ

**ä½¿ç”¨ Agent**: Writer Agent + RAG

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·é—®é¢˜: "å¦‚ä½•ä½¿ç”¨ JWT è¿›è¡Œ API è®¤è¯ï¼Ÿ"
    â†“
çŸ¥è¯†åº“æ£€ç´¢: 
  - [1] JWT è®¤è¯æµç¨‹è¯´æ˜ï¼ˆç›¸ä¼¼åº¦ 0.92ï¼‰
  - [2] API è®¤è¯ç¤ºä¾‹ä»£ç ï¼ˆç›¸ä¼¼åº¦ 0.85ï¼‰
  - [3] JWT Token é…ç½®ï¼ˆç›¸ä¼¼åº¦ 0.78ï¼‰
    â†“
Agent ç”Ÿæˆ:
"åŸºäºæˆ‘ä»¬çš„ API æ–‡æ¡£ï¼ŒJWT è®¤è¯æµç¨‹å¦‚ä¸‹ï¼š
1. å‘é€ POST è¯·æ±‚åˆ° /api/auth/login
2. æä¾›é‚®ç®±å’Œå¯†ç 
3. æ¥æ”¶ JWT Token
4. åœ¨åç»­è¯·æ±‚çš„ Header ä¸­æºå¸¦ï¼šAuthorization: Bearer <token>

ç¤ºä¾‹ä»£ç ï¼š
```bash
curl -X POST http://api.example.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password"}'
```
"
```

#### åœºæ™¯ 2: ä¼ä¸šçŸ¥è¯†åº“

**çŸ¥è¯†åº“å†…å®¹**: å…¬å¸è§„ç« åˆ¶åº¦ã€äº§å“æ‰‹å†Œã€åŸ¹è®­èµ„æ–™

**ä½¿ç”¨ Agent**: Reviewer Agent + RAG

**å·¥ä½œæµç¨‹**:
```
å®¡æ ¡å†…å®¹: "å‘˜å·¥å…¥èŒæµç¨‹è¯´æ˜"
    â†“
çŸ¥è¯†åº“æ£€ç´¢:
  - [1] å…¬å¸å…¥èŒæµç¨‹æ ‡å‡†æ–‡æ¡£ï¼ˆç›¸ä¼¼åº¦ 0.88ï¼‰
  - [2] å…¥èŒææ–™æ¸…å•ï¼ˆç›¸ä¼¼åº¦ 0.82ï¼‰
    â†“
Agent å®¡æ ¡:
"æ ¹æ®å…¬å¸æ ‡å‡†æµç¨‹ï¼Œä»¥ä¸‹å†…å®¹éœ€è¦ä¿®æ”¹ï¼š
1. ç¼ºå°‘èƒŒæ™¯è°ƒæŸ¥ç¯èŠ‚
2. å…¥èŒææ–™æ¸…å•ä¸å®Œæ•´ï¼Œéœ€è¡¥å……...
3. å»ºè®®å‚è€ƒæ ‡å‡†æ¨¡æ¿ä¼˜åŒ–æµç¨‹æè¿°
"
```

#### åœºæ™¯ 3: åˆè§„å®¡æŸ¥

**çŸ¥è¯†åº“å†…å®¹**: æ³•å¾‹æ³•è§„ã€åˆè§„æ–‡æ¡£ã€è¡Œä¸šæ ‡å‡†

**ä½¿ç”¨ Agent**: Reviewer Agent + RAG

**å·¥ä½œæµç¨‹**:
```
å®¡æŸ¥å†…å®¹: "éšç§æ”¿ç­–è‰æ¡ˆ"
    â†“
çŸ¥è¯†åº“æ£€ç´¢:
  - [1] GDPR åˆè§„è¦æ±‚ï¼ˆç›¸ä¼¼åº¦ 0.91ï¼‰
  - [2] ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ï¼ˆç›¸ä¼¼åº¦ 0.87ï¼‰
  - [3] è¡Œä¸šéšç§æ ‡å‡†ï¼ˆç›¸ä¼¼åº¦ 0.79ï¼‰
    â†“
Agent å®¡æŸ¥:
"æ ¹æ® GDPR å’Œä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•è¦æ±‚ï¼š
1. ç¼ºå°‘ç”¨æˆ·åŒæ„æœºåˆ¶è¯´æ˜
2. æ•°æ®å¤„ç†ç›®çš„æè¿°ä¸å¤Ÿæ˜ç¡®
3. å»ºè®®æ·»åŠ ç”¨æˆ·æƒåˆ©è¯´æ˜ï¼ˆè®¿é—®ã€åˆ é™¤ã€æ›´æ­£ï¼‰
"
```

#### åœºæ™¯ 4: ä»£ç åŠ©æ‰‹

**çŸ¥è¯†åº“å†…å®¹**: ä»£ç è§„èŒƒã€æœ€ä½³å®è·µã€API æ–‡æ¡£

**ä½¿ç”¨ Agent**: Writer Agent + RAG

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·éœ€æ±‚: "ç”Ÿæˆç”¨æˆ·æ³¨å†Œ API"
    â†“
çŸ¥è¯†åº“æ£€ç´¢:
  - [1] API è®¾è®¡è§„èŒƒï¼ˆç›¸ä¼¼åº¦ 0.89ï¼‰
  - [2] ç”¨æˆ·æ¨¡å‹å®šä¹‰ï¼ˆç›¸ä¼¼åº¦ 0.86ï¼‰
  - [3] è®¤è¯æœ€ä½³å®è·µï¼ˆç›¸ä¼¼åº¦ 0.81ï¼‰
    â†“
Agent ç”Ÿæˆ:
"åŸºäºé¡¹ç›®ä»£ç è§„èŒƒï¼Œç”¨æˆ·æ³¨å†Œ API å®ç°å¦‚ä¸‹ï¼š

```go
// POST /api/auth/register
func (h *AuthHandler) Register(c *gin.Context) {
    var req RegisterRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    // éªŒè¯é‚®ç®±æ ¼å¼
    if !isValidEmail(req.Email) {
        c.JSON(400, gin.H{"error": "invalid email"})
        return
    }
    
    // å¯†ç åŠ å¯†ï¼ˆä½¿ç”¨ bcryptï¼‰
    hashedPassword, _ := bcrypt.GenerateFromPassword(
        []byte(req.Password), bcrypt.DefaultCost,
    )
    
    // åˆ›å»ºç”¨æˆ·
    user := &User{
        Email:        req.Email,
        PasswordHash: string(hashedPassword),
    }
    
    if err := h.service.CreateUser(user); err != nil {
        c.JSON(500, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(200, gin.H{"message": "success", "data": user})
}
```
"
```

### 6.7 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ |
|------|--------|--------|
| **æ–‡æ¡£ä¸Šä¼ ** | < 2s / 1MB | ~1.5s |
| **æ–‡æ¡£è§£æ** | < 5s / 1MB | ~3s |
| **åˆ†å—å¤„ç†** | < 3s / 1000 chunks | ~2s |
| **å‘é‡åŒ–** | < 1s / 100 chunks | ~0.8s |
| **å‘é‡æ£€ç´¢** | < 100ms / TopK=5 | ~50ms |
| **ç«¯åˆ°ç«¯å»¶è¿Ÿ** | < 10sï¼ˆä¸Šä¼ åˆ°å¯æ£€ç´¢ï¼‰ | ~8s |

### 6.8 æ‰©å±•è®¡åˆ’

#### çŸ­æœŸï¼ˆ1-2 ä¸ªæœˆï¼‰
- âœ… æ”¯æŒ PDF è§£æ
- âœ… æ”¯æŒ DOCX è§£æ
- âœ… æ··åˆæ£€ç´¢ï¼ˆå…³é”®è¯ + å‘é‡ï¼‰
- âœ… æŸ¥è¯¢é‡å†™ä¼˜åŒ–

#### ä¸­æœŸï¼ˆ3-6 ä¸ªæœˆï¼‰
- âœ… æ”¯æŒå›¾ç‰‡ OCR æ–‡å­—æå–
- âœ… æ”¯æŒè¡¨æ ¼æ•°æ®æå–
- âœ… å¤šçŸ¥è¯†åº“è”åˆæ£€ç´¢
- âœ… Rerank æ¨¡å‹ä¼˜åŒ–ç»“æœ

#### é•¿æœŸï¼ˆ6+ ä¸ªæœˆï¼‰
- âœ… çŸ¥è¯†å›¾è°±é›†æˆ
- âœ… å®ä½“å…³ç³»æå–
- âœ… è‡ªåŠ¨æ ‡ç­¾ç”Ÿæˆ
- âœ… çŸ¥è¯†åº“è´¨é‡è¯„ä¼°

---

## 7. éåŠŸèƒ½æ€§éœ€æ±‚

### 7.1 æ€§èƒ½è¦æ±‚

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|--------|---------|
| **API å“åº”æ—¶é—´** | P95 < 500ms | Prometheus ç›‘æ§ |
| **Agent æ‰§è¡Œå»¶è¿Ÿ** | P95 < 5s | å®¡è®¡æ—¥å¿—åˆ†æ |
| **å·¥ä½œæµæ‰§è¡Œ** | P95 < 30s | æ‰§è¡Œè®°å½•ç»Ÿè®¡ |
| **å‘é‡æ£€ç´¢** | P95 < 100ms | Database ç›‘æ§ |
| **å¹¶å‘ç”¨æˆ·** | 1000+ | è´Ÿè½½æµ‹è¯• |
| **QPS** | 10,000+ | å‹åŠ›æµ‹è¯• |

### 7.2 å¯æ‰©å±•æ€§

#### æ°´å¹³æ‰©å±•
- Backend æœåŠ¡æ— çŠ¶æ€ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- ä½¿ç”¨ Redis å…±äº« Session
- ä½¿ç”¨ RabbitMQ åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—

#### å‚ç›´æ‰©å±•
- PostgreSQL è¯»å†™åˆ†ç¦»
- Redis é›†ç¾¤
- RabbitMQ é›†ç¾¤

### 7.3 å®‰å…¨æ€§

> **æ³¨æ„**: æ ¹æ®é¡¹ç›®è§„èŒƒï¼Œå®‰å…¨æ€§ä¼˜å…ˆçº§æœ€ä½ï¼Œä»…ä¿ç•™å¿…è¦çš„å®‰å…¨æªæ–½ã€‚

#### å¿…è¦å®‰å…¨æªæ–½
- å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- API å¯†é’¥åŠ å¯†å­˜å‚¨
- HTTPS ä¼ è¾“åŠ å¯†
- SQL æ³¨å…¥é˜²æŠ¤ï¼ˆGORM ORMï¼‰

#### ä¸å®æ–½çš„å®‰å…¨åŠŸèƒ½
- âŒ é«˜çº§åŠ å¯†ç®—æ³•
- âŒ å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰
- âŒ å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰
- âŒ Web åº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰

### 7.4 å¯è§‚æµ‹æ€§

#### ç›‘æ§æŒ‡æ ‡ï¼ˆPrometheusï¼‰
- API è¯·æ±‚ç»Ÿè®¡ï¼ˆQPSã€å»¶è¿Ÿã€é”™è¯¯ç‡ï¼‰
- Agent æ‰§è¡Œç»Ÿè®¡ï¼ˆæˆåŠŸç‡ã€å¹³å‡è€—æ—¶ï¼‰
- æ•°æ®åº“æ€§èƒ½ï¼ˆè¿æ¥æ•°ã€æŸ¥è¯¢è€—æ—¶ï¼‰
- å‘é‡æ£€ç´¢æ€§èƒ½ï¼ˆæ£€ç´¢æ—¶é—´ã€å‘½ä¸­ç‡ï¼‰

#### æ—¥å¿—ï¼ˆELKï¼‰
- åº”ç”¨æ—¥å¿—ï¼ˆInfoã€Warnã€Errorï¼‰
- è®¿é—®æ—¥å¿—ï¼ˆAPI è¯·æ±‚è®°å½•ï¼‰
- å®¡è®¡æ—¥å¿—ï¼ˆå…³é”®æ“ä½œè®°å½•ï¼‰

#### é“¾è·¯è¿½è¸ªï¼ˆJaegerï¼‰
- å·¥ä½œæµæ‰§è¡Œé“¾è·¯
- Agent è°ƒç”¨é“¾è·¯
- æ•°æ®åº“æŸ¥è¯¢é“¾è·¯

---

## 8. éƒ¨ç½²ä¸è¿ç»´

### 8.1 ç¯å¢ƒè¦æ±‚

#### ç¡¬ä»¶è¦æ±‚

**å¼€å‘ç¯å¢ƒ**:
- CPU: 4 æ ¸
- å†…å­˜: 8 GB
- ç¡¬ç›˜: 50 GB SSD

**ç”Ÿäº§ç¯å¢ƒï¼ˆä¸­ç­‰è§„æ¨¡ï¼‰**:
- CPU: 16 æ ¸
- å†…å­˜: 64 GB
- ç¡¬ç›˜: 500 GB SSD
- ç½‘ç»œ: 1 Gbps

#### è½¯ä»¶ä¾èµ–

| è½¯ä»¶ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Go | 1.21+ | åç«¯è¿è¡Œæ—¶ |
| PostgreSQL | 14+ | ä¸»æ•°æ®åº“ |
| pgvector | 0.5+ | å‘é‡æ‰©å±• |
| Redis | 7.0+ | ç¼“å­˜å’Œ Session |
| RabbitMQ | 3.12+ | æ¶ˆæ¯é˜Ÿåˆ— |
| Docker | 20.10+ | å®¹å™¨åŒ– |
| Kubernetes | 1.25+ | ç¼–æ’ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ |

### 8.2 éƒ¨ç½²æ­¥éª¤

#### 8.2.1 å¼€å‘ç¯å¢ƒéƒ¨ç½²ï¼ˆDocker Composeï¼‰

**1. å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/yourusername/AgentFlowCreativeHub.git
cd AgentFlowCreativeHub
```

**2. é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“ã€Redisã€API å¯†é’¥ç­‰
```

**3. å¯åŠ¨æœåŠ¡**
```bash
docker-compose up -d
```

**4. åˆå§‹åŒ–æ•°æ®åº“**
```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
psql -U postgres -d agentflow_dev -f db/migrations/0001_initial.sql
psql -U postgres -d agentflow_dev -f db/migrations/0007_knowledge_base_rag.sql
psql -U postgres -d agentflow_dev -f db/migrations/0008_agent_rag_integration.sql
```

**5. éªŒè¯éƒ¨ç½²**
```bash
curl http://localhost:8080/api/health
```

#### 8.2.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼ˆKubernetesï¼‰

**1. æ„å»º Docker é•œåƒ**
```bash
docker build -t agentflow-backend:v1.0 -f backend/Dockerfile .
docker push registry.example.com/agentflow-backend:v1.0
```

**2. éƒ¨ç½²æ•°æ®åº“**
```bash
kubectl apply -f k8s/postgres-statefulset.yaml
kubectl apply -f k8s/redis-statefulset.yaml
kubectl apply -f k8s/rabbitmq-statefulset.yaml
```

**3. éƒ¨ç½²åç«¯æœåŠ¡**
```bash
kubectl apply -f k8s/backend-deployment.yaml
kubectl apply -f k8s/backend-service.yaml
```

**4. é…ç½® Ingress**
```bash
kubectl apply -f k8s/ingress.yaml
```

**5. éªŒè¯éƒ¨ç½²**
```bash
kubectl get pods
kubectl logs -f backend-pod-xxxxx
```

### 8.3 ç›‘æ§æŒ‡æ ‡

#### å…³é”®ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡ | æè¿° | å‘Šè­¦é˜ˆå€¼ |
|------|------|---------|
| `api_requests_total` | API è¯·æ±‚æ€»æ•° | - |
| `api_request_duration_seconds` | API è¯·æ±‚å»¶è¿Ÿ | P95 > 1s |
| `agent_executions_total` | Agent æ‰§è¡Œæ€»æ•° | - |
| `agent_execution_duration_seconds` | Agent æ‰§è¡Œè€—æ—¶ | P95 > 10s |
| `agent_execution_errors_total` | Agent æ‰§è¡Œå¤±è´¥æ•° | > 100/min |
| `vector_search_duration_seconds` | å‘é‡æ£€ç´¢è€—æ—¶ | P95 > 200ms |
| `db_connections` | æ•°æ®åº“è¿æ¥æ•° | > 80% max |
| `cache_hit_rate` | ç¼“å­˜å‘½ä¸­ç‡ | < 80% |

#### Grafana ç›‘æ§é¢æ¿

**é¢æ¿ 1: ç³»ç»Ÿæ¦‚è§ˆ**
- QPS è¶‹åŠ¿å›¾
- API å»¶è¿Ÿåˆ†å¸ƒå›¾
- é”™è¯¯ç‡è¶‹åŠ¿å›¾

**é¢æ¿ 2: Agent æ‰§è¡Œ**
- Agent æ‰§è¡Œæ¬¡æ•°ï¼ˆæŒ‰ç±»å‹ï¼‰
- Agent æ‰§è¡Œè€—æ—¶åˆ†å¸ƒ
- Agent å¤±è´¥ç‡

**é¢æ¿ 3: RAG æ£€ç´¢**
- å‘é‡æ£€ç´¢ QPS
- å‘é‡æ£€ç´¢å»¶è¿Ÿ
- çŸ¥è¯†åº“ä½¿ç”¨ç»Ÿè®¡

**é¢æ¿ 4: èµ„æºä½¿ç”¨**
- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ I/O

### 8.4 æ•…éšœå¤„ç†

#### å¸¸è§é—®é¢˜

**1. æ•°æ®åº“è¿æ¥å¤±è´¥**
```
é”™è¯¯: connection refused
è§£å†³: æ£€æŸ¥ PostgreSQL æœåŠ¡çŠ¶æ€ï¼Œç¡®è®¤è¿æ¥é…ç½®
```

**2. pgvector æ‰©å±•æœªå®‰è£…**
```
é”™è¯¯: type "vector" does not exist
è§£å†³: CREATE EXTENSION vector;
```

**3. å‘é‡æ£€ç´¢æ…¢**
```
é”™è¯¯: æ£€ç´¢è€—æ—¶ > 1s
è§£å†³: æ£€æŸ¥ HNSW ç´¢å¼•æ˜¯å¦åˆ›å»ºï¼Œè€ƒè™‘å¢åŠ  ef_search å‚æ•°
```

**4. Agent æ‰§è¡Œè¶…æ—¶**
```
é”™è¯¯: execution timeout
è§£å†³: æ£€æŸ¥ AI æä¾›å•† API çŠ¶æ€ï¼Œå¢åŠ è¶…æ—¶é…ç½®
```

---

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 å•å…ƒæµ‹è¯•

#### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘: **80%+**
- RAG ç³»ç»Ÿ: **85%+**
- API Handler: **70%+**

#### æµ‹è¯•æ¡†æ¶
- Go: `testing` + `testify`
- Mock: `gomock`

#### ç¤ºä¾‹
```go
func TestRAGHelper_EnrichWithKnowledge(t *testing.T) {
    // Setup
    mockRAGService := mock.NewMockRAGService()
    ragHelper := runtime.NewRAGHelper(mockRAGService)
    
    // Test
    input := &runtime.AgentInput{Content: "test query"}
    config := &agent.AgentConfig{
        RAGEnabled: true,
        KnowledgeBaseID: "kb-123",
        RAGTopK: 3,
    }
    
    result, err := ragHelper.EnrichWithKnowledge(ctx, config, input)
    
    // Assert
    assert.NoError(t, err)
    assert.NotNil(t, result.Context.Data["knowledge_context"])
}
```

### 9.2 é›†æˆæµ‹è¯•

#### æµ‹è¯•åœºæ™¯
1. **Agent æ‰§è¡Œæµç¨‹**
   - åˆ›å»º Agent â†’ æ‰§è¡Œä»»åŠ¡ â†’ éªŒè¯ç»“æœ

2. **å·¥ä½œæµæ‰§è¡Œ**
   - å®šä¹‰å·¥ä½œæµ â†’ æ‰§è¡Œ â†’ éªŒè¯æ¯ä¸ªæ­¥éª¤

3. **RAG å®Œæ•´æµç¨‹**
   - åˆ›å»ºçŸ¥è¯†åº“ â†’ ä¸Šä¼ æ–‡æ¡£ â†’ æ£€ç´¢ â†’ Agent ä½¿ç”¨

#### æµ‹è¯•ç¯å¢ƒ
- ä½¿ç”¨ Docker Compose å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
- ä½¿ç”¨æµ‹è¯•æ•°æ®åº“ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰

### 9.3 æ€§èƒ½æµ‹è¯•

#### æµ‹è¯•å·¥å…·
- **JMeter** - API å‹åŠ›æµ‹è¯•
- **k6** - è´Ÿè½½æµ‹è¯•
- **pgbench** - æ•°æ®åº“æ€§èƒ½æµ‹è¯•

#### æµ‹è¯•åœºæ™¯

**1. API å‹åŠ›æµ‹è¯•**
```bash
k6 run --vus 100 --duration 60s api-load-test.js
```

**2. å‘é‡æ£€ç´¢æ€§èƒ½æµ‹è¯•**
```sql
-- æµ‹è¯• 10000 æ¬¡å‘é‡æ£€ç´¢
EXPLAIN ANALYZE
SELECT id, 1 - (vector <=> $1) AS score
FROM document_chunks
ORDER BY vector <=> $1
LIMIT 5;
```

**3. Agent å¹¶å‘æ‰§è¡Œæµ‹è¯•**
```bash
# å¹¶å‘æ‰§è¡Œ 100 ä¸ª Agent ä»»åŠ¡
for i in {1..100}; do
  curl -X POST http://localhost:8080/api/agents/xxx/execute &
done
wait
```

### 9.4 RAG æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹ 1: æ–‡æ¡£ä¸Šä¼ å’Œå¤„ç†

```
æ­¥éª¤:
1. åˆ›å»ºçŸ¥è¯†åº“
2. ä¸Šä¼ æµ‹è¯•æ–‡æ¡£ï¼ˆapi-docs.mdï¼Œ500 KBï¼‰
3. ç­‰å¾…å¤„ç†å®Œæˆ
4. éªŒè¯æ–‡æ¡£çŠ¶æ€ä¸º "completed"
5. éªŒè¯åˆ†å—æ•°é‡ > 0
6. éªŒè¯å‘é‡æ•°æ®å·²å­˜å‚¨

é¢„æœŸç»“æœ:
- æ–‡æ¡£çŠ¶æ€: completed
- åˆ†å—æ•°é‡: ~1000
- å¤„ç†æ—¶é—´: < 10s
```

#### æµ‹è¯•ç”¨ä¾‹ 2: è¯­ä¹‰æ£€ç´¢å‡†ç¡®æ€§

```
æ­¥éª¤:
1. å‡†å¤‡æµ‹è¯•çŸ¥è¯†åº“ï¼ˆåŒ…å« 100 ç¯‡æ–‡æ¡£ï¼‰
2. æ‰§è¡Œè¯­ä¹‰æ£€ç´¢ï¼ˆæŸ¥è¯¢: "å¦‚ä½•ä½¿ç”¨ JWT è®¤è¯"ï¼‰
3. éªŒè¯ TopK ç»“æœ
4. è®¡ç®—å‡†ç¡®ç‡ï¼ˆäººå·¥æ ‡æ³¨ç›¸å…³æ€§ï¼‰

é¢„æœŸç»“æœ:
- TopK=5 ç›¸å…³æ€§: > 80%
- æ£€ç´¢æ—¶é—´: < 100ms
```

#### æµ‹è¯•ç”¨ä¾‹ 3: Agent RAG é›†æˆ

```
æ­¥éª¤:
1. åˆ›å»º Writer Agentï¼ˆå¯ç”¨ RAGï¼‰
2. å…³è”æµ‹è¯•çŸ¥è¯†åº“
3. æ‰§è¡Œ Agentï¼ˆè¾“å…¥: "è§£é‡Š API è®¤è¯æµç¨‹"ï¼‰
4. éªŒè¯è¾“å‡ºåŒ…å«çŸ¥è¯†åº“å†…å®¹

é¢„æœŸç»“æœ:
- è¾“å‡ºå¼•ç”¨çŸ¥è¯†åº“å†…å®¹
- è¾“å‡ºè´¨é‡é«˜äºæœªå¯ç”¨ RAG çš„ Agent
- æ‰§è¡Œæ—¶é—´: < 8s
```

---

## 10. é‡Œç¨‹ç¢‘ä¸è·¯çº¿å›¾

### 10.1 å·²å®Œæˆé‡Œç¨‹ç¢‘

#### Sprint 1-3: åŸºç¡€è®¾æ–½ï¼ˆâœ… 100%ï¼‰
**æ—¶é—´**: 2025-10 ~ 2025-11-10  
**æˆæœ**:
- âœ… é¡¹ç›®æ¶æ„è®¾è®¡
- âœ… æ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆ13 å¼ è¡¨ï¼‰
- âœ… åŸºç¡€ API æ¡†æ¶ï¼ˆGinï¼‰
- âœ… æ•°æ®åº“é›†æˆï¼ˆGORM + PostgreSQLï¼‰
- âœ… Agent è¿è¡Œæ—¶ï¼ˆWriter/Reviewer/Formatterï¼‰
- âœ… å·¥ä½œæµå¼•æ“ï¼ˆParser + Schedulerï¼‰

**äº¤ä»˜ç‰©**:
- 51 ä¸ªæ–‡ä»¶
- ~9,310 è¡Œä»£ç 
- 41 ä¸ª API ç«¯ç‚¹

#### Sprint 4: å¤šæä¾›å•†æ”¯æŒï¼ˆâœ… 100%ï¼‰
**æ—¶é—´**: 2025-11-11 ~ 2025-11-14  
**æˆæœ**:
- âœ… AI æ¨¡å‹æŠ½è±¡å±‚ï¼ˆClientFactoryï¼‰
- âœ… 8 ä¸ªæä¾›å•†é€‚é…å™¨ï¼ˆOpenAI/Azure/Google/AWS/Anthropic/DeepSeek/Qwen/Ollamaï¼‰
- âœ… æ ¼å¼è½¬æ¢å™¨ï¼ˆç»Ÿä¸€è¯·æ±‚/å“åº”æ ¼å¼ï¼‰
- âœ… æ¨¡å‹å‘ç°åŠŸèƒ½

**äº¤ä»˜ç‰©**:
- 13 ä¸ªæ–‡ä»¶
- ~2,600 è¡Œä»£ç 
- +2 ä¸ª API ç«¯ç‚¹ï¼ˆ43 totalï¼‰

#### Sprint 5: è®¤è¯æˆæƒ + å®¡è®¡ï¼ˆâœ… 100%ï¼‰
**æ—¶é—´**: 2025-11-15 ~ 2025-11-16  
**æˆæœ**:
- âœ… JWT + Session è®¤è¯
- âœ… OAuth2 é›†æˆï¼ˆGoogle/GitHubï¼‰
- âœ… å¤šç§Ÿæˆ·éš”ç¦»
- âœ… RBAC æƒé™æ§åˆ¶
- âœ… å®¡è®¡æ—¥å¿—ç³»ç»Ÿï¼ˆ40+ äº‹ä»¶ç±»å‹ï¼‰

**äº¤ä»˜ç‰©**:
- 10 ä¸ªæ–‡ä»¶
- ~2,290 è¡Œä»£ç 
- +9 ä¸ª API ç«¯ç‚¹ï¼ˆ52 totalï¼‰

#### Sprint 6: RAG çŸ¥è¯†åº“ï¼ˆâœ… 100%ï¼‰
**æ—¶é—´**: 2025-11-17  
**æˆæœ**:
- âœ… çŸ¥è¯†åº“ç®¡ç†ï¼ˆCRUDï¼‰
- âœ… æ–‡æ¡£å¤„ç†ï¼ˆè§£æ + åˆ†å— + å‘é‡åŒ–ï¼‰
- âœ… pgvector å‘é‡å­˜å‚¨
- âœ… è¯­ä¹‰æ£€ç´¢
- âœ… 13 ä¸ª RAG API ç«¯ç‚¹

**äº¤ä»˜ç‰©**:
- 9 ä¸ªæ–‡ä»¶
- ~2,160 è¡Œä»£ç 
- +13 ä¸ª API ç«¯ç‚¹ï¼ˆ63 totalï¼‰

#### Sprint 7: Agent RAG é›†æˆï¼ˆâœ… 100%ï¼‰
**æ—¶é—´**: 2025-11-17  
**æˆæœ**:
- âœ… Agent æ¨¡å‹å¢å¼ºï¼ˆ4 ä¸ª RAG é…ç½®å­—æ®µï¼‰
- âœ… RAG Helper å®ç°
- âœ… Writer Agent RAG æ”¯æŒ
- âœ… Reviewer Agent RAG æ”¯æŒ
- âœ… Formatter Agent RAG æ”¯æŒ
- âœ… Registry ç»Ÿä¸€ç®¡ç†

**äº¤ä»˜ç‰©**:
- 2 ä¸ªæ–°æ–‡ä»¶
- 5 ä¸ªä¿®æ”¹æ–‡ä»¶
- ~270 è¡Œä»£ç 
- 1 ä¸ªæ•°æ®åº“è¿ç§»

### 10.2 å½“å‰è¿›åº¦æ€»ç»“

**æ€»ä½“å®Œæˆåº¦**: çº¦ **70%**

| æ¨¡å— | å®Œæˆåº¦ | çŠ¶æ€ |
|------|--------|------|
| åŸºç¡€è®¾æ–½ | 100% | âœ… |
| Agent è¿è¡Œæ—¶ | 100% | âœ… |
| AI æ¨¡å‹ç®¡ç† | 100% | âœ… |
| RAG çŸ¥è¯†åº“ | 100% | âœ… |
| è®¤è¯æˆæƒ | 100% | âœ… |
| å®¡è®¡æ—¥å¿— | 100% | âœ… |
| å·¥ä½œæµç¼–æ’ | 80% | â³ |
| Prompt æ¨¡æ¿ | 100% | âœ… |
| ç›‘æ§å‘Šè­¦ | 30% | â³ |
| å‰ç«¯æ§åˆ¶å° | 0% | â³ |

**ä»£ç ç»Ÿè®¡**:
- æ€»æ–‡ä»¶æ•°: **85+**
- æ€»ä»£ç è¡Œæ•°: **~16,850+**
- API ç«¯ç‚¹: **63+**
- æ•°æ®åº“è¡¨: **13**

### 10.3 å¾…å®Œæˆé‡Œç¨‹ç¢‘

#### Sprint 8: å·¥å…·è°ƒç”¨ï¼ˆâ³ è§„åˆ’ä¸­ï¼‰
**é¢„è®¡æ—¶é—´**: 1-2 å‘¨  
**è®¡åˆ’åŠŸèƒ½**:
- Function Calling æ”¯æŒ
- å·¥å…·æ³¨å†Œæœºåˆ¶
- å·¥å…·æ‰§è¡Œå¼•æ“
- å†…ç½®å·¥å…·åº“ï¼ˆæœç´¢ã€è®¡ç®—å™¨ã€æ•°æ®åº“æŸ¥è¯¢ï¼‰

#### Sprint 9: ç›‘æ§å‘Šè­¦ï¼ˆâ³ è§„åˆ’ä¸­ï¼‰
**é¢„è®¡æ—¶é—´**: 1-2 å‘¨  
**è®¡åˆ’åŠŸèƒ½**:
- Prometheus é›†æˆ
- Grafana ç›‘æ§é¢æ¿
- å‘Šè­¦è§„åˆ™é…ç½®
- é“¾è·¯è¿½è¸ªï¼ˆJaegerï¼‰

#### Sprint 10: å‰ç«¯æ§åˆ¶å°ï¼ˆâ³ è§„åˆ’ä¸­ï¼‰
**é¢„è®¡æ—¶é—´**: 3-4 å‘¨  
**è®¡åˆ’åŠŸèƒ½**:
- React + TypeScript
- Agent ç®¡ç†ç•Œé¢
- å·¥ä½œæµå¯è§†åŒ–ç¼–è¾‘å™¨
- çŸ¥è¯†åº“ç®¡ç†ç•Œé¢
- ç›‘æ§çœ‹æ¿

### 10.4 é•¿æœŸè·¯çº¿å›¾

#### Q1 2026: åŠŸèƒ½å®Œå–„
- å¤šè¯­è¨€ç¿»è¯‘ Agent
- æ•°æ®åˆ†æ Agent
- ä»£ç ç”Ÿæˆ Agent
- çŸ¥è¯†å›¾è°±é›†æˆ

#### Q2 2026: ä¼ä¸šåŠŸèƒ½
- å¤šæ¨¡æ€å†…å®¹æ”¯æŒï¼ˆå›¾åƒã€è§†é¢‘ï¼‰
- Agent å¸‚åœºï¼ˆç¤¾åŒºå…±äº«ï¼‰
- è‡ªå®šä¹‰ Agent å¼€å‘å¹³å°
- ä¼ä¸šçº§ SLA æ”¯æŒ

#### Q3 2026: æ™ºèƒ½ä¼˜åŒ–
- AI è‡ªåŠ¨ä¼˜åŒ– Prompt
- Agent è‡ªå­¦ä¹ èƒ½åŠ›
- æˆæœ¬ä¼˜åŒ–å»ºè®®
- æ€§èƒ½è‡ªåŠ¨è°ƒä¼˜

#### Q4 2026: ç”Ÿæ€å»ºè®¾
- ç¬¬ä¸‰æ–¹é›†æˆå¸‚åœº
- æ’ä»¶ç³»ç»Ÿ
- API SDKï¼ˆå¤šè¯­è¨€ï¼‰
- å¼€å‘è€…ç¤¾åŒº

---

## 11. é™„å½•

### é™„å½• A: æ•°æ®åº“ Schema

è¯¦è§: `db/migrations/*.sql`

æ ¸å¿ƒè¡¨ç»“æ„å·²åœ¨ [ç¬¬ 4 ç« ](#4-æ•°æ®æ¨¡å‹) åˆ—å‡ºã€‚

### é™„å½• B: API å®Œæ•´åˆ—è¡¨

è¯¦è§: [ç¬¬ 5 ç« ](#5-api-è®¾è®¡)

æ‰€æœ‰ 63+ API ç«¯ç‚¹å·²åˆ†ç±»åˆ—å‡ºã€‚

### é™„å½• C: é…ç½®ç¤ºä¾‹

#### .env é…ç½®ç¤ºä¾‹

```env
# åº”ç”¨é…ç½®
APP_NAME=AgentFlowCreativeHub
APP_ENV=production
APP_PORT=8080

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=agentflow_prod
DB_USER=agentflow
DB_PASSWORD=strong_password

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# RabbitMQ é…ç½®
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest

# JWT é…ç½®
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRATION=7200  # 2 hours

# AI æä¾›å•†é…ç½®
OPENAI_API_KEY=sk-xxxxx
AZURE_OPENAI_API_KEY=xxxxx
GOOGLE_API_KEY=xxxxx
AWS_ACCESS_KEY_ID=xxxxx
AWS_SECRET_ACCESS_KEY=xxxxx
ANTHROPIC_API_KEY=sk-ant-xxxxx
DEEPSEEK_API_KEY=xxxxx
QWEN_API_KEY=xxxxx

# RAG é…ç½®
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSIONS=1536

# ç›‘æ§é…ç½®
PROMETHEUS_ENABLED=true
JAEGER_ENABLED=true
```

### é™„å½• D: RAG æ£€ç´¢ç¤ºä¾‹

#### ç¤ºä¾‹ 1: æŠ€æœ¯æ–‡æ¡£æ£€ç´¢

**æŸ¥è¯¢**:
```json
{
  "query": "å¦‚ä½•ä½¿ç”¨ API è¿›è¡Œèº«ä»½è®¤è¯ï¼Ÿ",
  "top_k": 3,
  "min_score": 0.7
}
```

**æ£€ç´¢ç»“æœ**:
```json
{
  "results": [
    {
      "chunk_id": "chunk-001",
      "document_id": "doc-api-auth",
      "content": "API èº«ä»½è®¤è¯æµç¨‹ï¼š\n1. å‘é€ POST è¯·æ±‚åˆ° /api/auth/login\n2. æä¾›é‚®ç®±å’Œå¯†ç \n3. æ¥æ”¶ JWT Token\n4. åœ¨åç»­è¯·æ±‚çš„ Header ä¸­æºå¸¦ Token...",
      "score": 0.92,
      "metadata": {
        "filename": "api-authentication.md",
        "section": "è®¤è¯æµç¨‹"
      }
    },
    {
      "chunk_id": "chunk-002",
      "document_id": "doc-jwt-guide",
      "content": "JWT Token ä½¿ç”¨è¯´æ˜ï¼š\nJWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç§åŸºäº JSON çš„å¼€æ”¾æ ‡å‡†...",
      "score": 0.85,
      "metadata": {
        "filename": "jwt-guide.md",
        "section": "JWT ä»‹ç»"
      }
    },
    {
      "chunk_id": "chunk-003",
      "document_id": "doc-api-security",
      "content": "API å®‰å…¨æœ€ä½³å®è·µï¼š\n- å§‹ç»ˆä½¿ç”¨ HTTPS\n- Token æœ‰æ•ˆæœŸä¸å®œè¿‡é•¿\n- å®šæœŸåˆ·æ–° Token...",
      "score": 0.78,
      "metadata": {
        "filename": "api-security.md",
        "section": "å®‰å…¨å»ºè®®"
      }
    }
  ],
  "total": 3,
  "search_time_ms": 45
}
```

#### ç¤ºä¾‹ 2: Agent ä½¿ç”¨çŸ¥è¯†åº“

**Agent é…ç½®**:
```json
{
  "name": "æŠ€æœ¯æ–‡æ¡£åŠ©æ‰‹",
  "agentType": "writer",
  "modelId": "model-gpt4",
  "knowledgeBaseId": "kb-tech-docs",
  "ragEnabled": true,
  "ragTopK": 3,
  "ragMinScore": 0.75
}
```

**ç”¨æˆ·è¾“å…¥**:
```json
{
  "content": "å¦‚ä½•ä½¿ç”¨ API è¿›è¡Œèº«ä»½è®¤è¯ï¼Ÿ"
}
```

**Agent å†…éƒ¨æµç¨‹**:
```
1. ä»çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³å†…å®¹ï¼ˆTopK=3ï¼‰
   â†“
2. æ„å»ºçŸ¥è¯†åº“ä¸Šä¸‹æ–‡
   "ä»¥ä¸‹æ˜¯ä»çŸ¥è¯†åº“æ£€ç´¢åˆ°çš„ç›¸å…³ä¿¡æ¯ï¼š
    [å‚è€ƒèµ„æ–™ 1] (ç›¸ä¼¼åº¦: 0.92)
    API èº«ä»½è®¤è¯æµç¨‹...
    
    [å‚è€ƒèµ„æ–™ 2] (ç›¸ä¼¼åº¦: 0.85)
    JWT Token ä½¿ç”¨è¯´æ˜...
    
    [å‚è€ƒèµ„æ–™ 3] (ç›¸ä¼¼åº¦: 0.78)
    API å®‰å…¨æœ€ä½³å®è·µ..."
   â†“
3. æ³¨å…¥åˆ°ç³»ç»Ÿ Prompt
   "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å†…å®¹åˆ›ä½œè€…...
    
    ä»¥ä¸‹æ˜¯ä»çŸ¥è¯†åº“æ£€ç´¢åˆ°çš„ç›¸å…³ä¿¡æ¯ï¼š
    [å‚è€ƒèµ„æ–™ 1] ..."
   â†“
4. è°ƒç”¨ AI æ¨¡å‹ç”Ÿæˆå›ç­”
```

**Agent è¾“å‡º**:
```
åŸºäºæˆ‘ä»¬çš„æŠ€æœ¯æ–‡æ¡£ï¼ŒAPI èº«ä»½è®¤è¯æµç¨‹å¦‚ä¸‹ï¼š

## è®¤è¯æµç¨‹

1. **è·å– Token**
   å‘é€ POST è¯·æ±‚åˆ° `/api/auth/login`ï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
   ```json
   {
     "email": "user@example.com",
     "password": "your_password"
   }
   ```

2. **æ¥æ”¶ Token**
   æˆåŠŸè®¤è¯åï¼ŒAPI è¿”å› JWT Tokenï¼š
   ```json
   {
     "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
     "expiresIn": 7200
   }
   ```

3. **ä½¿ç”¨ Token**
   åœ¨åç»­ API è¯·æ±‚çš„ Header ä¸­æºå¸¦ Tokenï¼š
   ```
   Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

## å®‰å…¨å»ºè®®

- å§‹ç»ˆä½¿ç”¨ HTTPS ä¼ è¾“
- Token æœ‰æ•ˆæœŸè®¾ç½®ä¸º 2 å°æ—¶
- å®šæœŸåˆ·æ–° Token ä»¥ä¿æŒä¼šè¯

[ä»¥ä¸Šå›ç­”åŸºäºä¼ä¸šæŠ€æœ¯æ–‡æ¡£åº“]
```

---

## æ–‡æ¡£ç»“æŸ

**ç¼–å†™**: AI Agent  
**å®¡æ ¸**: å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-11-17  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0

---

**AgentFlowCreativeHub** - ä¼ä¸šçº§å¤š Agent åä½œåˆ›ä½œå¹³å°

Â© 2025 AgentFlowCreativeHub. All rights reserved.
