# AgentFlowCreativeHub 功能清单

> 最后更新：2025-11-27  
> 版本：v1.2.0  
> 文档说明：本文档列出项目当前已实现和未实现的功能清单

---

## 📋 目录

- [一、核心架构](#一核心架构)
- [二、多 Agent 协作系统](#二多-agent-协作系统)
- [三、工作流引擎](#三工作流引擎)
- [四、AI 模型集成](#四ai-模型集成)
- [五、RAG 知识库系统](#五rag-知识库系统)
- [六、多租户与权限管理](#六多租户与权限管理)
- [七、认证授权系统](#七认证授权系统)
- [八、工具与插件系统](#八工具与插件系统)
- [九、代码搜索服务](#九代码搜索服务)
- [十、工作空间管理](#十工作空间管理)
- [十一、通知系统](#十一通知系统)
- [十二、审计与监控](#十二审计与监控)
- [十三、文件管理](#十三文件管理)
- [十四、模板管理](#十四模板管理)
- [十五、异步任务处理](#十五异步任务处理)
- [十六、API 与集成](#十六api-与集成)
- [十七、部署与运维](#十七部署与运维)
- [十八、内容创作增强功能](#十八内容创作增强功能)
- [十九、积分与计费系统](#十九积分与计费系统)
- [二十、内容审核系统](#二十内容审核系统)

---

## 一、核心架构

### 1.1 基础设施

- [x] **Gin Web 框架集成** - HTTP 服务基础
- [x] **GORM ORM 框架** - 数据库操作
- [x] **PostgreSQL 数据库** - 主数据存储
- [x] **Redis 缓存与队列** - 缓存和消息队列
- [x] **Zap 日志系统** - 结构化日志
- [x] **Viper 配置管理** - 多环境配置加载
- [x] **依赖注入容器（wire.go）** - 服务依赖管理
- [x] **健康检查接口** - `/health` 和 `/ready` 端点
- [x] **Prometheus 指标收集** - 监控指标暴露
- [x] **Swagger API 文档** - 自动化 API 文档生成

### 1.2 数据库迁移

- [x] **多租户表结构** - `0001_multi_tenant.sql`
- [x] **RAG 工具系统表** - `0002_rag_tool_system.sql`
- [x] **软删除支持** - `0003_add_soft_delete.sql`
- [x] **触发器** - `0004_add_triggers.sql`
- [x] **模型增强** - `0005_enhance_models.sql`
- [x] **认证审计表** - `0006_auth_and_audit.sql`
- [x] **审批通知表** - `0007_approval_notifications.sql`
- [x] **知识库 RAG 表** - `0007_knowledge_base_rag.sql`
- [x] **Agent RAG 集成** - `0008_agent_rag_integration.sql`
- [x] **模型凭证和降级** - `0009_model_credentials_and_fallback.sql`
- [x] **工作空间文件表** - `0010_workspace_files.sql`
- [x] **RBAC 权限表** - `0011_rbac_permissions.sql`
- [x] **Agent 产出物工作空间** - `0012_agent_artifact_workspace.sql`
- [x] **工作流模板** - `004_workflow_templates.sql`
- [ ] **迁移脚本编号规范化** - 存在重复编号需整理

---

## 二、多 Agent 协作系统

### 2.1 Agent 类型（7 种已实现）

- [x] **Writer Agent** - 内容创作 Agent
  - 支持多种写作风格
  - 可自定义 Prompt 模板
  - 集成 RAG 知识增强
- [x] **Reviewer Agent** - 内容审校 Agent
  - 语法检查
  - 事实核查
  - 风格一致性检查
- [x] **Planner Agent** - 任务规划 Agent
  - 任务拆解
  - 大纲生成
  - 流程规划
- [x] **Formatter Agent** - 格式化 Agent
  - Markdown 格式化
  - 文档排版优化
  - 多格式转换
- [x] **Translator Agent** - 翻译 Agent
  - 多语言翻译
  - 本地化支持
  - 上下文保持
- [x] **Analyzer Agent** - 分析 Agent
  - 内容质量评估
  - SEO 分析
  - 数据洞察
- [x] **Researcher Agent** - 调研 Agent
  - RAG 知识库查询
  - 网络搜索
  - 信息整合

### 2.2 Agent 运行时（21 个文件）

- [x] **Agent 注册中心（Registry）** - Agent 生命周期管理
- [x] **上下文管理器（ContextManager）** - 对话上下文维护
- [x] **RAG 辅助器（RAGHelper）** - RAG 检索集成
- [x] **工具辅助器（ToolHelper）** - 工具调用封装
- [x] **记忆服务（MemoryService）** - Agent 记忆管理
- [x] **异步客户端（AsyncClient）** - 异步 Agent 调用
- [x] **异步工作器（AsyncWorker）** - 异步任务处理
- [x] **子代理协调（SubAgent）** - 多 Agent 协作
- [x] **Prompt 管理** - Prompt 模板加载和渲染
- [x] **结果解析器（Parser）** - 结构化输出解析
- [ ] **Agent 能力可视化界面** - Web UI 查看 Agent 能力
- [ ] **Agent 性能分析工具** - 执行时间、Token 消耗统计
- [ ] **Agent A/B 测试框架** - 不同配置效果对比

### 2.3 Agent 配置管理

- [x] **Agent 配置 CRUD** - 创建、读取、更新、删除配置
- [x] **Agent 能力定义（YAML）** - `config/agent_capabilities.yaml`
- [x] **按租户隔离 Agent 配置** - 多租户数据隔离
- [ ] **Agent 配置版本管理** - 配置历史和回滚
- [ ] **Agent 配置导入导出** - 跨环境迁移配置

---

## 三、工作流引擎

### 3.1 工作流定义与管理

- [x] **工作流 CRUD API** - 创建、读取、更新、删除工作流
- [x] **工作流 YAML/JSON 定义** - DSL 描述工作流
- [x] **工作流验证器（Validator）** - 语法和逻辑验证
- [x] **工作流状态管理** - 状态机实现
- [x] **工作流模板系统** - 预置工作流模板
- [x] **工作流模板加载器** - 模板加载和初始化
- [ ] **可视化工作流编辑器** - 拖拽式流程设计（前端）
- [ ] **工作流导入导出** - 跨租户迁移工作流

### 3.2 工作流执行引擎（18 个文件）

- [x] **DAG 执行引擎** - 有向无环图任务调度
- [x] **调度器（Scheduler）** - 任务队列管理
- [x] **条件执行器** - 条件分支逻辑
- [x] **并行执行支持** - 多节点并发执行
- [x] **串行执行支持** - 顺序节点执行
- [x] **工作流执行记录** - 执行历史持久化
- [x] **执行状态追踪** - 实时状态查询
- [x] **断点续传** - 失败后从中断点恢复
- [x] **执行日志记录** - 详细执行日志
- [x] **超时控制** - 节点和工作流级超时
- [x] **重试机制** - 失败自动重试
- [ ] **循环节点支持** - Loop 控制流
- [ ] **工作流调试模式** - 单步执行、断点调试

### 3.3 工作流审批系统（7 个文件）

- [x] **审批请求管理（Manager）** - 创建、审批、拒绝请求
- [x] **事件总线（EventBus）** - 审批事件发布订阅
- [x] **目标解析器（TargetResolver）** - 审批人解析
- [x] **用户问答服务（UserQuestionService）** - 阻塞式用户输入
- [x] **审批通知** - 审批状态变更通知
- [x] **审批历史记录** - 审批操作审计
- [x] **人机交互节点（Human-in-the-Loop）** - 工作流中等待人工干预
- [ ] **审批规则引擎** - 自动审批规则配置
- [ ] **多级审批** - 多人顺序审批流程
- [ ] **审批超时自动处理** - 超时自动通过/拒绝

### 3.4 自动化引擎

- [x] **自动化规则管理** - 自动化配置 CRUD
- [x] **事件触发器** - 基于事件的自动执行
- [x] **定时任务触发器** - 基于时间的自动执行
- [x] **自动化执行记录** - 执行历史追踪
- [ ] **Webhook 触发器** - 外部系统触发工作流
- [ ] **条件触发器** - 基于数据变化的触发

---

## 四、AI 模型集成

### 4.1 模型提供商支持（7 个已集成）

- [x] **OpenAI 集成** - GPT-4, GPT-3.5 等
  - Chat Completion
  - Streaming 响应
  - Function Calling
  - Embeddings
- [x] **Anthropic Claude 集成** - Claude 3.5 Sonnet, Opus, Haiku
  - Messages API
  - Streaming
  - Tool Use
- [x] **Azure OpenAI 集成** - 企业级 OpenAI 服务
- [x] **DeepSeek 集成** - DeepSeek Chat 模型
- [x] **Google Gemini 集成** - Gemini Pro, Flash
- [x] **Ollama 本地模型** - 本地部署开源模型
- [x] **通义千问（Qwen）集成** - 阿里云大模型
- [ ] **文心一言集成** - 百度大模型
- [ ] **智谱 AI 集成** - 智谱 GLM 系列
- [ ] **讯飞星火集成** - 科大讯飞大模型

### 4.2 模型管理

- [x] **模型 CRUD API** - 模型配置管理
- [x] **模型凭证管理** - API Key 加密存储
- [x] **模型凭证加密** - AES-256 加密
- [x] **模型发现服务** - 自动发现可用模型
- [x] **模型降级策略** - 主模型失败切换备用模型
- [x] **模型调用日志** - 调用记录和审计
- [x] **Token 使用统计** - Token 消耗追踪
- [x] **客户端工厂（ClientFactory）** - 统一模型客户端创建
- [x] **数据库日志记录器** - 模型调用日志持久化
- [ ] **模型成本预估** - 调用前成本估算
- [ ] **模型配额管理** - 租户级别配额限制
- [ ] **模型性能监控** - 响应时间、成功率统计

### 4.3 Embedding 服务

- [x] **OpenAI Embeddings** - text-embedding-3-large/small
- [x] **批量 Embedding** - 批处理提升效率
- [x] **Embedding 缓存** - Redis 缓存减少重复调用
- [ ] **国产 Embedding 模型** - 通义、文心 Embedding
- [ ] **自定义 Embedding 模型** - 私有化部署模型

---

## 五、RAG 知识库系统

### 5.1 知识库管理

- [x] **知识库 CRUD** - 创建、读取、更新、删除知识库
- [x] **知识库租户隔离** - 多租户数据隔离
- [x] **知识库元数据管理** - 名称、描述、配置等
- [x] **默认 Embedding 模型配置** - 知识库级模型设置
- [ ] **知识库共享机制** - 跨租户知识共享
- [ ] **知识库访问控制** - 细粒度权限控制

### 5.2 文档管理

- [x] **文档上传 API** - 支持文件上传
- [x] **文档解析器注册中心** - 可扩展解析器架构
- [x] **文本文档解析** - .txt, .md, .json 等
- [x] **PDF 文档解析** - .pdf 文件提取
- [x] **文档元数据提取** - 标题、作者、创建时间
- [x] **文档分块（Chunking）** - 固定长度分片
- [x] **分块重叠策略** - Chunk 之间重叠保持上下文
- [ ] **Word 文档解析** - .docx, .doc 支持
- [ ] **HTML 网页解析** - 网页内容提取
- [ ] **语义分块** - 基于段落/章节的智能分块
- [ ] **文档更新和版本管理** - 文档版本追踪

### 5.3 向量存储

- [x] **PGVector 集成** - PostgreSQL 向量扩展
- [x] **Qdrant 集成** - 高性能向量数据库
- [x] **向量索引（IndexChunks）** - 批量向量写入
- [x] **向量搜索（Search）** - 相似度检索
- [x] **租户级向量隔离** - 多租户向量数据隔离
- [x] **TopK 检索** - 返回最相似的 K 个结果
- [x] **阈值过滤** - 相似度分数过滤
- [ ] **Milvus 集成** - 分布式向量数据库
- [ ] **混合检索（Hybrid Search）** - 向量 + BM25 结合
- [ ] **重排序（Rerank）** - 二次排序优化相关性

### 5.4 RAG 服务（17 个文件）

- [x] **RAG 服务（RAGService）** - 核心 RAG 逻辑
- [x] **Embedding 提供者接口** - 抽象 Embedding 服务
- [x] **向量存储接口** - 抽象向量数据库
- [x] **检索增强生成** - Query -> Retrieve -> Generate 流程
- [x] **上下文组装** - 检索结果拼接为 Prompt
- [x] **来源标注** - 标注知识来源文档
- [x] **异步文档索引** - 后台异步向量化
- [ ] **向量缓存优化** - 相同文本 Embedding 缓存
- [ ] **增量索引更新** - 文档更新时增量重建索引
- [ ] **多知识库联合检索** - 跨知识库搜索

### 5.5 代码备忘录服务

- [x] **NotebookService** - 代码备忘录管理
- [x] **备忘录 CRUD** - 创建、读取、更新、删除笔记
- [x] **按文件路径查询** - 查找特定文件的备忘录
- [x] **模糊搜索** - 支持关键词搜索
- [ ] **备忘录分类和标签** - 组织和过滤备忘录
- [ ] **备忘录导出** - 导出为 Markdown 或 JSON

---

## 六、多租户与权限管理

### 6.1 租户管理（13 个文件）

- [x] **租户 CRUD API** - 租户创建、读取、更新、删除
- [x] **租户上下文中间件** - 自动注入租户 ID
- [x] **租户数据隔离** - 所有查询自动添加 `tenant_id` 过滤
- [x] **租户配置管理** - 租户级别配置项
- [x] **租户配置缓存** - Redis 缓存配置减少 DB 查询
- [x] **租户配额服务** - 资源配额管理
- [x] **配额检查和限制** - API 调用前配额验证
- [ ] **租户注册自服务** - 用户自助创建租户
- [ ] **租户计费对接** - 使用量计费集成
- [ ] **租户数据导出** - 租户数据迁移和备份

### 6.2 用户管理

- [x] **用户 CRUD API** - 用户管理接口
- [x] **用户密码哈希** - Bcrypt 加密存储
- [x] **用户角色关联** - 多对多角色绑定
- [x] **用户状态管理** - 启用/禁用用户
- [x] **用户登录认证** - 用户名密码登录
- [x] **UUID 生成器** - 唯一用户 ID 生成
- [ ] **用户资料管理** - 头像、昵称等扩展信息
- [ ] **用户偏好设置** - 个性化配置
- [ ] **用户活跃度统计** - 用户行为分析

### 6.3 角色与权限（RBAC）

- [x] **角色 CRUD API** - 角色管理接口
- [x] **权限定义** - 资源和操作权限定义
- [x] **角色权限关联** - 多对多权限绑定
- [x] **用户角色关联** - 用户多角色支持
- [x] **权限检查器（PermissionChecker）** - 数据库权限验证
- [x] **权限中间件工厂** - 路由级权限保护
- [x] **预置权限种子数据** - 默认角色和权限初始化
- [x] **RBAC 权限模型** - 基于角色的访问控制
- [ ] **细粒度权限控制** - 资源级别权限（如单个工作流）
- [ ] **权限继承** - 角色继承和权限累积
- [ ] **动态权限分配** - 运行时权限调整

---

## 七、认证授权系统

### 7.1 JWT 认证（9 个文件）

- [x] **JWT 生成和验证** - Token 签发和校验
- [x] **JWT Secret Key 管理** - 密钥配置和轮换
- [x] **JWT 黑名单（Redis）** - Token 撤销机制
- [x] **JWT 过期时间配置** - 可配置 Token 有效期
- [x] **JWT Refresh Token** - 刷新 Token 续期
- [ ] **JWT 密钥轮换策略** - 定期更新密钥提升安全性
- [ ] **多设备登录管理** - 限制同时登录设备数

### 7.2 OAuth2 集成

- [x] **OAuth2 服务（OAuth2Service）** - 第三方登录集成
- [x] **Google OAuth2** - Google 账号登录
- [x] **GitHub OAuth2** - GitHub 账号登录（可配置）
- [x] **State 存储（StateStore）** - CSRF 防护
- [x] **Identity 存储（IdentityStore）** - 第三方账号关联
- [x] **Redis State 存储** - 分布式 State 管理
- [x] **内存 State 存储（回退）** - 无 Redis 时内存实现
- [ ] **更多 OAuth2 提供商** - 微信、企业微信、钉钉等
- [ ] **OAuth2 账号解绑** - 解除第三方账号关联
- [ ] **SSO 单点登录** - 企业级 OIDC 集成

### 7.3 会话管理

- [x] **会话创建和验证** - Session 管理
- [x] **会话存储（数据库）** - Session 持久化
- [x] **会话过期清理** - 定期清理过期会话
- [ ] **Redis Session 存储** - 分布式 Session
- [ ] **会话活跃度追踪** - 用户在线状态
- [ ] **强制下线功能** - 管理员踢出用户

---

## 八、工具与插件系统

### 8.1 工具注册与执行（19 个文件）

- [x] **工具注册中心（ToolRegistry）** - 工具生命周期管理
- [x] **工具执行器（ToolExecutor）** - 统一工具调用接口
- [x] **工具定义接口** - 标准化工具接口（Name, Description, Schema, Execute）
- [x] **动态工具注册** - 运行时注册工具
- [x] **工具参数验证** - JSON Schema 验证
- [x] **工具调用日志** - 工具使用审计
- [ ] **工具权限控制** - 限制工具使用范围
- [ ] **工具性能监控** - 工具执行时间统计
- [ ] **工具市场** - 第三方工具分享和发现

### 8.2 内置工具（13 种已实现）

- [x] **计算器工具（Calculator）** - 数学表达式计算
- [x] **HTTP API 工具** - 调用外部 HTTP API
- [x] **关键词提取工具** - 文本关键词提取
- [x] **知识库工具** - RAG 知识检索
- [x] **MCP 协议工具** - MCP 集成工具集
- [x] **记忆保存工具** - Agent 记忆持久化
- [x] **搜索工具** - 通用搜索封装
- [x] **文本转换工具** - 格式转换（大小写、编码等）
- [x] **文本统计工具** - 字数、词频统计
- [x] **文本摘要工具** - 自动摘要生成
- [x] **网页搜索工具** - 网络搜索集成
- [x] **工作空间发布工具** - 发布内容到工作空间
- [x] **文件系统工具（MCP）** - 文件读写操作
- [ ] **代码解释器（Code Interpreter）** - 安全沙箱代码执行
- [ ] **网页抓取工具（Web Scraper）** - 网页内容提取
- [ ] **邮件发送工具** - 邮件通知集成
- [ ] **Webhook 工具** - 触发外部 Webhook

### 8.3 MCP 工具集成

- [x] **MCP 工具注册** - Model Context Protocol 工具集成
- [x] **ACE 搜索工具（MCP）** - 符号搜索、定义查找
- [x] **代码库搜索工具（MCP）** - 语义代码搜索
- [x] **TODO 工具（MCP）** - 任务列表管理
- [x] **用户问答工具（MCP）** - 阻塞式用户输入
- [x] **文件系统工具（MCP）** - 文件操作
- [x] **备忘录工具（MCP）** - 代码备忘录
- [x] **Bash 工具（MCP）** - 安全命令执行
- [ ] **更多 MCP 工具集成** - 扩展 MCP 工具生态

### 8.4 HTTP 客户端工具库 ⭐ 新增

> **详细实现文档**：[硬盘缓存与互联网检索复用方案.md](./硬盘缓存与互联网检索复用方案.md) - 第二部分

- [x] **SearchTool HTTP 实现** - DuckDuckGo 搜索工具（参考实现）
  - HTTP Client 创建和超时配置
  - Context 请求支持
  - JSON 响应解析
  - 完整错误处理
- [ ] **通用 HTTP 工具类（httputil.Client）** - 可复用 HTTP 客户端封装（P1 推荐）
  - GetJSON/PostJSON 方法
  - 统一错误处理
  - 自动 User-Agent 设置
  - 超时和重试机制
- [ ] **带缓存的 HTTP 客户端（httputil.CachedClient）** - 集成硬盘缓存（P1 推荐）
  - HTTP 响应缓存
  - 缓存键生成（MD5）
  - 缓存 TTL 配置
  - 缓存命中率统计
- [ ] **HTTP 代理支持** - 支持代理配置（P2 可选）
- [ ] **HTTP 请求重试** - 自动重试失败请求（P2 可选）
- [ ] **HTTP 请求限流** - Rate Limiting 保护外部 API（P2 可选）

---

## 九、代码搜索服务

### 9.1 ACE 代码搜索（3 个文件）

- [x] **符号搜索** - 函数、类、接口、方法、结构体
- [x] **定义查找（Find Definition）** - 跳转到符号定义
- [x] **引用查找（Find References）** - 查找所有引用位置
- [x] **文本搜索** - git grep / ripgrep / 原生 Go 实现
- [x] **文件大纲（File Outline）** - 获取文件符号结构
- [x] **多语言支持** - Go, TypeScript, JavaScript, Python, Java, Rust, C#, C/C++
- [ ] **重构支持** - 重命名、提取方法等
- [ ] **代码补全** - 智能代码补全建议

### 9.2 语义代码搜索

- [x] **CodebaseSearchService** - 基于 Embedding 的语义搜索
- [x] **代码向量化** - 代码片段 Embedding
- [x] **语义相似度检索** - 查找语义相关代码
- [ ] **代码搜索 HTTP API** - 前端直接调用接口
- [ ] **代码搜索缓存优化** - 常见查询缓存
- [ ] **跨仓库代码搜索** - 多项目联合搜索

---

## 十、工作空间管理

### 10.1 工作空间核心（6 个文件）

- [x] **工作空间 CRUD** - 创建、读取、更新、删除工作空间
- [x] **工作空间节点管理** - 文件/文件夹树形结构
- [x] **暂存区（Staging）** - Agent 产出物暂存
- [x] **自动命名服务** - 智能文件命名
- [x] **文件系统操作** - 读写、移动、删除文件
- [x] **版本管理基础** - 文件历史记录
- [ ] **工作空间模板** - 预置项目结构模板
- [ ] **工作空间共享** - 多用户协作空间
- [ ] **版本对比和回滚** - 文件版本 Diff 和恢复

### 10.2 产出物管理

- [x] **产出物保存** - Agent 输出持久化
- [x] **产出物查询** - 按工作空间查询产出物
- [x] **产出物发布** - 发布到工作空间
- [ ] **产出物预览** - 实时预览产出物内容
- [ ] **产出物导出** - 导出为文件下载
- [ ] **产出物审核** - 发布前审核机制

---

## 十一、通知系统

### 11.1 WebSocket 通知（3 个文件）

- [x] **WebSocket Hub** - 连接管理中心
- [x] **多通道通知** - 支持多种通知类型
- [x] **离线消息存储** - 离线消息持久化
- [x] **Redis 离线存储** - 分布式离线消息
- [x] **内存离线存储（回退）** - 无 Redis 时内存实现
- [x] **WebSocket API** - 前端连接接口
- [ ] **消息已读状态** - 消息已读未读标记
- [ ] **消息推送优先级** - 区分紧急和普通消息
- [ ] **移动端推送** - APNs / FCM 集成

### 11.2 通知类型

- [x] **工作流状态通知** - 工作流执行状态变更
- [x] **审批请求通知** - 审批待办提醒
- [x] **系统通知** - 系统公告和警告
- [ ] **邮件通知** - 关键事件邮件提醒
- [ ] **Webhook 通知** - 外部系统集成
- [ ] **短信通知** - 重要事项短信提醒

---

## 十二、审计与监控

### 12.1 审计日志（5 个文件）

- [x] **审计日志服务** - 统一审计日志记录
- [x] **事件审计** - 关键操作记录（Create, Update, Delete, Execute）
- [x] **Token 审计** - AI 模型 Token 使用记录
- [x] **审计日志查询 API** - 日志查询和过滤
- [x] **审计中间件** - 自动记录 HTTP 请求
- [x] **租户级审计隔离** - 多租户审计数据隔离
- [ ] **审计日志导出** - 导出为 CSV / JSON
- [ ] **审计日志归档** - 历史数据归档和压缩
- [ ] **合规报告生成** - 自动生成合规审计报告

### 12.2 性能监控

- [x] **Prometheus 指标收集** - 基础指标暴露
- [x] **Prometheus 中间件** - HTTP 请求指标（QPS、延迟、错误率）
- [x] **健康检查** - `/health` 和 `/ready` 端点
- [ ] **自定义业务指标** - Agent 执行次数、工作流成功率等
- [ ] **Grafana 仪表盘** - 可视化监控大盘
- [ ] **告警规则配置** - 异常指标自动告警

### 12.3 日志系统

- [x] **Zap 结构化日志** - JSON 格式日志输出
- [x] **日志级别配置** - Debug, Info, Warn, Error
- [x] **日志格式配置** - JSON / Console 格式
- [x] **日志输出路径配置** - 文件 / 标准输出
- [ ] **ELK 集成** - Elasticsearch + Logstash + Kibana
- [ ] **日志聚合和检索** - 集中式日志管理
- [ ] **日志告警** - 错误日志自动告警

---

## 十三、文件管理

### 13.1 文件操作（文件树/内容/历史）

- [x] **文件树查询** - 获取目录结构
- [x] **文件内容读取** - 读取文件内容
- [x] **文件历史查询** - 文件修改历史
- [x] **文件写入** - 创建和修改文件
- [x] **文件删除** - 删除文件和目录
- [ ] **文件上传下载** - 大文件上传下载
- [ ] **文件预览** - 在线预览各种格式文件
- [ ] **文件搜索** - 文件名和内容搜索

---

## 十四、模板管理

### 14.1 Prompt 模板（2 个文件）

- [x] **模板 CRUD API** - 创建、读取、更新、删除模板
- [x] **模板变量注入** - 动态参数替换
- [x] **模板上下文绑定** - 绑定工作流上下文
- [x] **模板可见性控制** - 私有/团队/公开
- [x] **模板租户隔离** - 多租户数据隔离
- [ ] **模板版本管理** - 模板历史版本和回滚
- [ ] **模板市场** - 社区模板分享和发现
- [ ] **模板性能分析** - 统计模板使用效果

---

## 十五、异步任务处理

### 15.1 Worker 服务（5 个文件）

- [x] **Worker 服务器** - 异步任务消费者
- [x] **Asynq 队列集成** - Redis 任务队列
- [x] **工作流任务处理** - 异步工作流执行
- [x] **RAG 索引任务** - 异步文档向量化
- [x] **任务状态追踪** - 任务执行状态查询
- [x] **任务重试机制** - 失败自动重试
- [ ] **任务优先级** - 高优先级任务优先执行
- [ ] **任务取消** - 手动取消运行中任务
- [ ] **任务调度可视化** - 查看队列和任务状态

---

## 十六、API 与集成

### 16.1 API 层（14 个 Handler 模块）

- [x] **公共响应封装（handlers/common）** - 统一响应格式
- [x] **Agent API（handlers/agents）** - Agent CRUD + 执行
- [x] **审计 API（handlers/audit）** - 审计日志查询
- [x] **认证 API（handlers/auth）** - 登录、OAuth2、JWT
- [x] **命令 API（handlers/commands）** - 命令执行
- [x] **文件 API（handlers/files）** - 文件树、内容、历史
- [x] **知识库 API（handlers/knowledge）** - 知识库、文档、搜索
- [x] **模型 API（handlers/models）** - 模型管理、凭证、发现
- [x] **通知 API（handlers/notifications）** - WebSocket 连接
- [x] **模板 API（handlers/templates）** - 模板 CRUD
- [x] **租户 API（handlers/tenant）** - 租户、用户、角色、权限
- [x] **工具 API（handlers/tools）** - 工具注册、执行
- [x] **工作流 API（handlers/workflows）** - 工作流、执行、审批
- [x] **工作空间 API（handlers/workspace）** - 工作空间、产出物
- [ ] **代码搜索 API** - ACE 搜索和语义搜索 HTTP 接口
- [ ] **Webhook API** - 外部系统集成

### 16.2 中间件

- [x] **Recovery 中间件** - Panic 恢复
- [x] **请求日志中间件** - 记录所有 HTTP 请求
- [x] **CORS 中间件** - 跨域请求支持
- [x] **Prometheus 中间件** - 指标采集
- [x] **审计中间件** - 自动审计日志
- [x] **租户上下文中间件** - 自动注入租户信息
- [x] **权限中间件** - 路由级权限验证
- [ ] **限流中间件** - Rate Limiting 防刷
- [ ] **请求 ID 中间件** - 全链路追踪 ID

### 16.3 Swagger API 文档

- [x] **Swagger UI** - `/swagger/*any` 接口文档
- [x] **API 注释生成** - 基于代码注释自动生成文档
- [x] **请求/响应示例** - API 使用示例
- [ ] **API 版本管理** - 多版本 API 文档
- [ ] **在线 API 调试** - Swagger UI 在线测试

---

## 十七、部署与运维

### 17.1 部署支持

- [x] **Docker Compose 配置** - 本地一键启动
- [x] **环境变量配置** - `.env` 文件支持
- [x] **多环境配置** - dev.yaml / prod.yaml
- [x] **数据库迁移脚本** - SQL 迁移文件
- [x] **健康检查端点** - `/health` 和 `/ready`
- [ ] **Kubernetes YAML** - K8s 部署配置
- [ ] **Helm Chart** - Helm 包管理
- [ ] **CI/CD 流水线** - GitHub Actions / GitLab CI

### 17.2 安全加固

- [x] **JWT Secret Key 管理** - 环境变量配置
- [x] **模型凭证加密存储** - AES-256 加密
- [x] **Bash 命令安全检查** - 12 种危险命令模式检测
- [x] **密码 Bcrypt 加密** - 用户密码安全存储
- [x] **OAuth2 State 验证** - CSRF 防护
- [ ] **TLS/HTTPS 支持** - 传输层加密
- [ ] **API Key 管理** - 租户 API Key 生成和验证
- [ ] **IP 白名单** - 访问控制

### 17.3 性能优化

- [x] **Redis 缓存** - 配置缓存、会话缓存
- [x] **数据库连接池** - GORM 连接池管理
- [x] **Goroutine 并发** - 高并发 Agent 执行
- [ ] **数据库索引优化** - 查询性能优化
- [ ] **查询缓存** - 热点数据缓存
- [ ] **CDN 静态资源** - 前端资源加速

### 17.4 大模型缓存机制 ⭐⭐⭐

> **详细分析文档**：
>
> - [大模型缓存机制分析.md](./大模型缓存机制分析.md)
> - [硬盘缓存与互联网检索复用方案.md](./硬盘缓存与互联网检索复用方案.md) ← **新增实施方案**

**强烈建议实现**（预计年节省 $30,000+）：

#### 17.4.1 硬盘缓存存储（L3 层）⭐ 新增

- [ ] **SQLite 硬盘缓存** - 持久化缓存数据库（P0 高优先级）
  - 预期容量：10GB+
  - 命中延迟：5-20ms
  - 性能：10,000+ QPS
  - 优势：服务重启不丢失、成本极低、离线可用
- [ ] **缓存数据库 Schema** - llm_cache 表设计和索引优化
- [ ] **三层缓存架构** - L1(内存) → L2(Redis) → L3(SQLite) → 大模型
- [ ] **缓存回填机制** - L3 命中后自动回填 L2 和 L1
- [ ] **LRU 淘汰策略** - 基于访问时间的缓存清理
- [ ] **缓存统计服务** - 命中率、总大小、成本节省统计
- [ ] **自动过期清理** - 定期清理过期缓存（TTL 机制）
- [ ] **压缩存储优化** - 响应内容压缩减少空间占用

#### 17.4.2 内存与 Redis 缓存（L1/L2 层）

- [ ] **Embedding 向量缓存** - 相同文本 Embedding 永久缓存（P0 高优先级）
  - 预期命中率：60-80%
  - 月节省成本：$70+
  - 响应速度提升：95%+
- [ ] **系统 Prompt 缓存** - 系统提示词缓存（P0 高优先级）
  - 预期命中率：90-95%
  - 月节省成本：$850+
  - TTL：7 天
- [ ] **模板化 Prompt 缓存** - 预设模板缓存（P0 高优先级）
  - 预期命中率：70-80%
  - 月节省成本：$500+
  - TTL：3 天
- [ ] **Chat Completion 缓存** - 低温度请求缓存（P1 推荐）
  - 条件：temperature ≤ 0.3
  - 预期命中率：30-50%
  - 月节省成本：$1,350+
- [ ] **工作流步骤结果缓存** - 幂等步骤缓存（P1 推荐）
  - 预期命中率：40-60%
  - 月节省成本：$600+
  - TTL：1 小时
- [ ] **RAG 检索结果缓存** - 相同查询缓存（P1 推荐）
  - 预期命中率：50-70%
  - TTL：30 分钟
- [ ] **本地内存缓存（L1）** - 热点数据极速访问（P2 可选）
- [ ] **缓存预热机制** - 启动时加载常用数据（P2 可选）
- [ ] **智能缓存淘汰** - 基于访问频率的动态淘汰（P2 可选）
- [ ] **缓存监控指标** - Prometheus 缓存命中率、成本节省统计
- [ ] **缓存失效机制** - 主动失效 + TTL 过期策略

---

## 十八、内容创作增强功能

> **参考项目**：马良 AI 写作（MaliangAINovalWriter）- 专业小说创作平台
>
> 以下功能借鉴自马良 AI 写作项目，是面向小说/长文创作场景的专业化增强功能。

### 18.1 层级化内容管理

- [ ] **四级内容结构** - 作品 -> 卷 -> 章节 -> 场景的层级管理
- [ ] **大纲总览** - 全局大纲视图，方便观察内容结构
- [ ] **章节目录树** - 树状目录结构，快速定位和跳转
- [ ] **章节拖拽排序** - 可视化调整章节顺序
- [ ] **批量章节操作** - 批量移动、删除、复制章节

### 18.2 富文本编辑器

- [ ] **专业富文本编辑器** - 类似 Quill 的富文本编辑体验
- [ ] **长文连续滚动** - 支持上千章节连续编辑
- [ ] **丰富格式支持** - 粗体、斜体、标题、列表、引用等
- [ ] **实时字数统计** - 编辑器内实时显示字数
- [ ] **自动保存** - 定时自动保存编辑内容
- [ ] **版本历史** - 编辑历史记录和版本回退
- [ ] **多格式导入** - txt 智能解析目录结构导入
- [ ] **AI 工具栏集成** - 编辑器内快捷 AI 操作按钮

### 18.3 小说创作特定功能

- [ ] **片段管理** - 灵感片段、素材、待办事项记录
- [ ] **场景摘要生成** - AI 自动为长篇场景生成精炼摘要
- [ ] **摘要扩写** - 将摘要或大纲扩写为完整场景内容
- [ ] **快速开始向导** - 从设定提示词快速开始创作
- [ ] **黄金三章生成** - 自动生成前三章大纲和摘要
- [ ] **设定库侧边栏** - 快速查阅当前作品世界观设定
- [ ] **关联设定提示** - 编辑时自动提示相关设定信息

### 18.4 剧情推演系统

- [ ] **Next Outline（后续剧情推演）** - AI 根据上下文生成多个后续剧情选项
- [ ] **多模型抽卡机制** - 同时调用多个 AI 模型对比生成结果
- [ ] **分支剧情生成** - 生成多个不同走向的剧情分支
- [ ] **上下文智能分析** - 分析当前章节、角色关系、世界观设定
- [ ] **独立重生成** - 对单个不满意选项独立重新生成
- [ ] **一键应用剧情** - 选定剧情大纲直接应用到章节
- [ ] **剧情推演历史** - 保存推演历史记录
- [ ] **剧情树可视化** - 可视化展示剧情分支结构

### 18.5 世界观构建系统

- [ ] **结构化设定管理** - 角色、地点、物品、势力等类型化设定
- [ ] **设定关系网络** - 定义设定间的父子、同盟、敌对、从属关系
- [ ] **AI 一键生成设定树** - 输入核心创意自动生成世界观设定树
- [ ] **设定生成策略** - 内置多种设定模板（网文、科幻、玄幻等）
- [ ] **增量式设定修改** - 对生成的设定进行手动或 AI 局部调整
- [ ] **设定历史快照** - 所有设定生成保存为历史快照
- [ ] **设定版本对比** - 不同版本设定的对比和恢复
- [ ] **设定可视化展示** - 图形化展示世界观结构
- [ ] **设定搜索和过滤** - 快速查找特定设定条目

### 18.6 写作分析与统计

- [ ] **作者仪表盘** - 总字数、写作天数、连续写作天数统计
- [ ] **月度写作报告** - 当月新增字数与 Token 消耗报告
- [ ] **Token 消耗趋势图** - 可视化展示每日/每月 Token 使用趋势
- [ ] **功能使用分布** - 统计各项 AI 功能的使用频率
- [ ] **模型偏好分析** - 展示不同 AI 模型的使用占比
- [ ] **写作效率分析** - 每日/每周产出字数统计
- [ ] **写作习惯分析** - 高产时段、平均写作速度分析
- [ ] **近期活动记录** - 查看最近的 AI 调用和创作记录

### 18.7 知识库拆书系统

> 通过 AI 分析优秀作品，提取可复用的创作知识

- [ ] **多维度知识提取** - 文风叙事、情节设计、人物塑造、小说特点等
- [ ] **文风叙事分析** - 提取叙事方式、文风特点、用词习惯
- [ ] **情节设计分析** - 核心冲突、悬念设计、故事节奏
- [ ] **人物塑造分析** - 角色塑造技巧与性格刻画
- [ ] **读者情绪分析** - 共鸣点、爽点布局、嗨点设计
- [ ] **热梗搞笑提取** - 流行梗、搞笑点、网络文化元素
- [ ] **章节大纲提取** - 章节结构与情节发展脉络
- [ ] **第三方小说抓取** - 集成小说网站拆书服务（需配置）
- [ ] **自定义文本拆书** - 上传任意小说文本进行分析
- [ ] **分组批量任务** - 同时提取多个知识维度，后台异步处理
- [ ] **拆书任务管理** - 管理员监控拆书任务状态和进度
- [ ] **知识库搜索** - 搜索已提取的创作知识

---

## 十九、积分与计费系统

> **参考项目**：马良 AI 写作 - 用户积分与订阅管理

### 19.1 积分管理

- [ ] **用户积分体系** - 用户积分余额管理
- [ ] **积分充值** - 管理员为用户充值积分
- [ ] **积分消耗记录** - 记录每次 AI 调用的积分消耗
- [ ] **积分赠送** - 注册赠送、活动赠送初始积分
- [ ] **积分统计报表** - 按用户/时间统计积分变动
- [ ] **积分预警** - 积分不足自动提醒用户
- [ ] **积分导出** - 导出积分消耗明细为 CSV

### 19.2 订阅与会员

- [ ] **订阅计划管理** - 创建和管理订阅套餐
- [ ] **订阅状态跟踪** - 查看用户订阅状态和到期时间
- [ ] **自动续订** - 支持自动续订功能
- [ ] **会员权益配置** - 配置不同会员等级的功能权益
- [ ] **免费试用** - 新用户免费试用期管理
- [ ] **订阅统计** - 订阅用户数、续订率统计

### 19.3 模型定价与计费

- [ ] **模型分层计价** - 按 provider + modelId 维护计价信息
- [ ] **成本核算** - 结合 LLM 调用日志计算实际成本
- [ ] **计费审计** - 计费记录审计和查询
- [ ] **成本预估** - 调用前预估成本
- [ ] **定价策略管理** - 灵活配置不同模型的定价
- [ ] **成本报表生成** - 生成按用户/模型/时间的成本报表
- [ ] **成本告警** - 成本超过阈值自动告警
- [ ] **Token 计价器** - 根据 Token 数量计算费用

### 19.4 计费与结算

- [ ] **计费规则引擎** - 灵活配置计费规则
- [ ] **账单生成** - 自动生成用户账单
- [ ] **支付对接** - 集成第三方支付（微信、支付宝）
- [ ] **发票管理** - 电子发票生成和管理
- [ ] **财务对账** - 平台财务对账功能
- [ ] **退款管理** - 退款申请和处理流程

---

## 二十、内容审核系统

> **参考项目**：马良 AI 写作 - 内容审核与管理

### 20.1 内容审核

- [ ] **人工审核** - 管理员人工审核用户提交内容
- [ ] **AI 辅助审核** - AI 预审核标记疑似违规内容
- [ ] **审核队列** - 待审核内容队列管理
- [ ] **审核历史** - 审核记录和历史查询
- [ ] **多级审核** - 支持初审、复审多级审核流程
- [ ] **审核标准配置** - 配置审核规则和标准
- [ ] **敏感词过滤** - 敏感词库管理和自动过滤
- [ ] **违规内容处理** - 下架、警告、封禁等处理措施

### 20.2 内容管理

- [ ] **公开内容管理** - 管理用户发布的公开作品
- [ ] **内容分类** - 作品分类和标签管理
- [ ] **内容推荐** - 优质内容推荐机制
- [ ] **内容统计** - 公开作品数量、阅读量统计
- [ ] **内容举报** - 用户举报不良内容
- [ ] **举报处理** - 处理用户举报记录

### 20.3 合规管理

- [ ] **合规检查** - 自动合规性检查
- [ ] **版权保护** - 版权声明和侵权检测
- [ ] **实名认证** - 用户实名认证管理
- [ ] **年龄分级** - 内容年龄分级标记
- [ ] **合规报告** - 生成平台合规报告
- [ ] **法律风险提示** - 风险内容提示和建议

---

## 📊 功能完成度统计

### 按模块统计

| 模块          | 已实现功能 | 未实现功能 | 完成度 |
| ------------- | ---------- | ---------- | ------ |
| 核心架构      | 10         | 1          | 91%    |
| 多 Agent 系统 | 18         | 5          | 78%    |
| 工作流引擎    | 30         | 8          | 79%    |
| AI 模型集成   | 24         | 6          | 80%    |
| RAG 知识库    | 24         | 11         | 69%    |
| 多租户权限    | 26         | 9          | 74%    |
| 认证授权      | 17         | 8          | 68%    |
| 工具插件      | 22         | 12         | 65%    |
| 代码搜索      | 7          | 4          | 64%    |
| 工作空间      | 9          | 6          | 60%    |
| 通知系统      | 9          | 6          | 60%    |
| 审计监控      | 10         | 8          | 56%    |
| 文件管理      | 5          | 3          | 63%    |
| 模板管理      | 5          | 3          | 63%    |
| 异步任务      | 6          | 3          | 67%    |
| API 集成      | 18         | 4          | 82%    |
| 部署运维      | 19         | 13         | 59%    |
| 内容创作增强  | 0          | 62         | 0%     |
| 积分计费系统  | 0          | 29         | 0%     |
| 内容审核      | 0          | 20         | 0%     |

### 总体统计

- **总功能数**：375+ 项（新增 125 项）
- **已实现**：251 项
- **未实现**：224 项
- **整体完成度**：**~67%**

### 本次更新（2025-11-27 v1.2.0）

**新增功能**：14 项

- 硬盘缓存存储（L3 层）：8 项
- HTTP 客户端工具库：6 项

### 新增功能模块说明

**参考自马良 AI 写作项目（MaliangAINovalWriter）**：

- **内容创作增强功能**（62 项）：层级化内容管理、富文本编辑器、剧情推演、世界观构建、写作分析、知识库拆书等
- **积分与计费系统**（29 项）：积分管理、订阅会员、模型定价、计费结算等
- **内容审核系统**（20 项）：人工审核、AI 辅助审核、内容管理、合规管理等

---

## 🎯 下一步优先级

### 高优先级（P0）

1. **代码搜索 HTTP API** - 补充 Handler 层，前端可直接调用
2. **Handler 测试覆盖** - 11 个模块缺失测试，需补充单元测试
3. **工作流可视化编辑器** - 拖拽式流程设计（前端）
4. **密钥管理加固** - 密钥轮换、环境变量校验

### 中优先级（P1）

5. **混合检索（Hybrid Search）** - 向量 + BM25 结合检索
6. **重排序（Rerank）** - 优化检索结果相关性
7. **限流中间件** - API Rate Limiting 防刷
8. **Kubernetes 部署配置** - 生产环境 K8s 支持
9. **Grafana 监控大盘** - 可视化性能监控

### 低优先级（P2）

10. **更多 OAuth2 提供商** - 微信、企业微信、钉钉
11. **代码解释器** - 安全沙箱代码执行
12. **模板市场** - 社区模板分享
13. **移动端推送** - APNs / FCM 集成

### 新增功能优先级（参考马良 AI 写作）

**建议根据业务场景选择性实现：**

**P1 - 适合通用内容创作平台**：

- 剧情推演系统（多模型抽卡、分支剧情）
- 写作分析与统计（作者仪表盘、Token 趋势图）
- 积分管理系统（基础积分体系）
- 富文本编辑器（基础版本）

**P2 - 适合小说创作垂直平台**：

- 层级化内容管理（作品-卷-章节-场景）
- 世界观构建系统（设定树、关系网络）
- 知识库拆书系统（多维度知识提取）
- 片段管理和快速开始向导

**P3 - 适合商业化运营平台**：

- 订阅与会员系统
- 模型定价与计费审计
- 内容审核系统（人工+AI 辅助）
- 合规管理（版权保护、实名认证）

---

## 📝 备注

1. **测试覆盖率**：当前测试覆盖率约 42%（16/38 模块有测试），需持续提升
2. **迁移脚本规范化**：存在重复编号（0007），需整理迁移脚本编号
3. **前端开发**：当前主要为后端功能，前端控制台需独立开发
4. **文档更新**：功能实现后需及时更新本文档
5. **新增功能模块**：参考马良 AI 写作项目，新增 111 项功能需求，建议根据业务场景选择性实现

---

## 更新日志

### 2025-11-27 v1.2.0

- **新增硬盘缓存方案**（8 项功能）：
  - SQLite 硬盘缓存（L3 层） - 持久化缓存数据库
  - 三层缓存架构：L1(内存) → L2(Redis) → L3(SQLite)
  - 缓存回填机制、LRU 淘汰策略
  - 缓存统计服务、自动过期清理
  - 详细文档：[硬盘缓存与互联网检索复用方案.md](./硬盘缓存与互联网检索复用方案.md)
- **新增 HTTP 客户端工具库**（6 项功能）：
  - 通用 HTTP 工具类（httputil.Client）
  - 带缓存的 HTTP 客户端（httputil.CachedClient）
  - HTTP 代理、重试、限流支持
  - 可复用的 HTTP 封装，减少重复代码
- **更新统计数据**：
  - 总功能数从 361+ 增至 375+（新增 14 项实施功能）
  - 已实现从 250 项增至 251 项
  - 工具插件模块：22 个功能（12 个未实现）
  - 部署运维模块：19 个功能（13 个未实现）
- **文档链接更新**：
  - 17.4 大模型缓存机制：新增硬盘缓存实施方案文档链接
  - 8.4 HTTP 客户端工具库：新增详细实现文档链接

### 2025-11-27 v1.1.0

- **新增功能模块**（参考马良 AI 写作项目）：
  - 十八、内容创作增强功能（62 项）- 层级化内容、富文本编辑器、剧情推演、世界观构建、写作分析、知识库拆书
  - 十九、积分与计费系统（29 项）- 积分管理、订阅会员、模型定价、计费结算
  - 二十、内容审核系统（20 项）- 人工审核、AI 辅助审核、内容管理、合规管理
- **更新统计数据**：
  - 总功能数从 250+ 增至 361+（新增 111 项）
  - 整体完成度从 71% 更新至 69%（分母增大）
- **制定新增功能优先级**：按业务场景分为通用平台、垂直平台、商业化平台三个层级
- **补充参考项目信息**：明确标注参考来源为 MaliangAINovalWriter

### 2025-11-27 v1.0.0

- 初始化功能清单文档
- 梳理 17 大模块功能
- 统计已实现和未实现功能
- 制定下一步优先级

---

**文档维护者**：项目开发团队  
**反馈渠道**：GitHub Issues
