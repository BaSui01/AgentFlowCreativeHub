## 范围
- 前端层面补齐 RBAC 规范：权限上下文、路由拆分、按钮级控制。
- 实现租户角色与用户分配 UI，并对接后端 `/api/tenants/:id/*` 新接口。
- 对公开/认证/管理接口进行分层封装与认证流完善（refresh/logout）。

## 实施步骤
1. **权限上下文与通用守卫**
   - 在 `features/auth` 下新增 `useAuthorization.ts`，基于 `user.roles`/`user.permissions`（若后端返回 `permissions` 字段则直接使用，否则由角色映射表推导）暴露 `hasRole`、`hasAnyPermission`。
   - 为 axios 实例新增 401 Hook：检测到权限变更或 token 失效时自动触发 `logout()`。
   - 新增 `PermissionGuard` 组件（位于 `shared/ui`），支持 `requiredRoles`/`requiredPermissions`，结合 `ProtectedRoute` 用于路由与组件包裹。
   - 在 `DashboardPage` 等组件的操作按钮上引入 `PermissionGuard` 或基于 hook 的 `disabled={!hasPermission('workspace:review')}`，确保未授权用户仅可查看。

2. **路由结构与页面拆分**
   - 扩展 `AppRouter`：新增 `/admin` 布局（复用 `MainLayout` 或建 `AdminLayout`），其中包括“角色管理”“用户管理”“系统设置”。
   - 登录前（`AuthLayout`）增加系统健康/就绪读取：抽取 `PublicAPI.getHealth/getReady` 放在登录页侧边展示。
   - 将审核、命令执行等高权限组件迁移到 `/admin/review` 等路由，普通 `/dashboard` 仅保留文件浏览与个人任务。

3. **角色/用户管理 UI**
   - 在 `features/admin` 内新增：
     - `RoleListPage`：表格显示角色、描述、权限数；支持创建/编辑对话框，调用 `POST/PUT /api/tenants/:id/roles`。
     - `RoleForm`：复选框/树控件展示权限点（调用 `GET /api/permissions`）。
     - `UserRoleAssignment`：列表显示用户与其角色，支持批量赋权 `PUT /api/tenants/:id/users/:uid/roles`。
   - 共享 `useTenantContext()`（若无则新增）获取当前 tenantId，统一传参。
   - 为上述页面编写 React Query hooks（`useRoles`, `usePermissions`, `useUserRoles`）。

4. **接口封装与认证流**
   - 在 `src/api` 下新增 `public.ts`（公开接口）与 `admin.ts`（管理接口）模块，将现有 `WorkspaceAPI` 保留在 `features` 层但拆出管理专用方法（如 `reviewStaging` 移到 `AdminWorkspaceAPI`）。
   - 在 `AuthProvider` 中串联 refresh：拦截 axios 401，若存在 refreshToken 且错误为过期则调用 `POST /api/auth/refresh`，更新 token；失败时执行 `logout()`。
   - 登录页增加“注销全部设备”按钮，调用 `POST /api/auth/logout`。

5. **验证与文档（若允许）**
   - 单元测试：
     - `useAuthorization`：mock 用户权限，覆盖命中/未命中、空角色场景。
     - `PermissionGuard`：使用 React Testing Library 断言条件渲染。
     - 角色页面：快照 + 交互测试（创建/更新/赋权）。
   - 运行 `npm run lint && npm run test`。
   - 如需文档更新，仅在 `docs/spec` 内补充实现说明（遵循“无需新增 README”要求）。

## 风险与注意点
- 后端需确保用户信息包含角色/权限或新增 `/api/me/permissions` 接口，前端需在 AuthProvider 登录成功后同步更新。
- 权限点常量建议集中定义（`features/auth/constants.ts`），与后端枚举保持一致。
- 管理端页面需在无权限访问时返回 403 提示页，避免空白。

确认后可进入编码阶段，按照上述步骤逐项落地。