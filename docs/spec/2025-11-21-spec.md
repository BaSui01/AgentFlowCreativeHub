# 后端实现差距分析与行动计划

经过对现有代码库和需求文档的详细审查，我识别出以下**必须在前端开发前**完成的后端核心功能缺失（Gap）。目前的实现中存在多个 Mock（模拟）实现，不足以支撑真实的业务场景。

## 1. 核心功能缺失（高优先级）

### A. RAG 检索增强（真实实现）
*   **关键词检索 (BM25)**: 目前 `SimpleKeywordSearcher` 是一个返回空结果的模拟实现。
    *   **需求**: [R-02] 混合检索。
    *   **行动**: 基于 **PostgreSQL Full Text Search (tsvector)** 实现真正的关键词检索器。这可以避免引入 Elasticsearch 等额外依赖，保持架构轻量。
*   **重排序 (Rerank)**: `SimpleReranker` 仅根据字符串长度排序，毫无相关性可言。
    *   **需求**: [R-03] 重排序。
    *   **行动**: 实现对接外部 Rerank API（如 Cohere/Jina/SiliconFlow）的标准接口。

### B. 文档解析能力
*   **PDF/Word 支持**: `ParserRegistry` 仅实现了 `TextParser` (.txt/.md)。
    *   **需求**: [R-01] 多格式文档解析。
    *   **行动**: 集成 `rsc/pdf` 或 `unidoc` 库实现 **PDFParser**，这对于“知识库”功能至关重要。

## 2. 工作流引擎缺失

### A. 条件分支逻辑 (Condition)
*   **现状**: `parser.go` 中定义了 `Condition` 结构体，但 `AutomationEngine` 和 `Scheduler` 中似乎缺少具体的**表达式评估逻辑**。
*   **风险**: 如果不支持 `score > 80` 这样的判断，工作流将无法实现智能分支，只能线性执行。
*   **行动**: 实现基于 `govaluate` 或类似库的表达式求值器，并在调度器中集成。

## 3. 安全与鉴权

### A. 租户 API Key
*   **现状**: 目前的模型凭证是管理模型用的，但缺乏**租户级 API Key** 供外部系统调用本平台的 API。
*   **行动**: 实现 `TenantAPIKey` 的创建、验证与管理接口。

---

## 🚀 建议的立即执行计划

为了确保后端交付质量，建议按以下顺序填补空白：

1.  **实现 Postgres 关键词检索**: 替换 Mock，打通混合检索全流程。
2.  **实现 PDF 解析器**: 允许用户上传 PDF 文档并建立索引。
3.  **完善条件执行器**: 确保工作流的分支逻辑真实可用。

**您是否同意先完成这三个后端核心功能的实装，再进入前端开发？**