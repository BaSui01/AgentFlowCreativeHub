## 目标
- 回答“需求是否完善、功能是否已实现”这一问题，并重点聚焦前端侧的权限控制与接口分层（公开/认证/管理）。
- 给出当前实现现状、与既有规格（如《2025-11-21-rbac*.md》与命令控制方案）之间的差距、以及后续前端改造建议。

## 现状调研要点
1. **认证能力**：`features/auth/model/auth-context.tsx` + `shared/ui/ProtectedRoute.tsx` 仅实现登录态校验，支持 token 缓存，但缺少角色或权限粒度判断；`AXIOS_INSTANCE` 会全局附带 Bearer token。
2. **工作台功能**：`pages/dashboard/DashboardPage.tsx` 汇聚文件树、文件编辑、稿件审核、命令控制；`WorkspaceAPI`/`CommandConsole`/`useCommandStatus` 已按 2025-11-21 的命令串接规格落地，功能基本完成且所有操作对所有登录用户开放。
3. **文档期望**：`docs/spec/2025-11-21-rbac*.md` 规划了租户级角色管理 UI 与权限点覆盖，但前端尚未接入任何角色列表、权限矩阵、或接口分层逻辑。

## 权限与接口分类现状
- **公开接口**：后端 `/health`、`/ready`、`/api/auth/login` 设计为公开，但前端仅在登录前暴露 `/auth/login`；健康/就绪调用被放在受保护的 Dashboard 内，意味着登录前无法获取系统状态。
- **认证接口**：`AuthService.postApiAuthLogin`/`postApiAuthLogout` 已生成但只在 Login + 未使用 refresh；`refresh`/`logout` API 未接入 UI。
- **认证权限接口**：所有工作区 API（文件、命令、稿件审核）按 Bearer token 访问，但前端缺少 `hasPermission` 判断，按钮/入口不会基于 `user.roles` 做限制，管理功能与普通成员无隔离。
- **管理接口**：文档定义的 `/api/tenants/:id/roles` 等尚无前端封装，也没有租户设置页或角色管理路由。

## 差距评估
- ✅ **已完成**：命令执行、稿件审核、文件 CRUD 等核心工作区功能；登录流程与受保护主布局；基础 API 封装。
- ⚠️ **缺失/未完成**：
  - 角色/权限 UI 及 API 调用完全缺位，与 RBAC 规格不符。
  - 前端没有“管理端”概念，所有用户均可看到管理功能（审核、命令、目录管理）。
  - 无公共/只读视图；系统健康信息无法在登录前查看。
  - 登录后 token 不刷新、登出接口未接入，可能导致权限变更后前端状态不同步。

## 建议的前端改造方向
1. **权限上下文**：在 `useAuth` 之上扩展 `useAuthorization` Hook，解析 `user.roles` 与后端返回的权限点，引入 `hasRole/hasPermission`，并在 `ProtectedRoute` 基础上增加 `PermissionGuard`。
2. **路由拆分**：
   - `/dashboard` 作为普通成员默认工作台；
   - `/admin/*`（新建）挂载租户管理、角色权限、审核工作流等，只对管理员/指定权限开放；
   - 在登录页旁提供公开的系统健康提示和 OAuth 入口。
3. **管理功能 UI**：
   - 新增“租户角色”与“用户角色”页面，使用 orval 生成的角色 API（待后端合并）完成 CRUD；
   - 在用户列表（若后续存在）提供角色分配对话框；
   - 为文件/命令/审核操作添加按钮级权限判断与禁用态。
4. **接口分层封装**：
   - 在 `WorkspaceAPI` 基础上，将管理端接口分出 `AdminAPI`，避免误用；
   - 对公开接口（health/ready）提供无需 token 的 `PublicAPI`，可在登录页展示系统状态。
5. **认证流完善**：实现刷新令牌逻辑与 `logout` 调用，确保权限调整后强制同步；在 token 失效时自动回到登录页。

上述分析表明：除命令串接等既有功能外，权限控制与接口分层需求尚未落地。若方案认可，可继续细化实现计划与任务拆分。