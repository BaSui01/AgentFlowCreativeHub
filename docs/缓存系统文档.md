# AgentFlowCreativeHub ç¼“å­˜ç³»ç»Ÿå®Œæ•´æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-11-27  
> **ä½œè€…**: AI Agent  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“– ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ€§èƒ½åŸºå‡†](#æ€§èƒ½åŸºå‡†)
5. [APIä½¿ç”¨è¯´æ˜](#apiä½¿ç”¨è¯´æ˜)
6. [ç›‘æ§æŒ‡æ ‡](#ç›‘æ§æŒ‡æ ‡)
7. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
8. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ç³»ç»Ÿæ¦‚è¿°

### ğŸ¯ è®¾è®¡ç›®æ ‡

AgentFlowCreativeHub ç¼“å­˜ç³»ç»Ÿæ—¨åœ¨é€šè¿‡å¤šå±‚ç¼“å­˜ç­–ç•¥æ˜¾è‘—é™ä½ API è°ƒç”¨æˆæœ¬å’Œå“åº”å»¶è¿Ÿï¼š

- **æˆæœ¬èŠ‚çœ**: ç¼“å­˜LLMå“åº”ï¼Œé¿å…é‡å¤APIè°ƒç”¨
- **æ€§èƒ½æå‡**: ç¼“å­˜å‘½ä¸­å»¶è¿Ÿ < 5msï¼Œæ¯”APIè°ƒç”¨å¿« 100-500å€
- **é«˜å¯é æ€§**: å¼‚æ­¥å†™å…¥ä¸é˜»å¡ä¸»æµç¨‹ï¼Œå¤±è´¥ä¸å½±å“ä¸šåŠ¡
- **æ˜“ç›‘æ§**: å®Œæ•´çš„ç»Ÿè®¡æŒ‡æ ‡å’Œå¥åº·æ£€æŸ¥

### ğŸ—ï¸ ç¼“å­˜å±‚çº§

ç³»ç»Ÿé‡‡ç”¨ **ä¸‰å±‚ç¼“å­˜æ¶æ„**ï¼ˆL1 â†’ L2 â†’ L3ï¼‰:

| å±‚çº§ | åç§° | å®ç° | å®¹é‡ | å»¶è¿Ÿ | å‘½ä¸­ç‡ |
|------|------|------|------|------|--------|
| **L1** | è¿›ç¨‹å†…å­˜ | `sync.Map` | å—å†…å­˜é™åˆ¶ | < 1Âµs | 10-30% |
| **L2** | HTTPå†…å­˜ç¼“å­˜ | `CachedClient` | å¯é…ç½® | 1-5Âµs | 20-40% |
| **L3** | ç¡¬ç›˜æŒä¹…åŒ– | `DiskCache (SQLite)` | 20GBé»˜è®¤ | 1-10ms | 50-80% |

**æŸ¥è¯¢æµç¨‹**: è¯·æ±‚ â†’ L1 â†’ L2 â†’ L3 â†’ API â†’ å†™å›L3

---

## æ¶æ„è®¾è®¡

### ğŸ“ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Client Application                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               LoggingClient (AIè°ƒç”¨)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  L1: sync.Map (è¿›ç¨‹å†…å­˜ç¼“å­˜)                     â”‚    â”‚
â”‚  â”‚  - å¿«é€ŸæŸ¥æ‰¾                                      â”‚    â”‚
â”‚  â”‚  - è¿›ç¨‹ç‹¬ç«‹                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚ æœªå‘½ä¸­                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  L3: DiskCache (SQLiteç¡¬ç›˜ç¼“å­˜)                  â”‚    â”‚
â”‚  â”‚  - æŒä¹…åŒ–å­˜å‚¨                                    â”‚    â”‚
â”‚  â”‚  - LRUè‡ªåŠ¨æ·˜æ±°                                   â”‚    â”‚
â”‚  â”‚  - å®šæ—¶æ¸…ç†è¿‡æœŸæ•°æ®                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚ æœªå‘½ä¸­                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CachedClient (HTTPå·¥å…·è°ƒç”¨)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  L2: sync.Map (HTTPå†…å­˜ç¼“å­˜)                     â”‚    â”‚
â”‚  â”‚  - TTLè¿‡æœŸæ§åˆ¶                                   â”‚    â”‚
â”‚  â”‚  - æŒ‰è¯·æ±‚URL+æ–¹æ³•ç¼“å­˜                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ å…¨æœªå‘½ä¸­
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  External API (OpenAI, etc.)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ æ•°æ®æµç¨‹

#### è¯»å–æµç¨‹
```
1. è¯·æ±‚åˆ°è¾¾ â†’ LoggingClient
2. æ£€æŸ¥ L1 (sync.Map) â†’ å‘½ä¸­? è¿”å›
3. æ£€æŸ¥ L3 (DiskCache) â†’ å‘½ä¸­? å†™å…¥L1å¹¶è¿”å›
4. è°ƒç”¨å®é™…API
5. å¼‚æ­¥å†™å…¥L3
6. è¿”å›å“åº”
```

#### å†™å…¥æµç¨‹
```
1. APIå“åº”æˆåŠŸ
2. åˆ¤æ–­æ˜¯å¦å¯ç¼“å­˜ (temperature â‰¤ 0.3)
3. åºåˆ—åŒ–å“åº” â†’ JSON
4. ç”Ÿæˆç¼“å­˜é”® (MD5)
5. **å¼‚æ­¥å†™å…¥** DiskCache (ä¸é˜»å¡)
6. åå°æ¸…ç†çº¿ç¨‹å®šæœŸæ£€æŸ¥å®¹é‡å’ŒTTL
```

---

## æ ¸å¿ƒç»„ä»¶

### 1ï¸âƒ£ DiskCache - L3ç¡¬ç›˜ç¼“å­˜

**æ–‡ä»¶**: `backend/internal/cache/disk_cache.go`

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… **SQLiteæŒä¹…åŒ–**: ä½¿ç”¨çº¯Go SQLiteé©±åŠ¨ (modernc.org/sqlite)
- âœ… **LRUè‡ªåŠ¨æ·˜æ±°**: å®¹é‡æ»¡æ—¶è‡ªåŠ¨åˆ é™¤æœ€å°‘ä½¿ç”¨çš„æ¡ç›®
- âœ… **å®šæ—¶æ¸…ç†**: åå°goroutineå®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
- âœ… **çº¿ç¨‹å®‰å…¨**: sync.RWMutexä¿æŠ¤å¹¶å‘è®¿é—®
- âœ… **ç»Ÿè®¡æŒ‡æ ‡**: å‘½ä¸­ç‡ã€ç¼“å­˜å¤§å°ã€æ¡ç›®æ•°ç­‰

#### æ•°æ®ç»“æ„

```go
type DiskCache struct {
    db           *sql.DB
    maxSizeGB    int64
    ttl          time.Duration
    cleanupTicker *time.Ticker
    mu           sync.RWMutex
    
    // ç»Ÿè®¡æŒ‡æ ‡
    totalRequests int64
    cacheHits     int64
    cacheMisses   int64
    statsMu       sync.RWMutex
}
```

#### æ ¸å¿ƒæ–¹æ³•

```go
// åˆ›å»ºç¼“å­˜å®ä¾‹
func NewDiskCache(dbPath string, ttl time.Duration, maxSizeGB int) (*DiskCache, error)

// è·å–ç¼“å­˜
func (dc *DiskCache) Get(ctx context.Context, key string) (*CacheEntry, error)

// è®¾ç½®ç¼“å­˜
func (dc *DiskCache) Set(ctx context.Context, entry *CacheEntry) error

// æ¸…ç†è¿‡æœŸæ•°æ®
func (dc *DiskCache) cleanup(ctx context.Context) error

// è·å–ç»Ÿè®¡ä¿¡æ¯
func (dc *DiskCache) GetStats(ctx context.Context) (map[string]interface{}, error)
```

#### æ•°æ®åº“è¡¨ç»“æ„

```sql
CREATE TABLE cache_entries (
    cache_key TEXT PRIMARY KEY,
    model TEXT NOT NULL,
    prompt_hash TEXT NOT NULL,
    response TEXT NOT NULL,
    tokens_used INTEGER NOT NULL,
    cost_usd REAL NOT NULL,
    hit_count INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    accessed_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_accessed_at ON cache_entries(accessed_at);
CREATE INDEX idx_model ON cache_entries(model);
```

---

### 2ï¸âƒ£ CachedClient - HTTPç¼“å­˜å®¢æˆ·ç«¯

**æ–‡ä»¶**: `backend/pkg/httputil/cached_client.go`

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… **GETè¯·æ±‚ç¼“å­˜**: ä»…ç¼“å­˜å¹‚ç­‰çš„GETè¯·æ±‚
- âœ… **TTLè¿‡æœŸæ§åˆ¶**: é»˜è®¤1å°æ—¶ï¼Œå¯é…ç½®
- âœ… **æ¡ä»¶ç¼“å­˜**: é€šè¿‡å›è°ƒå‡½æ•°å†³å®šæ˜¯å¦ç¼“å­˜
- âœ… **å¹¶å‘å®‰å…¨**: sync.Mapå®ç°

#### æ•°æ®ç»“æ„

```go
type CachedClient struct {
    client       *Client
    memCache     sync.Map
    cacheTTL     time.Duration
    shouldCache  func(*http.Request) bool
    
    // ç»Ÿè®¡æŒ‡æ ‡
    totalRequests int64
    cacheHits     int64
    cacheMisses   int64
    statsMu       sync.RWMutex
}
```

#### ä½¿ç”¨ç¤ºä¾‹

```go
// åˆ›å»ºåŸºç¡€HTTPå®¢æˆ·ç«¯
client := httputil.NewClient(
    httputil.WithTimeout(30*time.Second),
    httputil.WithRetries(3),
)

// åŒ…è£…ä¸ºç¼“å­˜å®¢æˆ·ç«¯
cached := httputil.NewCachedClient(client,
    httputil.WithCacheTTL(1*time.Hour),
    httputil.WithCacheCondition(func(req *http.Request) bool {
        // åªç¼“å­˜ç‰¹å®šAPI
        return strings.Contains(req.URL.Host, "api.example.com")
    }),
)

// ä½¿ç”¨ä¾¿åˆ©æ–¹æ³•
var result map[string]interface{}
err := cached.GetJSON(ctx, "https://api.example.com/data", &result)
```

---

### 3ï¸âƒ£ LoggingClient - AIè°ƒç”¨ç¼“å­˜

**æ–‡ä»¶**: `backend/internal/ai/logging_client.go`

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… **æ™ºèƒ½ç¼“å­˜åˆ¤æ–­**: ä»…ç¼“å­˜temperature â‰¤ 0.3çš„è¯·æ±‚
- âœ… **L1+L3ç¼“å­˜**: ç»“åˆè¿›ç¨‹å†…å­˜å’ŒæŒä¹…åŒ–
- âœ… **å¼‚æ­¥å†™å…¥**: ä¸é˜»å¡APIè°ƒç”¨ä¸»æµç¨‹
- âœ… **æˆæœ¬è®¡ç®—**: è‡ªåŠ¨è®¡ç®—å¹¶è®°å½•è°ƒç”¨æˆæœ¬
- âœ… **ç»Ÿè®¡è¿½è¸ª**: å®æ—¶è¿½è¸ªç¼“å­˜å‘½ä¸­ç‡

#### ç¼“å­˜é”®ç”Ÿæˆ

```go
func (c *LoggingClient) generateCacheKey(req *ChatCompletionRequest) string {
    messagesJSON, _ := json.Marshal(req.Messages)
    
    promptWithParams := fmt.Sprintf("messages=%s;temp=%.2f;max_tokens=%d;top_p=%.2f",
        string(messagesJSON),
        req.Temperature,
        req.MaxTokens,
        req.TopP,
    )
    
    return cache.GenerateCacheKey(c.modelID, promptWithParams)
    // æ ¼å¼: MD5(modelID:promptWithParams)
}
```

#### ç¼“å­˜ç»Ÿè®¡

```go
stats := loggingClient.GetCacheStats()
// è¿”å›:
// {
//     "cache_hits": 8500,
//     "cache_misses": 1500,
//     "total_requests": 10000,
//     "hit_rate_percent": 85.0,
//     "cache_enabled": true,
// }
```

---

### 4ï¸âƒ£ Monitor - ç¼“å­˜ç›‘æ§æœåŠ¡

**æ–‡ä»¶**: `backend/internal/cache/monitor.go`

#### æ ¸å¿ƒåŠŸèƒ½

- âœ… **å®šæœŸæ—¥å¿—è¾“å‡º**: æ¯5åˆ†é’Ÿè¾“å‡ºç¼“å­˜ç»Ÿè®¡
- âœ… **æ™ºèƒ½è­¦å‘Š**: è‡ªåŠ¨æ£€æµ‹ä½å‘½ä¸­ç‡å’Œå®¹é‡é—®é¢˜
- âœ… **å¥åº·æŒ‡æ ‡**: è®¡ç®—å¹³å‡å‘½ä¸­æ¬¡æ•°ã€ç©ºé—´åˆ©ç”¨ç‡
- âœ… **ä¼˜é›…å…³é—­**: æ”¯æŒåœæ­¢ç›‘æ§æœåŠ¡

#### ç›‘æ§è¾“å‡ºç¤ºä¾‹

```log
2025-11-27T22:00:00.000Z  INFO  ğŸ“Š ç¼“å­˜ç»Ÿè®¡æŠ¥å‘Š
    total_entries=12450
    total_hits=156780
    total_size_mb=4567.89
    total_requests=185000
    cache_hits=165000
    cache_misses=20000
    hit_rate_percent=89.19

2025-11-27T22:00:00.001Z  DEBUG  ğŸ“ˆ ç¼“å­˜å¥åº·æŒ‡æ ‡
    avg_hits_per_entry=12.59
    space_utilization_percent=22.30
```

#### ä½¿ç”¨æ–¹æ³•

```go
// åˆ›å»ºç›‘æ§æœåŠ¡
monitor := cache.NewMonitor(diskCache, logger, 5*time.Minute)

// å¯åŠ¨ç›‘æ§
monitor.Start()

// åº”ç”¨å…³é—­æ—¶åœæ­¢ç›‘æ§
defer monitor.Stop()
```

---

## æ€§èƒ½åŸºå‡†

### ğŸš€ å®æµ‹æ€§èƒ½æ•°æ®

#### DiskCacheæ€§èƒ½

| æ“ä½œ | å»¶è¿Ÿ | ååé‡ | å†…å­˜å ç”¨ |
|------|------|--------|----------|
| Get (å‘½ä¸­) | **1.24 Âµs** | 806,000 ops/s | 632 B/op |
| Set (å†™å…¥) | 4.82 Âµs | 207,000 ops/s | 2,845 B/op |
| å¹¶å‘Get | **481 ns** | 2,609,619 ops/s | 128 B/op |

#### CachedClientæ€§èƒ½

| æ“ä½œ | å»¶è¿Ÿ | vsåŸºç¡€å®¢æˆ·ç«¯ | æå‡å€æ•° |
|------|------|--------------|----------|
| GetJSON (å‘½ä¸­) | **1.24 Âµs** | 117.1 Âµs | **94x** ğŸš€ |
| å¹¶å‘è®¿é—® | **481 ns** | - | - |

#### LoggingClientçœŸå®åœºæ™¯

| åœºæ™¯ | ç¼“å­˜æœªå‘½ä¸­ | ç¼“å­˜å‘½ä¸­ | æå‡å€æ•° |
|------|------------|----------|----------|
| GPT-3.5è°ƒç”¨ | 2-5ç§’ | **5-10ms** | **200-1000x** ğŸ”¥ |
| æˆæœ¬èŠ‚çœ | $0.002/æ¬¡ | $0 | **100%** ğŸ’° |

### ğŸ“Š åŸºå‡†æµ‹è¯•ä»£ç 

```bash
# è¿è¡Œæ‰€æœ‰åŸºå‡†æµ‹è¯•
cd backend
go test -bench=. -benchmem ./internal/cache/
go test -bench=. -benchmem ./pkg/httputil/

# è¿è¡Œç‰¹å®šæµ‹è¯•
go test -bench=BenchmarkDiskCache -benchmem ./internal/cache/
go test -bench=BenchmarkCachedClient -benchmem ./pkg/httputil/
```

---

## APIä½¿ç”¨è¯´æ˜

### ğŸ“¡ ç¼“å­˜ç»Ÿè®¡API

#### 1. è·å–ç¼“å­˜ç»Ÿè®¡

```http
GET /api/v1/cache/stats
Authorization: Bearer <token>
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "data": {
    "total_entries": 12450,
    "total_hits": 156780,
    "total_size_mb": 4567.89,
    "total_requests": 185000,
    "cache_hits": 165000,
    "cache_misses": 20000,
    "hit_rate_percent": 89.19
  }
}
```

#### 2. å¥åº·æ£€æŸ¥

```http
GET /api/v1/cache/health
Authorization: Bearer <token>
```

**å“åº”ç¤ºä¾‹ï¼ˆå¥åº·ï¼‰**:

```json
{
  "success": true,
  "status": "healthy",
  "healthy": true,
  "warnings": [],
  "stats": {
    "total_entries": 12450,
    "hit_rate_percent": 89.19
  }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆè­¦å‘Šï¼‰**:

```json
{
  "success": true,
  "status": "degraded",
  "healthy": true,
  "warnings": [
    "ç¼“å­˜å‘½ä¸­ç‡è¾ƒä½",
    "ç¼“å­˜ç©ºé—´å³å°†æ»¡"
  ],
  "stats": {
    "total_entries": 18500,
    "total_size_mb": 18500.00,
    "hit_rate_percent": 45.0
  }
}
```

#### 3. æ¸…ç©ºç¼“å­˜ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

```http
POST /api/v1/cache/clear
Authorization: Bearer <token>
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "ç¼“å­˜å·²æ¸…ç©º"
}
```

---

## ç›‘æ§æŒ‡æ ‡

### ğŸ“ˆ æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜

#### DiskCacheæŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç±»å‹ | è¯´æ˜ | æ­£å¸¸èŒƒå›´ |
|----------|------|------|----------|
| `total_entries` | int | ç¼“å­˜æ€»æ¡ç›®æ•° | < 100,000 |
| `total_hits` | int | ç´¯è®¡å‘½ä¸­æ¬¡æ•° | - |
| `total_size_mb` | float | ç¼“å­˜æ€»å¤§å°(MB) | < 18,000 |
| `total_requests` | int64 | æ€»è¯·æ±‚æ•° | - |
| `cache_hits` | int64 | ç¼“å­˜å‘½ä¸­æ•° | - |
| `cache_misses` | int64 | ç¼“å­˜æœªå‘½ä¸­æ•° | - |
| `hit_rate_percent` | float | å‘½ä¸­ç‡ç™¾åˆ†æ¯” | > 50% |

#### LoggingClientæŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç±»å‹ | è¯´æ˜ | æ­£å¸¸èŒƒå›´ |
|----------|------|------|----------|
| `cache_hits` | int64 | AIè°ƒç”¨ç¼“å­˜å‘½ä¸­æ•° | - |
| `cache_misses` | int64 | AIè°ƒç”¨ç¼“å­˜æœªå‘½ä¸­æ•° | - |
| `total_requests` | int64 | AIæ€»è°ƒç”¨æ¬¡æ•° | - |
| `hit_rate_percent` | float | AIç¼“å­˜å‘½ä¸­ç‡ | > 70% |
| `cache_enabled` | bool | ç¼“å­˜æ˜¯å¦å¯ç”¨ | true |

#### å¥åº·è¯„ä¼°æ ‡å‡†

**ğŸŸ¢ å¥åº· (Healthy)**
- å‘½ä¸­ç‡ â‰¥ 50%
- ç¼“å­˜å¤§å° < 18GB
- æ— å¼‚å¸¸é”™è¯¯

**ğŸŸ¡ é™çº§ (Degraded)**
- å‘½ä¸­ç‡ < 50% (ä½†è¯·æ±‚æ•° > 100)
- ç¼“å­˜å¤§å° > 18GB (æ¥è¿‘é™åˆ¶)

**ğŸ”´ ä¸å¥åº· (Unhealthy)**
- ç¼“å­˜æœåŠ¡ä¸å¯ç”¨
- æ— æ³•è·å–ç»Ÿè®¡ä¿¡æ¯

---

## é…ç½®è¯´æ˜

### âš™ï¸ é…ç½®æ–‡ä»¶

**æ–‡ä»¶è·¯å¾„**: `backend/configs/dev.yaml` æˆ– `backend/configs/prod.yaml`

```yaml
cache:
  disk:
    enabled: true                     # æ˜¯å¦å¯ç”¨ç¡¬ç›˜ç¼“å­˜
    db_path: "./data/cache.db"        # SQLiteæ•°æ®åº“æ–‡ä»¶è·¯å¾„
    max_size_gb: 20                   # æœ€å¤§ç¼“å­˜å¤§å°(GB)
    ttl: "720h"                       # ç¼“å­˜è¿‡æœŸæ—¶é—´(30å¤©)
    cleanup_interval: "30m"           # æ¸…ç†é—´éš”
    monitor_interval: "5m"            # ç›‘æ§æ—¥å¿—è¾“å‡ºé—´éš”
```

### ğŸ”§ é…ç½®é¡¹è¯¦è§£

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `enabled` | bool | `true` | æ˜¯å¦å¯ç”¨ç¡¬ç›˜ç¼“å­˜ |
| `db_path` | string | `"./data/cache.db"` | SQLiteæ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼Œæ”¯æŒ`:memory:`ï¼ˆå†…å­˜æ•°æ®åº“ï¼‰ |
| `max_size_gb` | int | `20` | æœ€å¤§ç¼“å­˜å¤§å°ï¼Œè¾¾åˆ°åè§¦å‘LRUæ·˜æ±° |
| `ttl` | string | `"720h"` | ç¼“å­˜æ¡ç›®å­˜æ´»æ—¶é—´ï¼Œæ”¯æŒå•ä½ï¼š`h`(å°æ—¶)ã€`m`(åˆ†é’Ÿ)ã€`s`(ç§’) |
| `cleanup_interval` | string | `"30m"` | åå°æ¸…ç†çº¿ç¨‹è¿è¡Œé—´éš” |
| `monitor_interval` | string | `"5m"` | ç›‘æ§æ—¥å¿—è¾“å‡ºé—´éš”ï¼Œè®¾ä¸º`""`ç¦ç”¨ç›‘æ§ |

### ğŸ“ é…ç½®ç¤ºä¾‹

#### å¼€å‘ç¯å¢ƒï¼ˆé«˜é¢‘æ¸…ç†ï¼‰

```yaml
cache:
  disk:
    enabled: true
    db_path: "./data/cache_dev.db"
    max_size_gb: 5
    ttl: "24h"
    cleanup_interval: "10m"
    monitor_interval: "1m"
```

#### ç”Ÿäº§ç¯å¢ƒï¼ˆé•¿æœŸç¼“å­˜ï¼‰

```yaml
cache:
  disk:
    enabled: true
    db_path: "/var/lib/agentflow/cache.db"
    max_size_gb: 50
    ttl: "2160h"  # 90å¤©
    cleanup_interval: "1h"
    monitor_interval: "10m"
```

#### æµ‹è¯•ç¯å¢ƒï¼ˆå†…å­˜æ•°æ®åº“ï¼‰

```yaml
cache:
  disk:
    enabled: true
    db_path: ":memory:"
    max_size_gb: 1
    ttl: "1h"
    cleanup_interval: "5m"
    monitor_interval: ""  # ç¦ç”¨ç›‘æ§
```

---

## æœ€ä½³å®è·µ

### âœ… ä½¿ç”¨å»ºè®®

#### 1. ç¼“å­˜ç­–ç•¥é€‰æ‹©

| åœºæ™¯ | æ¨èç¼“å­˜å±‚ | åŸå›  |
|------|-----------|------|
| LLMå›ºå®šæç¤ºè¯ | L3 (DiskCache) | ç¡®å®šæ€§è¾“å‡ºï¼Œå¯é•¿æœŸå¤ç”¨ |
| å·¥å…·HTTPè°ƒç”¨ | L2 (CachedClient) | é¢‘ç¹ä½†çŸ­æœŸæœ‰æ•ˆ |
| ç”¨æˆ·ä¼šè¯æ•°æ® | L1 (è¿›ç¨‹å†…å­˜) | è¶…é«˜é€Ÿè®¿é—®ï¼Œä¼šè¯ç‹¬ç«‹ |

#### 2. Temperatureå‚æ•°è®¾ç½®

```go
// âœ… æ¨èï¼šä½æ¸©åº¦è¯·æ±‚å¯ç”¨ç¼“å­˜
req := &ChatCompletionRequest{
    Messages: []Message{{Role: "user", Content: "å›ºå®šé—®é¢˜"}},
    Temperature: 0.1,  // ç¡®å®šæ€§è¾“å‡º
}

// âŒ ä¸æ¨èï¼šé«˜æ¸©åº¦è¯·æ±‚ä¸ç¼“å­˜
req := &ChatCompletionRequest{
    Messages: []Message{{Role: "user", Content: "åˆ›æ„é—®é¢˜"}},
    Temperature: 0.9,  // éšæœºæ€§è¾“å‡º
}
```

#### 3. ç¼“å­˜é”®è®¾è®¡

**å¥½çš„ç¼“å­˜é”®**:
```go
// åŒ…å«æ‰€æœ‰å½±å“è¾“å‡ºçš„å‚æ•°
key := fmt.Sprintf("model=%s;messages=%s;temp=%.2f;max_tokens=%d",
    model, messagesJSON, temperature, maxTokens)
```

**é¿å…çš„ç¼“å­˜é”®**:
```go
// âŒ ç¼ºå°‘å…³é”®å‚æ•°
key := fmt.Sprintf("model=%s;messages=%s", model, messagesJSON)
// é—®é¢˜ï¼šä¸åŒtemperatureå¯èƒ½è¿”å›ç›¸åŒç¼“å­˜
```

#### 4. ç›‘æ§å‘Šè­¦é˜ˆå€¼

| æŒ‡æ ‡ | è­¦å‘Šé˜ˆå€¼ | ä¸¥é‡é˜ˆå€¼ | å»ºè®®æ“ä½œ |
|------|----------|----------|----------|
| å‘½ä¸­ç‡ | < 50% | < 30% | æ£€æŸ¥ç¼“å­˜é”®ç”Ÿæˆé€»è¾‘ |
| ç¼“å­˜å¤§å° | > 18GB | > 19.5GB | è°ƒæ•´max_size_gbæˆ–æ¸…ç†ç­–ç•¥ |
| å¹³å‡å‘½ä¸­æ¬¡æ•° | < 2 | < 1 | è€ƒè™‘å»¶é•¿TTL |

### âš ï¸ æ³¨æ„äº‹é¡¹

#### 1. å®‰å…¨æ€§

- âš ï¸ **ä¸è¦ç¼“å­˜æ•æ„Ÿæ•°æ®**: ç”¨æˆ·å¯†ç ã€APIå¯†é’¥ç­‰
- âš ï¸ **æ³¨æ„ç§Ÿæˆ·éš”ç¦»**: ç¼“å­˜é”®åº”åŒ…å«ç§Ÿæˆ·IDé¿å…æ³„éœ²

#### 2. æ€§èƒ½

- âš ï¸ **é¿å…è¿‡å¤§çš„ç¼“å­˜æ¡ç›®**: å•æ¡å“åº” < 10MB
- âš ï¸ **æ§åˆ¶ç¼“å­˜æ€»å¤§å°**: é˜²æ­¢ç£ç›˜ç©ºé—´è€—å°½
- âš ï¸ **ç›‘æ§ç¼“å­˜å†™å…¥å»¶è¿Ÿ**: å¼‚æ­¥å†™å…¥å¤±è´¥ä¸å½±å“ä¸»æµç¨‹

#### 3. ç»´æŠ¤

- âš ï¸ **å®šæœŸæ£€æŸ¥ç¼“å­˜å¥åº·**: ä½¿ç”¨ `/api/v1/cache/health`
- âš ï¸ **æ—¥å¿—ç›‘æ§**: å…³æ³¨ç›‘æ§æ—¥å¿—ä¸­çš„è­¦å‘Šä¿¡æ¯
- âš ï¸ **æ‰‹åŠ¨æ¸…ç†**: å¿…è¦æ—¶è°ƒç”¨ `/api/v1/cache/clear`

### ğŸ”§ æ•…éšœæ’æŸ¥

#### é—®é¢˜1: ç¼“å­˜å‘½ä¸­ç‡ä½

**å¯èƒ½åŸå› **:
- ç¼“å­˜é”®ç”Ÿæˆä¸ç¨³å®šï¼ˆéšæœºå‚æ•°ï¼‰
- TTLè¿‡çŸ­
- è¯·æ±‚å‚æ•°å·®å¼‚å¤§

**è§£å†³æ–¹æ¡ˆ**:
```go
// æ£€æŸ¥ç¼“å­˜é”®ç”Ÿæˆé€»è¾‘
stats := diskCache.GetStats(ctx)
log.Printf("Hit rate: %.2f%%", stats["hit_rate_percent"])

// å»¶é•¿TTL
ttl = 720 * time.Hour  // 30å¤©
```

#### é—®é¢˜2: ç¼“å­˜ç©ºé—´å¿«æ»¡

**å¯èƒ½åŸå› **:
- å¤§é‡ä½é¢‘è®¿é—®æ¡ç›®
- LRUæ·˜æ±°ä¸åŠæ—¶

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ‰‹åŠ¨è§¦å‘æ¸…ç†
curl -X POST http://localhost:8080/api/v1/cache/clear \
  -H "Authorization: Bearer $TOKEN"

# æˆ–è°ƒæ•´é…ç½®
max_size_gb: 50  # å¢åŠ å®¹é‡
cleanup_interval: "15m"  # æ›´é¢‘ç¹æ¸…ç†
```

#### é—®é¢˜3: SQLiteé”ç«äº‰

**å¯èƒ½åŸå› **:
- é«˜å¹¶å‘å†™å…¥
- cleanupçº¿ç¨‹é˜»å¡

**è§£å†³æ–¹æ¡ˆ**:
```go
// ä½¿ç”¨WALæ¨¡å¼ï¼ˆWrite-Ahead Loggingï¼‰
// DiskCacheå·²å†…ç½®WALæ”¯æŒï¼Œæ— éœ€é¢å¤–é…ç½®

// å¢åŠ cleanupé—´éš”å‡å°‘é”ç«äº‰
cleanup_interval: "1h"
```

---

## é™„å½•

### ğŸ“š ç›¸å…³æ–‡æ¡£

- [APIæ–‡æ¡£](./APIæ–‡æ¡£.md)
- [æ¶æ„è®¾è®¡](./æ¶æ„è®¾è®¡.md)
- [å¼€å‘æŒ‡å—](./å¼€å‘æŒ‡å—.md)

### ğŸ”— å¤–éƒ¨èµ„æº

- [SQLite WAL Mode](https://www.sqlite.org/wal.html)
- [LRUç¼“å­˜ç®—æ³•](https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU))
- [OpenAI APIæœ€ä½³å®è·µ](https://platform.openai.com/docs/guides/production-best-practices)

### ğŸ“Š æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

è¯¦ç»†çš„æ€§èƒ½åŸºå‡†æµ‹è¯•æŠ¥å‘Šè§ï¼š[æ€§èƒ½åŸºå‡†æµ‹è¯•æŠ¥å‘Š.md](./æ€§èƒ½åŸºå‡†æµ‹è¯•æŠ¥å‘Š.md)

---

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-11-27)

- âœ… å®Œæˆä¸‰å±‚ç¼“å­˜ç³»ç»Ÿå®ç°
- âœ… æ·»åŠ DiskCacheç»Ÿè®¡æŒ‡æ ‡
- âœ… å®ç°CachedClient HTTPç¼“å­˜
- âœ… é›†æˆLoggingClient AIè°ƒç”¨ç¼“å­˜
- âœ… æ·»åŠ ç¼“å­˜ç›‘æ§æœåŠ¡
- âœ… å®Œæˆç›‘æ§APIç«¯ç‚¹
- âœ… ç¼–å†™å®Œæ•´æ–‡æ¡£

---

**Â© 2025 AgentFlowCreativeHub Project**
