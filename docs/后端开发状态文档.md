# åç«¯å¼€å‘çŠ¶æ€æ–‡æ¡£

> æœ€åæ›´æ–°ï¼š2025-11-25
> ç‰ˆæœ¬ï¼šv1.0.2

---

## ä¸€ã€æ¶æ„æ¦‚è§ˆ

### 1.1 ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ api/                    # HTTP API å±‚
â”‚   â”œâ”€â”€ handlers/           # è¯·æ±‚å¤„ç†å™¨ï¼ˆ14ä¸ªå­æ¨¡å—ï¼‰
â”‚   â”‚   â”œâ”€â”€ agents/         # Agent ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ audit/          # å®¡è®¡æ—¥å¿—
â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯æˆæƒ
â”‚   â”‚   â”œâ”€â”€ commands/       # å‘½ä»¤æ‰§è¡Œ
â”‚   â”‚   â”œâ”€â”€ common/         # å…¬å…±å¤„ç†
â”‚   â”‚   â”œâ”€â”€ files/          # æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ knowledge/      # çŸ¥è¯†åº“
â”‚   â”‚   â”œâ”€â”€ models/         # æ¨¡å‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ notifications/  # é€šçŸ¥
â”‚   â”‚   â”œâ”€â”€ templates/      # æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tenant/         # ç§Ÿæˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tools/          # å·¥å…·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ workflows/      # å·¥ä½œæµ
â”‚   â”‚   â””â”€â”€ workspace/      # å·¥ä½œç©ºé—´
â”‚   â”œâ”€â”€ docs/               # Swagger æ–‡æ¡£
â”‚   â”œâ”€â”€ helpers.go          # è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ middleware.go       # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes.go           # è·¯ç”±æ³¨å†Œ
â”‚   â”œâ”€â”€ setup.go            # åˆå§‹åŒ–
â”‚   â””â”€â”€ wire.go             # ä¾èµ–æ³¨å…¥
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ server/             # ä¸»æœåŠ¡å…¥å£
â”‚   â””â”€â”€ tools/              # å·¥å…·å‘½ä»¤
â”œâ”€â”€ internal/               # æ ¸å¿ƒä¸šåŠ¡å±‚ï¼ˆ24ä¸ªæ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ agent/              # Agent æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ parser/         # è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ prompt/         # æç¤ºè¯
â”‚   â”‚   â””â”€â”€ runtime/        # è¿è¡Œæ—¶
â”‚   â”œâ”€â”€ ai/                 # AI å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ anthropic/
â”‚   â”‚   â”œâ”€â”€ azure/
â”‚   â”‚   â”œâ”€â”€ deepseek/
â”‚   â”‚   â”œâ”€â”€ google/
â”‚   â”‚   â”œâ”€â”€ ollama/
â”‚   â”‚   â”œâ”€â”€ openai/
â”‚   â”‚   â””â”€â”€ qwen/
â”‚   â”œâ”€â”€ audit/              # å®¡è®¡æœåŠ¡
â”‚   â”œâ”€â”€ auth/               # è®¤è¯æˆæƒ
â”‚   â”œâ”€â”€ codesearch/         # ä»£ç æœç´¢ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ command/            # å‘½ä»¤æœåŠ¡
â”‚   â”œâ”€â”€ common/             # å…¬å…±å·¥å…·
â”‚   â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ infra/              # åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ integration/        # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ knowledge/          # çŸ¥è¯†åº“ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ logger/             # æ—¥å¿—
â”‚   â”œâ”€â”€ metrics/            # ç›‘æ§æŒ‡æ ‡
â”‚   â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ notification/       # é€šçŸ¥æœåŠ¡
â”‚   â”œâ”€â”€ rag/                # RAG æ£€ç´¢å¢å¼º
â”‚   â”œâ”€â”€ security/           # å®‰å…¨
â”‚   â”œâ”€â”€ template/           # æ¨¡æ¿æœåŠ¡
â”‚   â”œâ”€â”€ tenant/             # å¤šç§Ÿæˆ·
â”‚   â”œâ”€â”€ tools/              # å·¥å…·ç³»ç»Ÿ
â”‚   â”œâ”€â”€ worker/             # å¼‚æ­¥ä»»åŠ¡
â”‚   â”œâ”€â”€ workflow/           # å·¥ä½œæµå¼•æ“
â”‚   â””â”€â”€ workspace/          # å·¥ä½œç©ºé—´
â”œâ”€â”€ pkg/                    # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ aiinterface/        # AI æ¥å£å®šä¹‰
â”‚   â””â”€â”€ types/              # å…¬å…±ç±»å‹
â””â”€â”€ tools/                  # æ„å»ºå·¥å…·
```

### 1.2 æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ |
|------|----------|
| Web æ¡†æ¶ | Gin |
| ORM | GORM |
| æ•°æ®åº“ | PostgreSQL |
| ç¼“å­˜/é˜Ÿåˆ— | Redis + Asynq |
| å‘é‡å­˜å‚¨ | PGVector / Qdrant |
| è®¤è¯ | JWT + OAuth2 |
| API æ–‡æ¡£ | Swagger |
| æ—¥å¿— | Zap |
| é…ç½® | Viper |

---

## äºŒã€æ¨¡å—çŠ¶æ€

### 2.1 çŠ¶æ€è¯´æ˜

- âœ… å®Œæˆ - åŠŸèƒ½å®Œæ•´ï¼Œæœ‰æµ‹è¯•
- ğŸŸ¡ åŸºæœ¬å®Œæˆ - æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œæµ‹è¯•ä¸è¶³
- ğŸ”¶ å¼€å‘ä¸­ - éƒ¨åˆ†åŠŸèƒ½å®Œæˆ
- â¬œ å¾…å¼€å‘ - ç©ºæˆ–éª¨æ¶ä»£ç 
- âŒ æœªå¼€å§‹ - è®¡åˆ’ä¸­

### 2.2 æ¨¡å—è¯¦æƒ…

#### API å±‚ï¼ˆapi/ï¼‰

| æ¨¡å— | çŠ¶æ€ | æµ‹è¯• | è¯´æ˜ |
|------|------|------|------|
| handlers/common | âœ… | æ—  | å…¬å…±å“åº”/é”™è¯¯å°è£… |
| handlers/agents | âœ… | æ—  | Agent CRUD + æ‰§è¡Œ |
| handlers/audit | âœ… | æ—  | å®¡è®¡æ—¥å¿—æŸ¥è¯¢ |
| handlers/auth | âœ… | æ—  | ç™»å½•/OAuth2/JWT |
| handlers/commands | ğŸŸ¡ | æ—  | å‘½ä»¤æ‰§è¡Œ API |
| handlers/files | ğŸŸ¡ | æ—  | æ–‡ä»¶æ ‘/å†…å®¹/å†å² |
| handlers/knowledge | ğŸŸ¡ | æ—  | çŸ¥è¯†åº“/æ–‡æ¡£/æœç´¢ |
| handlers/models | âœ… | æ—  | æ¨¡å‹ç®¡ç†/å‡­è¯/å‘ç° |
| handlers/notifications | ğŸŸ¡ | æ—  | WebSocket è¿æ¥ |
| handlers/templates | âœ… | æ—  | æ¨¡æ¿ CRUD |
| handlers/tenant | âœ… | âœ… | ç§Ÿæˆ·/ç”¨æˆ·/è§’è‰²/æƒé™ |
| handlers/tools | ğŸŸ¡ | âœ… | å·¥å…·æ³¨å†Œ/æ‰§è¡Œ |
| handlers/workflows | âœ… | âœ… | å·¥ä½œæµ/æ‰§è¡Œ/å®¡æ‰¹ |
| handlers/workspace | ğŸŸ¡ | æ—  | å·¥ä½œç©ºé—´/äº§å‡ºç‰© |
| routes.go | âœ… | - | è·¯ç”±æ³¨å†Œå®Œæ•´ |
| wire.go | âœ… | - | ä¾èµ–æ³¨å…¥å®¹å™¨ |

#### æ ¸å¿ƒä¸šåŠ¡å±‚ï¼ˆinternal/ï¼‰

| æ¨¡å— | çŠ¶æ€ | æµ‹è¯• | æ–‡ä»¶æ•° | è¯´æ˜ |
|------|------|------|--------|------|
| agent | ğŸŸ¡ | æ—  | 2 | Agent é…ç½®ç®¡ç† |
| agent/runtime | ğŸŸ¡ | âœ… | 21 | Agent è¿è¡Œæ—¶ã€7ç§è§’è‰² |
| ai | ğŸŸ¡ | âœ… | 18 | AI å®¢æˆ·ç«¯å·¥å‚ |
| ai/openai | âœ… | æ—  | - | OpenAI é€‚é…å™¨ |
| ai/anthropic | âœ… | æ—  | - | Claude é€‚é…å™¨ |
| ai/azure | âœ… | æ—  | - | Azure OpenAI |
| ai/deepseek | âœ… | æ—  | - | DeepSeek |
| ai/google | âœ… | æ—  | - | Gemini |
| ai/ollama | âœ… | æ—  | - | Ollama æœ¬åœ° |
| ai/qwen | âœ… | æ—  | - | é€šä¹‰åƒé—® |
| audit | ğŸŸ¡ | æ—  | 5 | äº‹ä»¶/æ—¥å¿—/Tokenå®¡è®¡ |
| auth | âœ… | âœ… | 9 | JWT/OAuth2/RBAC |
| codesearch | ğŸŸ¡ | æ—  | 3 | ACEæœç´¢+è¯­ä¹‰æœç´¢+ç¬¦å·è§£æ |
| command | ğŸŸ¡ | âœ… | 4 | å‘½ä»¤é˜Ÿåˆ—+Bashå®‰å…¨æ‰§è¡Œ |
| common | âœ… | æ—  | 3 | å…¬å…±å·¥å…·å‡½æ•° |
| config | âœ… | æ—  | 1 | é…ç½®åŠ è½½ |
| infra | âœ… | æ—  | 5 | DB/Redis åˆå§‹åŒ– |
| integration | ğŸ”¶ | âœ… | 1 | E2E æµ‹è¯• |
| knowledge | ğŸŸ¡ | æ—  | 1 | ä»£ç å¤‡å¿˜å½•æœåŠ¡ |
| logger | âœ… | æ—  | 1 | Zap å°è£… |
| metrics | ğŸŸ¡ | æ—  | 3 | Prometheus æŒ‡æ ‡æ”¶é›† |
| middleware | âœ… | âœ… | 3 | ç§Ÿæˆ·ä¸Šä¸‹æ–‡ä¸­é—´ä»¶ |
| models | âœ… | âœ… | 9 | æ•°æ®æ¨¡å‹/æœåŠ¡ |
| notification | ğŸŸ¡ | æ—  | 3 | WebSocket Hub/å¤šé€šé“/ç¦»çº¿å­˜å‚¨ |
| rag | ğŸŸ¡ | âœ… | 17 | RAG æœåŠ¡/å‘é‡å­˜å‚¨ |
| security | ğŸ”¶ | æ—  | 1 | å¯†é’¥ç®¡ç† |
| template | âœ… | æ—  | 2 | æç¤ºè¯æ¨¡æ¿ |
| tenant | âœ… | âœ… | 13 | å¤šç§Ÿæˆ·/è§’è‰²/æƒé™ |
| tools | ğŸŸ¡ | âœ… | 19 | å·¥å…·æ³¨å†Œ/æ‰§è¡Œ |
| tools/builtin | âœ… | æ—  | 13 | 13ç§å†…ç½®å·¥å…·+MCPé›†æˆ |
| worker | ğŸŸ¡ | âœ… | 5 | å¼‚æ­¥ä»»åŠ¡å¤„ç† |
| workflow | âœ… | âœ… | 6 | å·¥ä½œæµå®šä¹‰/éªŒè¯ |
| workflow/approval | âœ… | âœ… | 7 | å®¡æ‰¹ç®¡ç†/äº‹ä»¶æ€»çº¿/ç”¨æˆ·é—®ç­” |
| workflow/executor | âœ… | âœ… | 18 | DAGæ‰§è¡Œå¼•æ“/è°ƒåº¦å™¨/TODOæœåŠ¡ |
| workflow/state | ğŸŸ¡ | æ—  | 1 | çŠ¶æ€ç®¡ç†å™¨ |
| workflow/template | ğŸŸ¡ | æ—  | 3 | å·¥ä½œæµæ¨¡æ¿ |
| workspace | ğŸŸ¡ | âœ… | 6 | å·¥ä½œç©ºé—´/æ–‡ä»¶ç³»ç»Ÿ |

---

## ä¸‰ã€ä¾èµ–å…³ç³»

### 3.1 æ ¸å¿ƒä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        api/wire.go                          â”‚
â”‚                      (ä¾èµ–æ³¨å…¥ä¸­å¿ƒ)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  auth   â”‚â—„â”€â”€â”€â”€â–ºâ”‚  tenant  â”‚â—„â”€â”€â”€â”€â–ºâ”‚ workflow â”‚
   â”‚ JWT     â”‚      â”‚ å¤šç§Ÿæˆ·    â”‚      â”‚ å·¥ä½œæµ   â”‚
   â”‚ OAuth2  â”‚      â”‚ è§’è‰²æƒé™  â”‚      â”‚ å®¡æ‰¹     â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                 â”‚
        â”‚                â–¼                 â”‚
        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
        â”‚          â”‚  models  â”‚            â”‚
        â”‚          â”‚ æ•°æ®æ¨¡å‹  â”‚            â”‚
        â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
        â”‚               â”‚                  â”‚
        â–¼               â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   ai    â”‚    â”‚   rag    â”‚â—„â”€â”€â”€â”€â–ºâ”‚  agent   â”‚
   â”‚ å¤šæä¾›å•† â”‚    â”‚ å‘é‡æ£€ç´¢  â”‚      â”‚ è¿è¡Œæ—¶   â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     infra      â”‚
              â”‚ PostgreSQL     â”‚
              â”‚ Redis          â”‚
              â”‚ PGVector       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¨¡å—ä¾èµ–æ¸…å•

| æ¨¡å— | ä¾èµ– |
|------|------|
| agent/runtime | ai, rag, tools, models, workspace |
| workflow/executor | agent/runtime, queue, audit |
| auth | tenant, models, redis |
| tenant | models, audit |
| rag | models, ai (embedding), infra |
| notification | redis, websocket |
| workspace | models, tools |
| command | workspace, agent/runtime |

---

## å››ã€æµ‹è¯•è¦†ç›–

### 4.1 å·²æœ‰æµ‹è¯•æ–‡ä»¶

```
internal/
â”œâ”€â”€ agent/runtime/
â”‚   â”œâ”€â”€ context_manager_test.go
â”‚   â””â”€â”€ rag_helper_test.go
â”œâ”€â”€ ai/
â”‚   â””â”€â”€ db_logger_test.go
â”œâ”€â”€ auth/
â”‚   â””â”€â”€ identity_store_test.go
â”œâ”€â”€ command/
â”‚   â””â”€â”€ service_test.go
â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e_test.go
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ gin_tenant_context_test.go
â”œâ”€â”€ models/
â”‚   â””â”€â”€ service_test.go
â”œâ”€â”€ rag/
â”‚   â”œâ”€â”€ qdrant_store_test.go
â”‚   â””â”€â”€ rag_service_test.go
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ dynamic_http_tool_test.go
â”œâ”€â”€ tenant/
â”‚   â”œâ”€â”€ permissions_seed_test.go
â”‚   â”œâ”€â”€ service_role_test.go
â”‚   â”œâ”€â”€ service_tenant_test.go
â”‚   â””â”€â”€ service_user_test.go
â”œâ”€â”€ workflow/
â”‚   â”œâ”€â”€ approval/
â”‚   â”‚   â”œâ”€â”€ event_bus_test.go
â”‚   â”‚   â”œâ”€â”€ manager_test.go
â”‚   â”‚   â””â”€â”€ target_resolver_test.go
â”‚   â”œâ”€â”€ executor/
â”‚   â”‚   â”œâ”€â”€ approval_integration_test.go
â”‚   â”‚   â”œâ”€â”€ automation_engine_test.go
â”‚   â”‚   â”œâ”€â”€ condition_executor_test.go
â”‚   â”‚   â”œâ”€â”€ engine_execute_test.go
â”‚   â”‚   â”œâ”€â”€ engine_test.go
â”‚   â”‚   â””â”€â”€ scheduler_resume_test.go
â”‚   â””â”€â”€ service_test.go
â”œâ”€â”€ worker/handlers/
â”‚   â””â”€â”€ workflow_handler_test.go
â””â”€â”€ workspace/
    â”œâ”€â”€ auto_naming_test.go
    â””â”€â”€ service_test.go

api/handlers/
â”œâ”€â”€ tenant/
â”‚   â”œâ”€â”€ role_handler_test.go
â”‚   â””â”€â”€ tenant_handler_test.go
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ tool_handler_test.go
â””â”€â”€ workflows/
    â”œâ”€â”€ execute_handler_test.go
    â””â”€â”€ template_handler_test.go
```

### 4.2 æµ‹è¯•è¦†ç›–ç»Ÿè®¡

| å±‚çº§ | æ¨¡å—æ•° | æœ‰æµ‹è¯•æ¨¡å— | æµ‹è¯•æ–‡ä»¶æ•° | è¦†ç›–ç‡ |
|------|--------|------------|------------|--------|
| API Handler | 14 | 3 | 5 | 21% |
| Internal | 24 | 13 | 28 | 54% |
| **æ€»è®¡** | **38** | **16** | **33** | **42%** |

---

## äº”ã€æ¶æ„å‘ç°ä¸é—®é¢˜

### 5.1 æœåŠ¡é›†æˆæ–¹å¼

| æœåŠ¡ | é›†æˆæ–¹å¼ | è¯´æ˜ |
|------|----------|------|
| NotebookService | MCP å·¥å…· | æœªç›´æ¥æ³¨å…¥ wire.go |
| TodoService | MCP å·¥å…· | æœªç›´æ¥æ³¨å…¥ wire.go |
| UserQuestionService | MCP å·¥å…· | æœªç›´æ¥æ³¨å…¥ wire.go |
| BashService | MCP å·¥å…· | æœªç›´æ¥æ³¨å…¥ wire.go |
| ACECodeSearchService | MCP å·¥å…· | æœªç›´æ¥æ³¨å…¥ wire.go |
| CodebaseSearchService | MCP å·¥å…· | æœªç›´æ¥æ³¨å…¥ wire.go |

**è¯´æ˜ï¼š** ä»¥ä¸ŠæœåŠ¡é€šè¿‡ `RegisterMCPTools()` åœ¨ MCP å·¥å…·ç³»ç»Ÿä¸­æ³¨å†Œï¼ŒAgent å¯é€šè¿‡å·¥å…·è°ƒç”¨è®¿é—®ã€‚å¦‚éœ€ HTTP API ç›´æ¥è®¿é—®ï¼Œéœ€è¡¥å…… Handler å±‚ã€‚

### 5.2 æ½œåœ¨æ”¹è¿›ç‚¹

| é—®é¢˜ | å½±å“ | å»ºè®® |
|------|------|------|
| codesearch æ—  HTTP API | å‰ç«¯æ— æ³•ç›´æ¥è°ƒç”¨ | è¡¥å…… Handler å±‚ |
| Handler è¦†ç›–ç‡ä»… 21% | å›å½’é£é™©é«˜ | ä¸ºæœªè¦†ç›–çš„ 11 ä¸ªæ¨¡å—è¡¥å……ç”¨ä¾‹ |
| TodoService æ— æµ‹è¯• | è´¨é‡é£é™© | è¡¥å……å•å…ƒæµ‹è¯• |
| UserQuestionService æ— æµ‹è¯• | è´¨é‡é£é™© | è¡¥å……å•å…ƒæµ‹è¯• |
| BashService æ— æµ‹è¯• | å®‰å…¨é£é™© | è¡¥å……å®‰å…¨æµ‹è¯• |

---

## å…­ã€å¾…å®Œå–„æ¸…å•

### 6.1 é«˜ä¼˜å…ˆçº§

| åºå· | æ¨¡å— | ä»»åŠ¡ | é¢„ä¼°å·¥ä½œé‡ |
|------|------|------|------------|
| 1 | codesearch | è¡¥å…… Handler å±‚ + å•å…ƒæµ‹è¯• | 2å¤© |
| 2 | notification | è¡¥å……å•å…ƒæµ‹è¯• | 1å¤© |
| 3 | handlers/* | è¡¥å…… Handler æµ‹è¯•ï¼ˆ11ä¸ªæ¨¡å—ç¼ºå¤±ï¼‰ | 3å¤© |
| 4 | security | å¯†é’¥ç®¡ç†åŠ å›ºï¼ˆå¯†é’¥è½®æ¢/ç¯å¢ƒå˜é‡æ ¡éªŒï¼‰ | 2å¤© |

### 6.2 ä¸­ä¼˜å…ˆçº§

| åºå· | æ¨¡å— | ä»»åŠ¡ | é¢„ä¼°å·¥ä½œé‡ |
|------|------|------|------------|
| 5 | agent/runtime | å­ä»£ç†åè°ƒæœºåˆ¶å®Œå–„ | 2å¤© |
| 6 | command | å‘½ä»¤æ‰§è¡Œå®‰å…¨ç­–ç•¥ | 1å¤© |
| 7 | workspace | æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†å®Œå–„ | 2å¤© |
| 8 | metrics | å®Œå–„ç›‘æ§æŒ‡æ ‡ | 1å¤© |

### 6.3 ä½ä¼˜å…ˆçº§

| åºå· | æ¨¡å— | ä»»åŠ¡ | é¢„ä¼°å·¥ä½œé‡ |
|------|------|------|------------|
| 9 | audit | è¡¥å……å•å…ƒæµ‹è¯• | 1å¤© |
| 10 | integration | E2E æµ‹è¯•æ‰©å±• | 2å¤© |

---

## ä¸ƒã€Agent ç±»å‹

### 7.1 å·²å®ç° Agent

| ç±»å‹ | æ–‡ä»¶ | èŒè´£ |
|------|------|------|
| writer | writer_agent.go | å†…å®¹åˆ›ä½œ |
| reviewer | reviewer_agent.go | å†…å®¹å®¡æ ¡ |
| planner | planner_agent.go | ä»»åŠ¡è§„åˆ’ |
| formatter | formatter_agent.go | æ ¼å¼åŒ– |
| translator | translator_agent.go | ç¿»è¯‘ |
| analyzer | analyzer_agent.go | åˆ†æ |
| researcher | researcher_agent.go | è°ƒç ” |

### 7.2 å†…ç½®å·¥å…·æ¸…å•

| å·¥å…· | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| calculator | calculator_tool.go | æ•°å­¦è®¡ç®— |
| http_api | http_api_tool.go | HTTP API è°ƒç”¨ |
| keyword_extractor | keyword_extractor_tool.go | å…³é”®è¯æå– |
| knowledge | knowledge_tool.go | çŸ¥è¯†åº“æ£€ç´¢ |
| mcp | mcp_tools.go | MCP åè®®å·¥å…·é›†æˆ |
| save_memory | save_memory_tool.go | è®°å¿†ä¿å­˜ |
| search | search_tool.go | æœç´¢å·¥å…· |
| text_converter | text_converter_tool.go | æ–‡æœ¬è½¬æ¢ |
| text_statistics | text_statistics_tool.go | æ–‡æœ¬ç»Ÿè®¡ |
| text_summarizer | text_summarizer_tool.go | æ–‡æœ¬æ‘˜è¦ |
| web_search | web_search.go | ç½‘é¡µæœç´¢ |
| workspace_publish | workspace_publish_tool.go | å·¥ä½œç©ºé—´å‘å¸ƒ |

### 7.3 Agent è¿è¡Œæ—¶ç»„ä»¶

| ç»„ä»¶ | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| Registry | registry.go | Agent æ³¨å†Œä¸­å¿ƒ |
| ContextManager | context_manager.go | ä¸Šä¸‹æ–‡ç®¡ç† |
| RAGHelper | rag_helper.go | RAG æ£€ç´¢è¾…åŠ© |
| ToolHelper | tool_helper.go | å·¥å…·è°ƒç”¨è¾…åŠ© |
| MemoryService | memory.go | è®°å¿†æœåŠ¡ |
| AsyncClient | async_client.go | å¼‚æ­¥æ‰§è¡Œå®¢æˆ·ç«¯ |
| AsyncWorker | async_worker.go | å¼‚æ­¥ä»»åŠ¡å¤„ç† |
| SubAgent | subagent.go | å­ä»£ç†åè°ƒ |

### 7.4 ä»£ç æœç´¢æœåŠ¡

| æœåŠ¡ | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| ACECodeSearchService | ace_search.go | ç¬¦å·æœç´¢/å®šä¹‰æŸ¥æ‰¾/å¼•ç”¨æŸ¥æ‰¾/æ–‡æœ¬æœç´¢ |
| CodebaseSearchService | codebase_search.go | è¯­ä¹‰æœç´¢ï¼ˆåŸºäº Embeddingï¼‰ |

**æ”¯æŒçš„æœç´¢èƒ½åŠ›ï¼š**
- ç¬¦å·æœç´¢ï¼šå‡½æ•°ã€ç±»ã€æ¥å£ã€æ–¹æ³•ã€ç»“æ„ä½“
- å®šä¹‰æŸ¥æ‰¾ï¼šè·³è½¬åˆ°ç¬¦å·å®šä¹‰
- å¼•ç”¨æŸ¥æ‰¾ï¼šæŸ¥æ‰¾æ‰€æœ‰å¼•ç”¨ä½ç½®
- æ–‡æœ¬æœç´¢ï¼šæ”¯æŒ git grepã€ripgrepã€åŸç”Ÿ Go å®ç°
- è¯­ä¹‰æœç´¢ï¼šåŸºäºå‘é‡ç›¸ä¼¼åº¦çš„ä»£ç æ£€ç´¢
- æ–‡ä»¶å¤§çº²ï¼šè·å–æ–‡ä»¶ç¬¦å·ç»“æ„

**æ”¯æŒçš„è¯­è¨€ï¼š** Go, TypeScript, JavaScript, Python, Java, Rust, C#, C/C++

### 7.5 MCP å·¥å…·é›†æˆ

| å·¥å…· | æœåŠ¡ä¾èµ– | åŠŸèƒ½ |
|------|----------|------|
| ace_search | ACECodeSearchService | ç¬¦å·æœç´¢/å®šä¹‰æŸ¥æ‰¾/å¼•ç”¨æŸ¥æ‰¾ |
| codebase_search | CodebaseSearchService | è¯­ä¹‰ä»£ç æœç´¢ |
| todo | TodoService | ä»»åŠ¡åˆ—è¡¨ç®¡ç† |
| user_question | UserQuestionService | ç”¨æˆ·é—®ç­”äº¤äº’ |
| filesystem | - | æ–‡ä»¶è¯»å†™æ“ä½œ |
| notebook | NotebookService | ä»£ç å¤‡å¿˜å½• |
| bash | BashService | å®‰å…¨å‘½ä»¤æ‰§è¡Œ |

**BashService å®‰å…¨ç‰¹æ€§ï¼š**
- 12 ç§å±é™©å‘½ä»¤æ¨¡å¼æ£€æµ‹ï¼ˆrm -rfã€fork ç‚¸å¼¹ã€curl|bash ç­‰ï¼‰
- å¯é…ç½®è¶…æ—¶ï¼ˆé»˜è®¤ 30sï¼Œæœ€å¤§ 5minï¼‰
- è¾“å‡ºæˆªæ–­ï¼ˆé»˜è®¤ 50000 å­—ç¬¦ï¼‰
- è·¨å¹³å°æ”¯æŒï¼ˆWindows cmd / Unix shï¼‰

### 7.6 å·¥ä½œæµå®¡æ‰¹æ¨¡å—

| ç»„ä»¶ | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| Manager | manager.go | å®¡æ‰¹è¯·æ±‚ç®¡ç†ï¼ˆåˆ›å»º/å®¡æ‰¹/æ‹’ç»ï¼‰ |
| EventBus | event_bus.go | å®¡æ‰¹äº‹ä»¶å‘å¸ƒè®¢é˜… |
| TargetResolver | target_resolver.go | å®¡æ‰¹ç›®æ ‡è§£æ |
| UserQuestionService | user_question.go | ç”¨æˆ·é—®ç­”æœåŠ¡ï¼ˆé˜»å¡ç­‰å¾…å›ç­”ï¼‰ |

### 7.7 RAG æ–‡æ¡£è§£æå™¨

| è§£æå™¨ | æ–‡ä»¶ | æ”¯æŒæ ¼å¼ |
|--------|------|----------|
| TextParser | text_parser.go | .txt, .md, .json ç­‰ |
| PDFParser | pdf_parser.go | .pdf |
| Registry | registry.go | è§£æå™¨æ³¨å†Œä¸­å¿ƒ |

---

## å…«ã€æ•°æ®åº“è¿ç§»

### 8.1 å·²æœ‰è¿ç§»è„šæœ¬

```
db/migrations/
â”œâ”€â”€ 0001_multi_tenant.sql
â”œâ”€â”€ 0002_rag_tool_system.sql
â”œâ”€â”€ 0003_add_soft_delete.sql
â”œâ”€â”€ 0004_add_triggers.sql
â”œâ”€â”€ 0005_enhance_models.sql
â”œâ”€â”€ 0006_auth_and_audit.sql
â”œâ”€â”€ 0007_approval_notifications.sql
â”œâ”€â”€ 0007_knowledge_base_rag.sql   (é‡å¤ç¼–å·)
â”œâ”€â”€ 0008_agent_rag_integration.sql
â”œâ”€â”€ 0009_model_credentials_and_fallback.sql
â”œâ”€â”€ 0010_workspace_files.sql
â”œâ”€â”€ 0011_rbac_permissions.sql
â”œâ”€â”€ 0012_agent_artifact_workspace.sql
â””â”€â”€ 004_workflow_templates.sql     (ç¼–å·å¼‚å¸¸ï¼Œéœ€åç»­æ•´ç†)
```

### 8.2 æ ¸å¿ƒæ•°æ®è¡¨

| è¡¨å | æ¨¡å— | è¯´æ˜ |
|------|------|------|
| tenants | tenant | ç§Ÿæˆ· |
| users | tenant | ç”¨æˆ· |
| roles | tenant | è§’è‰² |
| permissions | tenant | æƒé™ |
| role_permissions | tenant | è§’è‰²æƒé™å…³è” |
| user_roles | tenant | ç”¨æˆ·è§’è‰²å…³è” |
| agent_configs | agent | Agent é…ç½® |
| workflows | workflow | å·¥ä½œæµå®šä¹‰ |
| workflow_executions | workflow | æ‰§è¡Œè®°å½• |
| approval_requests | workflow | å®¡æ‰¹è¯·æ±‚ |
| models | models | AI æ¨¡å‹ |
| model_credentials | models | æ¨¡å‹å‡­è¯ |
| knowledge_bases | models | çŸ¥è¯†åº“ |
| documents | models | æ–‡æ¡£ |
| document_chunks | rag | æ–‡æ¡£åˆ†å— |
| audit_logs | models | å®¡è®¡æ—¥å¿— |
| sessions | models | ä¼šè¯ |
| workspace_nodes | workspace | å·¥ä½œç©ºé—´èŠ‚ç‚¹ |
| staging_items | workspace | æš‚å­˜åŒº |
| command_requests | command | å‘½ä»¤è¯·æ±‚ |

---

## ä¹ã€é…ç½®è¯´æ˜

### 9.1 ç¯å¢ƒå˜é‡

| å˜é‡ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|
| APP_ENV | å¦ | ç¯å¢ƒï¼šdev/prod |
| APP_DATABASE_HOST/PORT/USER/PASSWORD/DBNAME | æ˜¯ | PostgreSQL è¿æ¥å‚æ•° |
| APP_REDIS_HOST/PORT/PASSWORD | å¦ | Redis è¿æ¥å‚æ•° |
| JWT_SECRET_KEY | æ˜¯(prod) | JWT å¯†é’¥ï¼ˆä¹Ÿä½œä¸ºåŠ å¯†åå¤‡å¯†é’¥ï¼‰ |
| MODEL_CREDENTIAL_SECRET | å¦ | æ¨¡å‹å‡­è¯åŠ å¯†å¯†é’¥ï¼›æœªè®¾ç½®åˆ™å›é€€ JWT_SECRET_KEY |
| OPENAI_API_KEY / ANTHROPIC_API_KEY / GOOGLE_API_KEY / AZURE_OPENAI_API_KEY / DEEPSEEK_API_KEY / QWEN_API_KEY | å¦ | å„æ¨¡å‹æä¾›å•†å¯†é’¥ |
| OLLAMA_BASE_URL | å¦ | æœ¬åœ° Ollama æœåŠ¡åœ°å€ |
| APP_LOG_LEVEL / APP_LOG_FORMAT | å¦ | æ—¥å¿—çº§åˆ«ä¸æ ¼å¼ |

### 9.2 é…ç½®æ–‡ä»¶

```
config/
â”œâ”€â”€ dev.yaml                  # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ prod.yaml                 # ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ agent_capabilities.yaml   # é¢„ç½®èƒ½åŠ›é…ç½®
â”œâ”€â”€ automation_example.yaml   # è‡ªåŠ¨åŒ–ç¤ºä¾‹
â”œâ”€â”€ workflow_templates.yaml   # é¢„ç½®å·¥ä½œæµæ¨¡æ¿
â””â”€â”€ templates/                # YAML æ¨¡æ¿ç›®å½•
```

---

## åã€æ›´æ–°æ—¥å¿—

### 2025-11-25 v1.0.2
- æ›´æ–°æµ‹è¯•æ¸…å•ä¸è¦†ç›–ç‡ï¼šAPI è¦†ç›– 3/14 æ¨¡å—ï¼ˆ5 ä¸ªæµ‹è¯•æ–‡ä»¶ï¼‰ï¼ŒInternal è¦†ç›– 13/24 æ¨¡å—ï¼ˆ28 ä¸ªæµ‹è¯•æ–‡ä»¶ï¼‰ï¼Œæ€»è®¡ 33ã€‚
- ä¿®æ­£æ¨¡å—çŠ¶æ€è¡¨ï¼šè¡¥é½ tests/æ–‡ä»¶æ•°ï¼ˆai=18ï¼Œworkflow/executor=18ï¼Œagent æ— æµ‹è¯•ç­‰ï¼‰ã€‚
- è°ƒæ•´å¾…å®Œå–„æ¸…å•ï¼šç§»é™¤ knowledge Handlerï¼Œæ–°å¢ security åŠ å›ºï¼ŒHandler æµ‹è¯•ç¼ºå£è°ƒæ•´ä¸º 11 ä¸ªæ¨¡å—ã€‚
- æ›´æ–°è¿ç§»è„šæœ¬æ¸…å•ï¼Œæ ‡æ³¨é‡å¤ç¼–å·ä¸å¼‚å¸¸ç¼–å·ã€‚
- ä¿®è®¢é…ç½®è¯´æ˜ï¼šæ”¹ä¸º APP_DATABASE_* / APP_REDIS_* ç­‰å®é™…å˜é‡ï¼Œå¹¶è¡¥å……ç°æœ‰ YAML é…ç½®æ–‡ä»¶ã€‚

### 2025-11-25 v1.0.1
- ä¿®æ­£æ¨¡å—çŠ¶æ€è¯„ä¼°
  - codesearch: â¬œâ†’ğŸŸ¡ï¼ˆå·²æœ‰3æ–‡ä»¶ï¼šACEæœç´¢/è¯­ä¹‰æœç´¢/æ¨¡å‹ï¼‰
  - knowledge: â¬œâ†’ğŸŸ¡ï¼ˆå·²æœ‰NotebookServiceï¼‰
  - tools/builtin: ğŸ”¶â†’âœ…ï¼ˆ13ç§å†…ç½®å·¥å…·ï¼‰
  - metrics: ğŸ”¶â†’ğŸŸ¡ï¼ˆ3æ–‡ä»¶å®Œæ•´ï¼‰
  - audit: è¡¥å……æ–‡ä»¶æ•°ï¼ˆ5æ–‡ä»¶ï¼‰
  - workflow/executor: è¡¥å……æ–‡ä»¶æ•°ï¼ˆ17æ–‡ä»¶ï¼‰
- æ›´æ–°å¾…å®Œå–„æ¸…å•ä¼˜å…ˆçº§

### 2025-11-25 v1.0.0
- åˆå§‹åŒ–æ–‡æ¡£
- å®Œæˆæ¶æ„åˆ†æ
- æ•´ç†æ¨¡å—çŠ¶æ€
- è¯†åˆ«å¾…å®Œå–„ä»»åŠ¡

---

## åä¸€ã€åç»­æ›´æ–°è§„åˆ™

1. æ¯æ¬¡æ¨¡å—å˜æ›´åæ›´æ–°å¯¹åº”çŠ¶æ€
2. æ–°å¢æ¨¡å—æ—¶è¡¥å……åˆ°æ¨¡å—è¯¦æƒ…è¡¨
3. å®Œæˆæµ‹è¯•åæ›´æ–°æµ‹è¯•è¦†ç›–ç»Ÿè®¡
4. å¾…å®Œå–„ä»»åŠ¡å®Œæˆåæ ‡è®°å¹¶ç§»é™¤
